"use strict";const fs=require("fs"),Path=require("path"),utils=loadModule("core.utils"),io=loadModule("core.io"),filePath=Path.resolve(io.getConfigDataPath(),".config.json");let configFile=null;function initConfig(e){const t=e=>e,o=e=>"boolean"==typeof e,i=e=>"number"==typeof e,a=e=>!("0"===e||"false"===e.toLowerCase()),s=e=>0|e,n=(new Map).set("desktop",{type:o,convert:a,validate:t}).set("mobile",{type:o,convert:a,validate:t}).set("ext",{type:o,convert:a,validate:t}).set("children",{type:o,convert:a,validate:t}).set("caseSensitive",{type:o,convert:a,validate:t}).set("fuzzy",{type:o,convert:a,validate:t}).set("shorthand",{type:o,convert:a,validate:t}).set("notes",{type:o,convert:a,validate:t}).set("flags",{type:o,convert:a,validate:t}).set("history",{type:o,convert:a,validate:t}).set("desc",{type:o,convert:a,validate:t}).set("specs",{type:o,convert:a,validate:t}).set("worker",{type:o,convert:a,validate:t}).set("sab",{type:o,convert:a,validate:t}).set("obsolete",{type:o,convert:a,validate:t}).set("colors",{type:o,convert:a,validate:t}).set("maxChars",{type:i,convert:s,validate:e=>Math.max(0,0|e)}).set("columns",{type:()=>!0,convert:e=>e,validate:e=>e}).set("expert",{type:i,convert:s,validate:e=>((e,t,o)=>Math.max(t,Math.min(o,0|e)))(e,0,2)}).set("lang",{type:e=>"string"==typeof e,convert:e=>""+e,validate:e=>(e=>global.languages.includes(e.toLowerCase())?e.toLowerCase():"en-us")(e)}),r=Object.assign({options:{},formatter:{sepChar:char.sep}},configFile);if(Object.keys(r.options).forEach(t=>{const o=n.get(t);o?o.type(r.options[t])&&(e[t]=o.validate(r.options[t])):e.expert||err(`?yInvalid key in config file: "?c${t}?y"?R`)}),r.formatter&&"string"==typeof r.formatter.sepChar&&(char.sep=r.formatter.sepChar),e.set){const t=e.set.split("="),o=t[0].trim(),i=(t[1]||"").trim(),a=n.get(o);if(!a){let t="";"?"!==o&&(t=`?yInvalid key "?c${o}?y". `,process.exitCode=1),err(`${t}?gValid config keys:\n?w${utils.breakAnsiLine([...n.keys()].sort().join("?R, ?w"),e.maxChars)}?R`),process.exit()}if(i.length){let e=a.convert(i);a.type(e)?r.options[o]=a.validate(e):(err("Invalid type for key."),process.exit(1))}else delete r.options[o];try{fs.writeFileSync(filePath,JSON.stringify(r),"utf-8"),process.exit()}catch(e){err(`?rCould not write config file.${DEBUG?lf+e:""}?R`),process.exit(1)}}}function loadConfigFile(){try{return require(filePath)}catch(e){return{}}}module.exports={initConfig:initConfig,config:()=>configFile,preload:()=>configFile=loadConfigFile(),locale:()=>configFile.options&&configFile.options.lang?configFile.options.lang:"en-us"};