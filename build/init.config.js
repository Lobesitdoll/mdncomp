"use strict";const fs=require("fs"),Path=require("path"),utils=loadModule("core.utils"),io=loadModule("core.io"),filePath=Path.resolve(io.getConfigDataPath(),".config.json");function initConfig(e){const t=e=>e,o=e=>"boolean"==typeof e,i=e=>!("0"===e||"false"===e.toLowerCase()),a=(new Map).set("desktop",{type:o,convert:i,validate:t}).set("mobile",{type:o,convert:i,validate:t}).set("ext",{type:o,convert:i,validate:t}).set("children",{type:o,convert:i,validate:t}).set("caseSensitive",{type:o,convert:i,validate:t}).set("fuzzy",{type:o,convert:i,validate:t}).set("shorthand",{type:o,convert:i,validate:t}).set("notes",{type:o,convert:i,validate:t}).set("flags",{type:o,convert:i,validate:t}).set("history",{type:o,convert:i,validate:t}).set("desc",{type:o,convert:i,validate:t}).set("specs",{type:o,convert:i,validate:t}).set("worker",{type:o,convert:i,validate:t}).set("sab",{type:o,convert:i,validate:t}).set("obsolete",{type:o,convert:i,validate:t}).set("colors",{type:o,convert:i,validate:t}).set("maxChars",{type:e=>"number"==typeof e,convert:e=>0|e,validate:e=>Math.max(0,0|e)}).set("columns",{type:()=>!0,convert:e=>e,validate:e=>e}).set("expert",{type:o,convert:i,validate:t}),r=Object.assign({options:{},formatter:{sepChar:char.sep}},loadConfigFile());if(Object.keys(r.options).forEach(t=>{const o=a.get(t);o?o.type(r.options[t])&&(e[t]=o.validate(r.options[t])):e.expert||err(`?yInvalid key in config file: "?c${t}?y"?R`)}),r.formatter&&"string"==typeof r.formatter.sepChar&&(char.sep=r.formatter.sepChar),e.set){const t=e.set.split("="),o=t[0].trim(),i=(t[1]||"").trim(),s=a.get(o);if(!s){let t="";"?"!==o&&(t=`?yInvalid key "?c${o}?y". `,process.exitCode=1),err(`${t}?gValid config keys:\n?w${utils.breakAnsiLine([...a.keys()].sort().join("?R, ?w"),e.maxChars)}?R`),process.exit()}if(i.length){let e=s.convert(i);s.type(e)?r.options[o]=s.validate(e):(err("Invalid type for key."),process.exit(1))}else delete r.options[o];try{fs.writeFileSync(filePath,JSON.stringify(r),"utf-8"),process.exit()}catch(e){err(`?rCould not write config file.${DEBUG?lf+e:""}?R`),process.exit(1)}}}function loadConfigFile(){try{return require(filePath)}catch(e){return{}}}module.exports=initConfig;