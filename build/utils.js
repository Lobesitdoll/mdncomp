"use strict";const mdn=require("../data/data.json"),utils=module.exports={buildTable:e=>{const t=[];return utils.listTopLevels().forEach(r=>{"browsers"!==r&&function e(r,s,l){const n=r[s];"object"==typeof n&&Object.keys(n).forEach(r=>{"__compat"!==r&&(t.push(l+"."+r),e(n,r,l+"."+r))})}(e||mdn,r,r)}),t},listTopLevels:e=>{let t=Object.keys(e||mdn),r=t.indexOf("browsers");return r>=0&&t.splice(r,1),t},getComparer:(e,t,r)=>{let s,l,n="",i="";e.startsWith("/")?(e=(l=(e=e.substr(1)).split("/"))[0],n=l[1]):t?e=function(e){let t=[],r="";e.endsWith(".")&&(r="$",e=e.substr(0,e.length-1));for(let r of e)t.push("\\^$.*+?()[]{}|".includes(r)?"\\"+r:r);return t.join(".*?")+r}(e.toLowerCase()):(e.endsWith(".")&&(e=e.substr(0,e.length-1),i="$"),e.startsWith("*")||(e="*"+e),e.endsWith("*")||i.length||(e+="*"),e=e.split("*").join(".*")+i),r&&!n.includes("i")&&(n+="i");try{s=new RegExp(e,n)}catch(e){log("Invalid regular expression:",e.message),process.exit(-1)}return s},getPathAsObject:(e,t)=>{let r=e.split("."),s=mdn;return r.forEach(e=>{s&&s[e]&&(s=s[e])}),t&&Object.keys(s).forEach(e=>{s&&s[e].__compat&&delete s[e]}),s},nameFromPath:e=>{let t=utils.getExt(e);return t.length?t:e},getExt:e=>{if("string"!=typeof e)return"";let t=e.lastIndexOf(".");return t<0?"":e.substr(++t)},prePathFromPath:e=>{let t=e.split("."),r=mdn,s="";return t.pop(),t.forEach(e=>{r&&(r[e].__compat&&(s+=e+"."),r=r[e])}),s.length>1?s:""},isCompat:e=>{let t=utils.getPathAsObject(e);return!!t&&"object"==typeof t.__compat},cleanHTML:(e,t,r)=>(e=e.replace(/<code>/gi,ANSI.cyan).replace(/<\/code>/gi,r||ANSI.reset).replace(/(<([^>]+)>)/gi,""),t&&(e=e.replace(/&lt;/gi,"<").replace(/&gt;/gi,">")),e),breakAnsiLine:(e,t)=>{let r,s=[],l=0,n=0,i=0,a=-1,o=!1,c=Math.max(72,t>>>0);for(;r=e[l];)o?"m"===r&&(o=!1):""===r?o=!0:(" "!==r&&"\n"!==r||(a=l),++n!==c&&"\n"!==r||(a<0&&(a=l),s.push(e.substring(i,a).trim()),i=a,a=-1,n=l-i)),l++;return n&&s.push(e.substr(i)),s.forEach((e,t)=>{s[t]=e.trim()}),s.length?s.join(lf):""},getMaxLength:e=>{let t=0;return e.forEach(e=>{let r=(utils.prePathFromPath(e)+utils.nameFromPath(e)).length;r>t&&(t=r)}),t},entities:e=>e.replace(/&nbsp;/gim," ").replace(/&quot;/gim,'"').replace(/&amp;/gim,"&").replace(/&lt;/gim,"<").replace(/&gt;/gim,">")};