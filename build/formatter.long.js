"use strict";const utils=loadModule("core.utils"),table=loadModule("core.table"),browserNames=utils.getBrowserNames(),refs=["°","¹","²","³","a","b","c","d","e","f","g","h","i","j","k","m","n","p","q","r","s","t","u","v","w","y","z","^","ª","º","æ","ø","å","ä","ö","á","é","ò","ú","à","è","ù","Æ","Ø","Å","Ö","Ä","Á","É","Ò","Ú","À","È"],tblOptions={align:["l"],delimiter:char.sep,stringLength:utils.ansiLength,start:"?G",end:"?R"};function formatterLong(e){const t=e.path.startsWith("webextensions"),s=[],n={exp:!1,dep:!1,nonStd:!1,parent:!1,any:!1};if(log(),log(utils.breakAnsiLine(`?c${e.prePath}?w${e.name}?R`,options.maxChars)),t||log(function(){let t=[];e.standard&&t.push(`?g${text.standard}?R`);e.experimental&&t.push(`?y${text.experimental}?R`);e.deprecated&&t.push(`?r${text.deprecated}?R`);t.length||t.push(`?r${text.nonStandard}?R`);return t.join(", ")}()),e.url&&log((e.url?"?G"+e.url:"-")+"?R"),e.title&&e.title.length){let t=utils.entities("?w"+utils.breakAnsiLine(utils.cleanHTML(e.title,!0,"?w"),options.maxChars));log(lf+t)}if(options.desc)if(e.description&&e.description!==e.title){let t=utils.entities("?w"+utils.breakAnsiLine(utils.cleanHTML(e.description,!0,"?w"),options.maxChars));log(lf+t)}else log(lf+"?R"+text.noDescription);if(log("?R"),options.desktop&&e.browsers.desktop.length&&i("desktop"),options.mobile&&e.browsers.mobile.length&&i("mobile"),options.ext&&e.browsers.ext.length&&i("ext"),options.expert<2){if(n.dep||n.nonStd||n.exp||n.parent){let e=[];n.exp&&e.push(`?y${char.experimental}?R = ${text.experimental}`),n.dep&&e.push(`?b${char.deprecated}?R = ${text.deprecated}`),n.nonStd&&e.push(`?r${char.nonStd}?R = ${text.nonStandard}`),n.parent&&e.push(`?g${char.parent}?R = ${text.listParent}`),log("?R"+e.join(", ")+lf)}const t=e.support;!options.children&&t.any&&(t.newRequired&&log(`?g*?R ${text.missing} ?cnew?R ${text.throws}`),t.inWorker&&log(`?g+ ?R${text.availableInHint} ?cWorker?R.`),t.sabAsBuffer&&log(`?g+?R ${text.accepts} ?cSharedArrayBuffer?R ${text.asBuffer}`),t.inSVG&&log(`?g+?R ${text.hasSupportDetails} SVG`),t.inTextArea&&log(`?g+?R ${text.hasSupportDetails} ?c<text-area>?R`),log())}if((options.flags||options.history)&&(options.desktop&&l("desktop"),options.mobile&&l("mobile"),options.ext&&l("ext"),s.length&&(p((options.history?text.hdrFlagsHistory:text.hdrFlags)+" (?m"+char.flags+"?b)"),log(s.join(lf)),log("?R"))),options.notes&&e.notes.length&&(p(text.hdrNotes),e.notes.forEach(t=>{let s=`?c${refs[t.index%refs.length]}?R: `;s+=`?R${utils.cleanHTML(t.note,!0,"?R","?c","?y")}`,s+=t.note.includes("<a")?`?R ${text.refLink} ${function(t){for(let s of e.links)if(s.index===t.index)return s;return{linkIndex:"-"}}(t).linkIndex}.?R`:"?R",log(utils.breakAnsiLine(s,options.maxChars))}),log("?R"),options.notes&&e.links.length)){p(text.hdrLinks);let t="";e.links.forEach(s=>{let n;s.index===t?n="".padStart(Math.log10(e.links.length)+1)+"  ":(t=s.index,n=`?c${s.linkIndex}?R: `),log(`${n}?G${s.url}?R`)}),log("?R")}var o;function r(e){log(e),n.any=!0}function i(t){const s=[],o=e.browsers[t],r=e.name,i=["?y"+text[t].toUpperCase().padEnd(Math.max(0,options.maxChars-67))+"?G"],l=o.map(e=>`?w${browserNames[e.browser].long.padEnd(10)}?G`);s.push(i.concat(l));let p=utils.featureName(r);e.isCompat||(p=char.parent+" "+r,n.parent=!0),s.push(a(p,o,e,!1)),options.children&&e.children.length&&e.children.forEach(e=>{let n=utils.featureName(e.name);n===r&&(n+="()"),s.push(a(n,e.browsers[t],e,!0))}),log("?G"+table(s,tblOptions))}function a(e,s,o,r){const i=r?"?R":o.isCompat?"?w":"?g";let a="";t||(o.deprecated&&(a+="?b"+char.deprecated,n.dep=!0),o.standard||o.experimental||(a+="?r"+char.nonStd,n.nonStd=!0),o.experimental&&(a+="?y"+char.experimental,n.exp=!0)),a.length&&(a+=" ");const l=[a+i+e+"?G"];return s.sort(c).forEach(e=>{const t=e.history[0];let s=utils.versionAddRem(t.version_added,t.version_removed,e.noteIndex.length>0);e.noteIndex.length&&(s+="?c",e.noteIndex.forEach(e=>{s+=refs[e%refs.length]})),options.flags&&t.flags&&t.flags.length&&(s+="?m"+char.flags),s+="?G",l.push(s)}),l}function l(t){e.browsers[t].forEach(e=>{const t=browserNames[e.browser].long;if(e.history.length){let n=options.history?e.history.length:1;for(let o=0;o<n;o++){const n=e.history[o];let r=utils.ansiFree(utils.versionAddRem(n.version_added,n.version_removed,!1,!0));if(r=r===char.yes?"":" "+r,options.history&&(n.alternative_name&&s.push(`?y${t}${r}?R: ${text.altName}: ?c${n.alternative_name}`),n.prefix&&s.push(`?y${t}${r}?R: ${text.vendorPrefix}: ?c${n.prefix}`),n.partial_implementation&&s.push(`?y${t}${r}?R: ${text.partialImpl}.`),n.notes.length)){const e=n.notes.map(e=>refs[e%refs.length]).join("?R,?c");s.push(`?y${t}${r}?R: ${text.seeNote} ?c${e}?w`)}if(options.flags&&n.flags.length){let e="?y"+t+r+":?w ";n.flags.forEach(t=>{switch(t.type){case"preference":e+=`${text.thisFeatBehind} ?c${t.name}?w ${text.preference}`,t.value_to_set&&(e+=` (${text.setTo} ?c${t.value_to_set}?w)`),e+=".";break;case"compile_flag":e+=`${text.compileWith} ?c${t.name}?w ${text.setTo} ?c${t.value_to_set}?w.`;break;case"runtime_flag":e+=`${text.startWith} ?c${t.name}?w.`}}),s.push(utils.breakAnsiLine(e,options.maxChars))}}}})}function p(e){log(`?b${e}?R`)}function c(e,t){return e<t?-1:e>t?1:0}options.specs&&e.specs.length&&(p(text.hdrSpecs),e.specs.forEach(e=>{log(`?w${utils.entities(e.name)} ?R[${o=e.status,"?"+({RFC:"yIETF RFC",STANDARD:`g${text.specStandard}`,REC:`g${text.specRec}`,CR:`c${text.candidate} ${text.specRec}`,LIVING:`c${text.specLiving} ${text.specStandard}`,DRAFT:`y${text.specDraft}`,PR:`y${text.specProposed} ${text.specRec}`,RC:`c${text.specRelease} ${text.specCandidate}`,WD:`b${text.specWorking} ${text.specDraft}`,ED:`g${text.specEditors} ${text.specDraft}`,OBSOLETE:`r${text.obsolete}`,LC:`y${text.lastCallWorking} ${text.specDraft}`,"OLD-TRANSFORMS":`o${text.hasMergedAnother} ${text.specDraft.toLowerCase()}`}[o.toUpperCase()]||`y${text.status}`)+"?R"}?R]${lf}?G${e.url}?R`)}),log("?R")),options.expert<1&&(!options.desc&&e.description.length&&r(text.useOptionHint+" ?c--desc?R "+text.descHint),!options.specs&&e.specs.length&&r(text.useOptionHint+" ?c--specs?R "+text.specsHint),!options.history&&e.notes.length&&r(text.useOptionHint+" ?c-y, --history?R "+text.historyHint),!e.isFiltered&&e.children.length>9&&r("?R"+text.filterHint),n.any&&log("?R"))}module.exports=formatterLong;