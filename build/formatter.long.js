"use strict";const utils=loadModule("core.utils"),table=loadModule("core.table"),browserNames=utils.getBrowserNames(),refs=["°","¹","²","³","a","b","c","d","e","f","g","h","i","j","k","l","m","n","p","q","r","s","^","ª","º"],tblOptions={align:["l"],delimiter:char.sep,stringLength:utils.ansiLength,start:"?G",end:"?R"};function formatterLong(e,t=!1){const s=e.path.startsWith("webextensions"),o=[],r={worker:!1,sab:!1,exp:!1,dep:!1,nonStd:!1,parent:!1};let n=!1;if(t||log(),"worker_support"===e.name)log(`?c${text.hdrWorkers}?w`),log(h());else if("SharedArrayBuffer_as_param"===e.name)log(`?c${text.hdrSAB}?w`),log(h());else{if(log(`?c${e.prePath}?w${e.name}?R`),s||log(h()),e.url&&log((e.url?"?G"+e.url:"-")+"?R"),e.short&&e.short.length){let t=utils.entities("?R"+utils.breakAnsiLine(utils.cleanHTML(e.short),options.maxChars));log(t+lf)}if(options.desc&&e.description&&e.description!==e.short){let t=utils.entities("?w"+utils.breakAnsiLine(utils.cleanHTML(e.description,!0,ANSI.white),options.maxChars));log(lf+t)}}if(log(),options.desktop&&e.browsers.desktop.length&&l("desktop"),options.mobile&&e.browsers.mobile.length&&l("mobile"),options.ext&&e.browsers.ext.length&&l("ext"),!options.expert&&(r.dep||r.nonStd||r.exp||r.parent)&&(options.worker&&t||!options.worker&&!t||options.sab&&t||!options.sab&&!t)){let e=[];r.exp&&e.push(`?o${char.experimental}?R = ${text.experimental}`),r.dep&&e.push(`?r${char.deprecated}?R = ${text.deprecated}`),r.nonStd&&e.push(`?r${char.nonStd}?R = ${text.nonStandard}`),r.parent&&e.push(`?g${char.parent}?R = ${text.listParent}`),log("?R"+e.join(", ")+lf)}var i;function a(e){log(e),n=!0}function l(t){const s=[],o=e.browsers[t],n=e.name,i=["?y"+text[t].toUpperCase()+"?G"],a=o.map(e=>`?w${browserNames[e.browser].long.padEnd(10)}?G`);s.push(i.concat(a));let l=n;e.isCompat||(l=char.parent+" "+n,r.parent=!0),s.push(p(l,o,e,!1)),options.children&&e.children.length&&e.children.forEach(e=>{let o=e.name;r.worker||options.worker||"worker_support"!==o||(r.worker=!0),r.sab||options.sab||"SharedArrayBuffer_as_param"!==o||(r.sab=!0),o===n&&(o+="()"),s.push(p(o,e.browsers[t],e,!0))}),log("?G"+table(s,tblOptions))}function p(e,t,o,n){const i=n?"?R":o.isCompat?"?w":"?g";let a=" ";s||(o.standard||o.experimental||(a+="?r"+char.nonStd,r.nonStd=!0),o.experimental&&(a+="?o"+char.experimental,r.exp=!0),o.deprecated&&(a+="?r"+char.deprecated,r.dep=!0)),a=a.trimRight();const l=[i+utils.getFeatureName(e)+a+"?G"];return t.sort(x).forEach(e=>{const t=e.history[0];let s=utils.versionAddRem(t.version_added,t.version_removed,e.noteIndex.length>0);e.noteIndex.length&&(s+="?c",n&&options.shorthand?s+="*":e.noteIndex.forEach(e=>{s+=refs[e%refs.length]})),options.flags&&t.flags&&t.flags.length&&(s+=(n?"?m":"?b")+char.flags),s+="?G",l.push(s)}),l}function c(t){e.browsers[t].forEach(e=>{const t=browserNames[e.browser].long;if(e.history.length){let s=options.history?e.history.length:1;for(let r=0;r<s;r++){const s=e.history[r];let n=utils.ansiFree(utils.versionAddRem(s.version_added,s.version_removed,!1));if(options.history){let e=isNaN(n)?"":" "+n;if(s.alternative_name&&o.push(`?y${t}${e}?w: ${text.altName}: ?c${s.alternative_name}?w`),s.prefix&&o.push(`?y${t}${e}?w: ${text.vendorPrefix}: ?c${s.prefix}?w`),s.partial_implementation&&o.push(`?y${t}${e}?w: ${text.partialImpl}.?w`),s.notes.length){const r=s.notes.map(e=>refs[e%refs.length]).join(", ");o.push(`?y${t}${e}?w: ${text.seeNote} ?c${r}?w`)}}if(options.flags&&s.flags.length){let e="?y"+t+(n=isNaN(n)?"":" "+n)+":?w ";s.flags.forEach(t=>{switch(t.type){case"preference":e+=`${text.thisFeatBehind} ?c${t.name}?w ${text.preference}`,t.value_to_set&&(e+=` (${text.setTo} ?c${t.value_to_set}?w)`),e+=".";break;case"compile_flag":e+=`${text.compileWith} ?c${t.name}?w ${text.setTo} ?c${t.value_to_set}?w.`;break;case"runtime_flag":e+=`${text.startWith} ?c${t.name}?w.`}}),o.push(utils.breakAnsiLine(e,options.maxChars))}}}})}function h(){let t=[];return e.standard&&t.push(`?g${text.standard}?R`),e.experimental&&t.push(`?y${text.experimental}?R`),e.deprecated&&t.push(`?r${text.deprecated}?R`),t.length||t.push(`?r${text.nonStandard}?R`),t.join(", ")}function d(e){log(`?c${ANSI.underline}${e}`)}function x(e,t){return e<t?-1:e>t?1:0}options.worker&&e.workers&&formatterLong(e.workers,!0),options.sab&&e.sab&&formatterLong(e.sab,!0),options.notes&&e.notes.length&&(d(text.hdrNotes),e.notes.forEach(e=>{let t=`?c${refs[e.index%refs.length]}?R: `;t+=`?R${utils.cleanHTML(e.note,!0,"?R","?c","?y")}`,t+=e.note.includes("<a")?`?R ${text.refLink} ${e.index}.?R`:"?R",log(utils.breakAnsiLine(t,options.maxChars))}),log(),options.notes&&e.links.length&&(d(text.hdrLinks),e.links.forEach(e=>{log(`?c${e.index}?R: ?y${e.url}?R`)}),log())),(options.flags||options.history)&&(options.desktop&&c("desktop"),options.mobile&&c("mobile"),options.ext&&c("ext"),o.length&&(d(options.history?text.hdrFlagsHistory:text.hdrFlags),log(o.join(lf)+lf))),options.specs&&e.specs.length&&(d(text.hdrSpecs),e.specs.forEach(e=>{log(`?w${utils.entities(e.name)} ?R[${i=e.status,"?"+({RFC:"yIETF RFC",STANDARD:`g${text.specStandard}`,REC:`g${text.specRec}`,CR:`c${text.candidate} ${text.specRec}`,LIVING:`c${text.specLiving} ${text.specStandard}`,DRAFT:`y${text.specDraft}`,PR:`y${text.specProposed} ${text.specRec}`,RC:`c${text.specRelease} ${text.specCandidate}`,WD:`b${text.specWorking} ${text.specDraft}`,ED:`g${text.specEditors} ${text.specDraft}`,OBSOLETE:`r${text.obsolete}`,LC:`y${text.lastCallWorking} ${text.specDraft}`,"OLD-TRANSFORMS":`o${text.hasMergedAnother} ${text.specDraft.toLowerCase()}`}[i.toUpperCase()]||`y${text.status}`)+"?R"}?R]${lf}${e.url}`)}),log()),options.expert||t||(r.worker&&a(utils.breakAnsiLine(text.workerHint,options.maxChars)),r.sab&&a(utils.breakAnsiLine(text.sabHint,options.maxChars)),!options.specs&&e.specs.length&&a(text.specsHint),!options.desc&&e.description.length&&a(text.descHint),options.history||a(text.historyHint),!e.isFiltered&&e.children.length>9&&a("?R"+text.filterHint),n&&log())}module.exports=formatterLong;