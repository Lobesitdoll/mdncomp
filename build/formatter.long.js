"use strict";const utils=loadModule("core.utils"),Output=loadModule("core.output"),table=loadModule("core.table"),out=new Output(0,lf),browserNames=utils.getBrowserLongNames(),refs=["°","¹","²","³","a","b","c","d","e","f","g","h","i","j","k","l","m","n","^","ª","º","'",'"',"`"],tblOptions={align:["l"],delimiter:char.sep,stringLength:utils.ansiLength,start:"?G",end:"?R"};function formatterLong(t,e=!1){const s=t.path.startsWith("webextensions"),o=[];let n=!1,i=!1,r=!1,a=!1,d=!1,l=!1;if("worker_support"===t.name)out.addLine(lf,"?c",text.hdrWorkers,"?w").addLine("%0",x());else if("SharedArrayBuffer_as_param"===t.name)out.addLine(lf,"?c",text.hdrSAB,"?w").addLine("%0",x());else{if(out.addLine("\n?c%0?w%1?R",t.prePath,t.name),s||out.addLine("%0",x()),t.url&&out.addLine(t.url?"?G"+t.url:"-","?R"),t.short&&t.short.length){let e=utils.entities("?R"+utils.breakAnsiLine(utils.cleanHTML(t.short),options.maxChars));out.addLine(e,lf)}if(options.desc&&t.description&&t.description!==t.short){let e=utils.entities("?R"+utils.breakAnsiLine(utils.cleanHTML(t.description),options.maxChars));out.addLine(lf,e,lf)}}if(options.desktop&&c("desktop"),options.mobile&&c("mobile"),options.ext&&c("ext"),out.addLine(),!options.expert&&(a||d||r)&&(options.worker&&e||!options.worker&&!e||options.sab&&e||!options.sab&&!e)){let t=[];r&&t.push(`?o!?R = ${text.experimental}`),a&&t.push(`?r-?R = ${text.deprecated}`),d&&t.push(`?rX?R = ${text.nonStandard}`),out.addLine("?R",t.join(", "),lf)}var p;function c(e){const s=t.browsers[e],o=t.name,r=[],a=["?y"+text[e].toUpperCase()+"?G"],d=s.map(t=>`?w${browserNames[t.browser].padEnd(10)}?G`);r.push(a.concat(d)),r.push(u(t.isCompat?o:"P "+o,s,t,!1)),options.children&&t.children.length&&t.children.forEach(t=>{let s=t.name;n||options.worker||"worker_support"!==s||(n=!0),i||options.sab||"SharedArrayBuffer_as_param"!==s||(i=!0),s===o&&(s+="()"),r.push(u(s,t.browsers[e],t,!0))}),out.add(lf,"?G",table(r,tblOptions))}function u(t,e,o,n){const i=n?"?R":o.isCompat?"?w":"?g";let l=" ";s||(o.standard||o.experimental||(l+="?rX",d=!0),o.experimental&&(l+="?o!",r=!0),o.deprecated&&(l+="?r-",a=!0)),l=l.trimRight();const p=[i+utils.getFeatureName(t)+l+"?G"];return e.sort($).forEach(t=>{const e=t.history[0];let s=utils.versionAddRem(e.add,e.removed);t.noteIndex.length&&(s+="?c",n&&options.shorthand?s+="*":t.noteIndex.forEach(t=>{s+=refs[t%refs.length]})),options.flags&&e.flags&&e.flags.length&&(s+=n?"?mF":"?bF"),s+="?G",p.push(s)}),p}function h(e){t.browsers[e].forEach(t=>{const e=browserNames[t.browser];if(t.history.length){let s=options.history?t.history.length:1;for(let n=0;n<s;n++){let s=t.history[n],i=utils.ansiFree(utils.versionAddRem(s.add,s.removed));if(options.history){let t=isNaN(i)?"":" "+i;s.altName&&o.push(`?y${e}${t}?w: ${text.altName}: ?c${s.altName}?w`),s.prefix&&o.push(`?y${e}${t}?w: ${text.vendorPrefix}: ?c${s.prefix}?w`),s.partial&&o.push(`?y${e}${t}?w: ${text.partialImpl}.?w`),s.notes.length&&o.push(`?y${e}${t}?w: ${text.seeNote} ?c${s.notes.map(t=>refs[t%refs.length]).join(", ")}?w`)}if(options.flags&&s.flags.length){let t="?y"+e+(i=isNaN(i)?"":" "+i)+":?w ";s.flags.forEach(e=>{switch(e.type){case"preference":t+=`${text.thisFeatBehind} ?c${e.name}?w ${text.preference}.`,e.value_to_set&&(t+=` (${text.setTo} ?c${e.value_to_set}?w).`);break;case"compile_flag":t+=`${text.compileWith} ?c${e.name}?w ${text.setTo} ?c${e.value_to_set}?w.`;break;case"runtime_flag":t+=`${text.startWith} ?c${e.name}?w. `}}),o.push(utils.breakAnsiLine(t,options.maxChars))}}}})}function x(){let e=[];return t.standard&&e.push(`?g${text.standard}?R`),t.experimental&&e.push(`?y${text.experimental}?R`),t.deprecated&&e.push(`?r${text.deprecated}?R`),e.length||e.push(`?r${text.nonStandard}?R`),e.join(", ")}function f(t){out.addLine(`?c${ANSI.underline}${t}`)}function $(t,e){return t<e?-1:t>e?1:0}return options.worker&&t.workers&&formatterLong(t.workers,!0),options.sab&&t.sab&&formatterLong(t.sab,!0),options.notes&&t.notes.length&&(f(text.hdrNotes),t.notes.forEach(t=>{let e=`?c${refs[t.index%refs.length]}?R: `;e+=`?R${utils.cleanHTML(t.note,!0,"?R","?c","?y")}`,e+=t.note.includes("<a href")?`?R ${text.refLink} ${t.index}.?R`:"?R",out.addLine(utils.breakAnsiLine(e,options.maxChars))}),out.addLine(),options.notes&&t.links.length&&(f(text.hdrLinks),t.links.forEach(t=>{out.addLine(`?c${t.index}?R: ?y${t.url}?R`)}),out.addLine())),(options.flags||options.history)&&(options.desktop&&h("desktop"),options.mobile&&h("mobile"),options.ext&&h("ext"),o.length&&(f(text.hdrFlagsHistory),out.add(o.join(lf),lf,lf))),options.specs&&t.specs.length&&(f(text.hdrSpecs),t.specs.forEach(t=>{out.addLine("?w"+`${utils.entities(t.name)} ?R[${p=t.status,"?"+({RFC:"yIETF RFC",STANDARD:`g${text.specStandard}`,REC:`g${text.specRec}`,CR:`c${text.candidate} ${text.specRec}`,LIVING:`c${text.specLiving} ${text.specStandard}`,DRAFT:`y${text.specDraft}`,PR:`y${text.specProposed} ${text.specRec}`,RC:`c${text.specRelease} ${text.specCandidate}`,WD:`b${text.specWorking} ${text.specDraft}`,ED:`g${text.specEditors} ${text.specDraft}`,OBSOLETE:`r${text.obsolete}`,LC:`y${text.lastCallWorking} ${text.specDraft}`,"OLD-TRANSFORMS":`o${text.hasMergedAnother} ${text.specDraft.toLowerCase()}`}[p.toUpperCase()]||`y${text.status}`)+"?R"}?R]${lf}${t.url}`)}),out.addLine()),options.expert||(n&&(out.addLine(utils.breakAnsiLine(text.workerHint,options.maxChars)),l=!0),i&&(out.addLine(lf,utils.breakAnsiLine(text.sabHint,options.maxChars)),l=!0),!options.specs&&t.specs.length&&(out.addLine(text.specsHint),l=!0),!options.desc&&t.description.length&&(out.addLine(text.descHint),l=!0),options.history||(out.addLine(text.historyHint),l=!0),!t.isFiltered&&t.children.length>9&&(out.addLine(text.filterHint),l=!0),l&&out.addLine()),out.toString()}module.exports=formatterLong;