/*!
  Browser option module
  Copyright (c) 2018 Epistemex
  www.epistemex.com
 */
const utils=require("./core.utils"),mdn=utils.loadMDN(),outInfo=utils.outInfo;function listBrowsers(){return Object.keys(mdn.browsers)}function listBrowser(e){const t=mdn.browsers[e],s=[];if(!t)return getBrowserStatusList().includes(e)?listBrowserOnStatus(e):["Unknown browser-id: '"+e+"' - Use '.' to list all valid IDs."];let r=0,n=0;Object.keys(t.releases).forEach(e=>{let t=e.split(".");t[0].length>r&&(r=t[0].length),e.length-t[0].length>n&&(n=e.length-t[0].length)});let o=0;return getBrowserStatusList().forEach(e=>{e.length>o&&(o=e.length)}),Object.keys(t.releases).sort(function(e,t){let s=e.split("."),r=t.split("."),n=(0|s[0])+.001*(0|s[1])+1e-6*(0|s[2])+1e-9*(0|s[3]),o=(0|r[0])+.001*(0|r[1])+1e-6*(0|r[2])+1e-9*(0|r[3]);return n>o?1:n<o?-1:0}).forEach(l=>{let a=ANSI.white+(t.name||e)+"  "+ANSI.green+_fBrowserVersion(l,r,n),i=t.releases[l].release_date,u=t.releases[l].release_notes,S=t.releases[l].status;a+="  "+(i?ANSI.cyan+i:ANSI.gray+"-         "),a+="  "+(S?_browserStatusColor(S)+S.padEnd(o)+(options.notes&&u?"  "+ANSI.reset+u:"")+ANSI.reset+ANSI.white:"-"),s.push(a+ANSI.white)}),s}function listBrowserOnStatus(e){let t=[],s=_browserStatusColor(e),r=_iterateBrowsers((t,s,r,n,o)=>{let l=t.release_date;return t.status&&t.status===e?{browser:o||s,version:r,notes:t.release_notes,date:l||"-"}:null}),n=0,o=0,l=0;return r.forEach(e=>{let t=e.version.split(".");e.browser.length>n&&(n=e.browser.length),t[0].length>o&&(o=t[0].length),e.version.length-t[0].length>l&&(l=e.version.length-t[0].length)}),t.push(ANSI.reset+"STATUS: "+ANSI.reset+ANSI.white+s+e.toUpperCase()+ANSI.reset),r.forEach(e=>{t.push(ANSI.white+e.browser.padEnd(n)+ANSI.white+"  "+s+_fBrowserVersion(e.version,o,l)+ANSI.white+ANSI.dim+"  "+("-"===e.date?ANSI.gray:ANSI.reset+ANSI.bright+ANSI.cyan)+e.date+(options.notes&&e.notes&&e.notes.length?"  "+ANSI.reset+e.notes:"")+ANSI.reset)}),t}function getBrowserStatusList(){return _iterateBrowsers((e,t,s,r)=>r.includes(e.status)?null:e.status).sort()}function _browserStatusColor(e){switch(e){case"retired":return ANSI.red;case"beta":case"alpha":return ANSI.yellow;case"nightly":return ANSI.blue;case"current":case"esr":return ANSI.green;case"planned":return ANSI.magenta;default:return ANSI.white}}function _iterateBrowsers(e){const t=mdn.browsers,s=[];return Object.keys(t).forEach(r=>{let n=t[r].name;Object.keys(t[r].releases).forEach(o=>{let l=e(t[r].releases[o],r,o,s,n);l&&s.push(l)})}),s}function _fBrowserVersion(e,t,s){let r=e.split(".");return r[0].padStart(t)+r.join(".").substr(r[0].length).padEnd(s)}function browsers(e){"."===e?(outInfo(ANSI.reset+"Valid browser identifiers:"),outInfo(ANSI.green+listBrowsers().join(lf)+ANSI.reset),outInfo(lf+"Valid statuses:"),outInfo(ANSI.green+getBrowserStatusList().join(", "))):outInfo(listBrowser(e.toLowerCase()).join(lf))}module.exports=browsers;