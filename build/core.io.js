const fs=require("fs"),path=require("path"),https=require("https");module.exports={request:function(e,t,o,r,s,n,a=2){let i;function c(e,t){s?s({statusCode:e&&e.statusCode?e.statusCode:-1,error:t}):err("Error",e,t)}t=t||(()=>!0),https.get(e,e=>{const f=[];let u=0;if(i=e,e&&e.statusCode&&a){if(301===e.statusCode||302===e.statusCode)return this.request(e.headers.location,t,o,r,s,--a);if(200===e.statusCode&&t({headers:e.headers})){const t=0|e.headers["content-length"];e.on("data",e=>{f.push(e),u+=e.length,o&&o(t?u/t:u%7/7)}).on("end",()=>{r(n?Buffer.concat(f):Buffer.concat(f).toString())})}else s&&c(e,"")}else s("Could not connect")}).on("error",e=>c(i,e)).end()},getConfigRootPath:function(){return"win32"===process.platform?path.resolve(process.env.APPDATA,"../.."):"darwin"===process.platform?path.resolve(process.env.HOME,"/Library/Preferences"):process.env.HOME},getConfigPath:function(){return path.resolve(this.getConfigRootPath(),".mdncomp")},getConfigFilePath:function(){return path.resolve(this.getConfigDataPath(),".config.json")},getConfigDataPath:function(){let e=this.getConfigPath();t(e);for(let o=0;o<arguments.length;o++)t(e=path.resolve(e,arguments[o]));function t(e){if(!fs.existsSync(e))try{fs.mkdirSync(e)}catch(t){log(`${ANSI.red}Could not create config folder:\n${e}\n${t.message}${ANSI.reset}`),"darwin"!==process.platform&&"linux"!==process.platform||t('Try using "sudo mdncomp --set <kv>" to write config.'),process.exitCode=1}}return e}};