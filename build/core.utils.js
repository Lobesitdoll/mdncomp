"use strict";const colorCodes="rgyobmpcwGR";let featureNames=null;const utils={bcdToList:e=>{const t=[];return utils.getRootList(e).forEach(r=>(function e(r,o,n){const s=r[o];"object"==typeof s&&Object.keys(s).filter(e=>"__compat"!==e&&"worker_support"!==e&&"SharedArrayBuffer_as_param"!==e).forEach(r=>{t.push(n+"."+r),e(s,r,n+"."+r)})})(e,r,r)),t},getRootList:e=>Object.keys(e).filter(e=>"browsers"!==e&&"__mdncomp"!==e),getComparer:(e,t,r)=>{let o,n,s="",a="";e.startsWith("/")?(e=(n=e.split("/"))[1],s=n[2]||""):t?e=function(e){const t=[];let r="";e.endsWith(".")&&(r="$",e=e.substr(0,e.length-1));for(let r of e)t.push("\\^$.*+?()[]{}|".includes(r)?"\\"+r:r);return t.join(".*?")+r}(r?e.toLowerCase():e):(e.endsWith(".")&&(e=e.substr(0,e.length-1),a="$"),e.endsWith("*")||a.length||(e+="*"),e=e.split("*").join(".*")+a),r&&!s.includes("i")&&(s+="i");try{o=new RegExp(e,s)}catch(e){utils.err(text.invalidRegex),process.exit(1)}return o},getPathAsObject:(e,t)=>{let r=e;return t.split(".").forEach(e=>{r&&r[e]&&(r=r[e])}),r},nameFromPath:e=>{let t=utils.getExt(e);return t.length?t:e},getExt:e=>{let t=e.lastIndexOf(".")+1;return t?e.substr(t):""},prePathFromPath:(e,t)=>{const r=t.split(".");let o=e,n=[];return r.pop(),r.forEach(e=>{if(o=(o||{})[e]){let t=o.__compat?"?c":utils.hasChildren(o)?"?g":"?y";n.push(t+e)}}),n.join("?R.")+"?R."},featureName:e=>(featureNames||(featureNames=(new Map).set("worker_support",`${text.availableInHint} ?cWorker?R`).set("sharedarraybuffer_support",`?cSAB?R ${text.asBuffer}`).set("new_required",`${text.missing} ?cnew?R ${text.throws}`).set("svg_support",`${text.supportIn} SVG`).set("textarea_support",`${text.supportOn} ?c<text-area>?R`).set("SharedArrayBuffer_as_param",`?cSAB?R ${text.asParam}`).set("cors_support",`?cCORS?R ${text.support}`)),e.endsWith("_without_new_throws")&&(e="new_required"),featureNames.get(e)||e),isCompat:(e,t)=>{let r=utils.getPathAsObject(e,t);return r&&"object"==typeof r.__compat},hasChildren:e=>{const t=Object.keys(e);for(let r of t)if(e[r].__compat)return!0;return!1},getBrowserList:()=>({desktop:["chrome","edge","firefox","ie","opera","safari"],mobile:["chrome_android","edge_mobile","firefox_android","opera_android","safari_ios","webview_android"],ext:["nodejs","qq_android","samsunginternet_android","uc_android","uc_chinese_android"]}),getBrowserNames:()=>({chrome:{short:"C",long:"Chrome"},edge:{short:"E",long:"Edge"},firefox:{short:"F",long:"Firefox"},ie:{short:"IE",long:"IE"},opera:{short:"O",long:"Opera"},safari:{short:"S",long:"Safari"},chrome_android:{short:"Ca",long:"Chrome/A"},edge_mobile:{short:"Em",long:"Edge/mob"},firefox_android:{short:"Fa",long:"Firefox/A"},opera_android:{short:"Oa",long:"Opera/A"},safari_ios:{short:"Si",long:"Safari/iOS"},webview_android:{short:"Wa",long:"Webview/A"},nodejs:{short:"ND",long:"Node JS"},qq_android:{short:"QQ",long:"QQ/A"},samsunginternet_android:{short:"SM",long:"Samsung/A"},uc_android:{short:"UC",long:"UC/A"},uc_chinese_android:{short:"UCC",long:"UC-Ch/A"}}),cleanHTML:(e,t,r,o,n)=>(o=o||ANSI.cyan,r=r||ANSI.reset,n=n||o,e=e.replace(/<code>/gi,o).replace(/<\/code>/gi,r).replace(/<a href/gi,n+"<a href").replace(/<\/a>/gi,"</a>"+r).replace(/(<([^>]+)>)/gi,""),t&&(e=e.replace(/&lt;/gi,"<").replace(/&gt;/gi,">")),e),breakAnsiLine:(e,t)=>{const r=Math.max(72,t>>>0);let o,n=[],s=0,a=0,i=-1,l=!1,c=!1,u=0;for(;o=e[u];)l&&c&&!colorCodes.includes(o)&&(l=!1),l?("m"===o||c)&&(l=!1):""===o||"?"===o?(l=!0,c="?"===o):(" "!==o&&"\n"!==o&&"/"!==o&&"."!==o||(i=u),++s!==r&&"\n"!==o||(i<0&&(i=u),n.push(e.substring(a,i)),a=i,i=-1,s=u-a)),u++;return s&&n.push(e.substr(a)),(n=n.map(e=>e.trim())).length?n.join(lf):""},ansiLength:e=>utils.ansiFree(e).length,ansiFree:e=>{const t=new RegExp("[^m]*m|\\?[rgyobmpcwGR]","g");return e.replace(t,"")},parseColorCodes:e=>{const t={r:ANSI.red,g:ANSI.green,y:ANSI.yellow,o:ANSI.orange,b:ANSI.blue,m:ANSI.magenta,p:ANSI.purple,c:ANSI.cyan,w:ANSI.white,G:ANSI.gray,R:ANSI.reset};let r="",o=0,n=0;do{if((o=e.indexOf("?",o))>=0){r+=e.substring(n,o);let s=t[e[o+1]];"string"==typeof s?(r+=s,o++):r+=e[o],n=++o}else r+=e.substr(n)}while(o>=0);return r},entities:e=>{const t={"&nbsp;":" ","&quot;":'"',"&amp;":"&","&lt;":"<","&gt;":">"},r=new RegExp(Object.keys(t).join("|"),"gi");return e.replace(r,e=>t[e])},versionAddRem:(e,t,r=!1,o=!1)=>{let n="";return null===e&&null===t?n="?G"+char.unknown:null===e||void 0===e?n="?r"+char.no:"boolean"==typeof e?n=e?(r?"?y":"?g")+char.yes:"?r"+char.no:"string"==typeof e&&(n=(t?"?r":r?"?y":"?g")+e,t&&(n+="?R-?r"+("boolean"==typeof t?char.unknown:t),o&&"boolean"!=typeof t&&(n="["+n+">"))),n},loadMDN:function(){let e;try{e=require("../data/data.json")}catch(e){utils.err(`?r${text.criticalDataFile}?R`),process.exit(1)}return e},markMessages:e=>{const t=utils.loadMDN(),r=t.__mdncomp;if(Array.isArray(r)){r.forEach(t=>t.read=e);const o=require("path").resolve(__dirname,"../data/data.json");try{require("fs").writeFileSync(o,JSON.stringify(t),"utf-8")}catch(e){console.log("Could not update data file!",e)}}},getMessages:(e=0)=>{const t=utils.loadMDN().__mdncomp;if(Array.isArray(t)){t.sort((e,t)=>e.date>t.date?-1:e.data<t.date?1:0);const r=t.filter(t=>!t.read||e&&t.length<e).map(e=>{return`?b${new Date(+e.date).toLocaleDateString(lang,{weekday:"long",year:"numeric",month:"short",day:"numeric"})}:\n${["?g","?y","?r"][0|e.level]}${utils.breakAnsiLine(function(e){return"string"==typeof e?e:e[lang]||e["en-US"]||e.en}(e.text),options.maxChars)}`});return r.length?`?w${text.messages}:\n\n${r.join("\n")}\n\n?R${text.seeOption} ?c--read?R ${text.useOptionRead}`:null}return null},log:function(...e){1===e.length&&Array.isArray(e[0])&&(e[0]=e[0].join(lf)),console.log(utils.parseColorCodes(e.join(" ")))},err:function(...e){console.error(utils.parseColorCodes(e.join(" ")))}};module.exports=utils;