/*!
  Utils module
  Copyright (c) 2018 Epistemex
  www.epistemex.com
*/
"use strict";const _outBuffer=[],utils={buildTable:e=>{const t=[];return utils.listTopLevels(e).filter(e=>"browsers"!==e).forEach(r=>(function e(r,o,i){const a=r[o];"object"==typeof a&&Object.keys(a).forEach(r=>{"__compat"!==r&&"worker_support"!==r&&"SharedArrayBuffer_as_param"!==r&&(t.push(i+"."+r),e(a,r,i+"."+r))})})(e,r,r)),t},listTopLevels:e=>{let t=Object.keys(e),r=t.indexOf("browsers");return r>=0&&t.splice(r,1),t},getComparer:(e,t,r)=>{let o,i,a="",s="";e.startsWith("/")?(e=(i=(e=e.substr(1)).split("/"))[0],a=i[1]):t?e=function(e){let t=[],r="";e.endsWith(".")&&(r="$",e=e.substr(0,e.length-1));for(let r of e)t.push("\\^$.*+?()[]{}|".includes(r)?"\\"+r:r);return t.join(".*?")+r}(e.toLowerCase()):(e.endsWith(".")&&(e=e.substr(0,e.length-1),s="$"),e.startsWith("*")||(e="*"+e),e.endsWith("*")||s.length||(e+="*"),e=e.split("*").join(".*")+s),r&&!a.includes("i")&&(a+="i");try{o=new RegExp(e,a)}catch(e){log("Invalid regular expression:",e.message),process.exit(-1)}return o},getPathAsObject:(e,t,r)=>{let o=e;return t.split(".").forEach(e=>{o&&o[e]&&(o=o[e])}),r&&Object.keys(o).forEach(e=>{o&&o[e].__compat&&delete o[e]}),o},nameFromPath:e=>{let t=utils.getExt(e);return t.length?t:e},getExt:e=>{if("string"!=typeof e)return"";let t=e.lastIndexOf(".");return t<0?"":e.substr(++t)},prePathFromPath:(e,t)=>{let r=t.split("."),o=e,i="";return r.pop(),r.forEach(e=>{o&&(o[e].__compat&&(i+=e+"."),o=o[e])}),i.length>1?i:""},isCompat:(e,t)=>{let r=utils.getPathAsObject(e,t);return r&&"object"==typeof r.__compat},getBrowserList:()=>({desktop:["chrome","edge","firefox","ie","opera","safari"],mobile:["chrome_android","edge_mobile","firefox_android","opera_android","safari_ios","webview_android"],ext:["nodejs","qq_android","samsunginternet_android","uc_android","uc_chinese_android"]}),getBrowserShortNames:()=>({chrome:"Chrome",edge:"Edge",firefox:"Firefox",ie:"IE",opera:"Opera",safari:"Safari",chrome_android:"Chrome/A",edge_mobile:"Edge/mob",firefox_android:"Firefox/A",opera_android:"Opera/A",safari_ios:"Safari/iOS",webview_android:"Webview/A",nodejs:"Node JS",qq_android:"QQ/A",samsunginternet_android:"Samsung/A",uc_android:"UC/A",uc_chinese_android:"UC-Ch/A"}),cleanHTML:(e,t,r)=>(e=e.replace(/<code>/gi,ANSI.cyan).replace(/<\/code>/gi,r||ANSI.reset).replace(/(<([^>]+)>)/gi,""),t&&(e=e.replace(/&lt;/gi,"<").replace(/&gt;/gi,">")),e),breakAnsiLine:(e,t)=>{const r=Math.max(72,t>>>0);let o,i=[],a=0,s=0,n=-1,l=!1,d=0;for(;o=e[d];)l?"m"===o&&(l=!1):""===o?l=!0:(" "!==o&&"\n"!==o||(n=d),++a!==r&&"\n"!==o||(n<0&&(n=d),i.push(e.substring(s,n).trim()),s=n,n=-1,a=d-s)),d++;return a&&i.push(e.substr(s)),(i=i.filter(e=>e.trim())).length?i.join(lf):""},getMaxLength:e=>{let t=0;return e.forEach(e=>{let r=(utils.prePathFromPath(e)+utils.nameFromPath(e)).length;r>t&&(t=r)}),t},entities:e=>e.replace(/&nbsp;/gim," ").replace(/&quot;/gim,'"').replace(/&amp;/gim,"&").replace(/&lt;/gim,"<").replace(/&gt;/gim,">"),loadMDN:function(){let e;try{e=require("../data/data.json")}catch(e){log("Critical error: data file not found. Try running with option --fupdate to download latest snapshot."),process.exit(1)}return e},outInfo:function(e){Array.isArray(e)&&(e=e.join(lf)),console.log(e+ANSI.reset)},outStore:function(e,t){Array.isArray(e)&&(e=e.join(lf)),t||!options.out?console.log(e):_outBuffer.push(e)}};module.exports=utils;