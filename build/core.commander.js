const EventEmitter=require("events").EventEmitter,basename="mdncomp";function Option(t,n){this.flags=t,this.required=t.indexOf("<")>=0,this.optional=t.indexOf("[")>=0,this.bool=-1===t.indexOf("-no-"),(t=t.split(/[ ,|]+/)).length>1&&!/^[[<]/.test(t[1])&&(this.short=t.shift()),this.long=t.shift(),this.description=n||""}function Command(t=""){this.commands=[],this.options=[],this._allowUnknownOption=!1,this._args=[],this._name=t}function camelcase(t){return t.split("-").reduce(function(t,n){return t+n[0].toUpperCase()+n.slice(1)})}function pad(t,n){let e=Math.max(0,n-t.length);return t+Array(e+1).join(" ")}function outputHelpIfNecessary(t,n){n=n||[];for(let e=0;e<n.length;e++)"--help"!==n[e]&&"-h"!==n[e]||(t.outputHelp(),process.exit(0))}function humanReadableArgName(t){const n=t.name+(!0===t.variadic?"...":"");return t.required?"<"+n+">":"["+n+"]"}Option.prototype={name:function(){return this.long.replace("--","").replace("no-","")},attributeName:function(){return camelcase(this.name())},is:function(t){return this.short===t||this.long===t}},Command.prototype={option:function(t,n,e,i){let o=this,s=new Option(t,n),r=s.name(),a=s.attributeName();if("function"!=typeof e)if(e instanceof RegExp){let t=e;e=function(n,e){let i=t.exec(n);return i?i[0]:e}}else i=e,e=null;return(!s.bool||s.optional||s.required)&&(s.bool||(i=!0),void 0!==i&&(o[a]=i,s.defaultValue=i)),this.options.push(s),this.on("option:"+r,function(t){null!==t&&e&&(t=e(t,void 0===o[a]?i:o[a])),"boolean"==typeof o[a]||void 0===o[a]?o[a]=null==t?!!s.bool&&(i||!0):t:null!==t&&(o[a]=t)}),this},parse:function(t){this.rawArgs=t,this._name=this._name||basename;let n=this.parseOptions(this.normalize(t.slice(2)));return this.args=n.args,this.parseArgs(this.args,n.unknown)},normalize:function(t){let n,e,i,o=[];for(let s=0,r=t.length;s<r;++s){if(n=t[s],s>0&&(e=this.optionFor(t[s-1])),"--"===n){o=o.concat(t.slice(s));break}e&&e.required?o.push(n):n.length>1&&"-"===n[0]&&"-"!==n[1]?n.slice(1).split("").forEach(function(t){o.push("-"+t)}):/^--/.test(n)&&~(i=n.indexOf("="))?o.push(n.slice(0,i),n.slice(i+1)):o.push(n)}return o},parseArgs:function(t,n){let e;return t.length?(e=t[0],this.listeners("command:"+e).length?this.emit("command:"+t.shift(),t,n):this.emit("command:*",t)):(outputHelpIfNecessary(this,n),n.length>0&&this.unknownOption(n[0]),0===this.commands.length&&0===this._args.filter(function(t){return t.required}).length&&this.emit("command:*")),this},optionFor:function(t){for(let n=0,e=this.options.length;n<e;++n)if(this.options[n].is(t))return this.options[n]},parseOptions:function(t){let n,e,i,o=[],s=t.length,r=[];for(let a=0;a<s;++a)if(i=t[a],n)o.push(i);else if("--"!==i)if(e=this.optionFor(i))if(e.required){if(null==(i=t[++a]))return this.optionMissingArgument(e);this.emit("option:"+e.name(),i)}else e.optional?(null==(i=t[a+1])||"-"===i[0]&&"-"!==i?i=null:++a,this.emit("option:"+e.name(),i)):this.emit("option:"+e.name());else i.length>1&&"-"===i[0]?(r.push(i),a+1<t.length&&"-"!==t[a+1][0]&&r.push(t[++a])):o.push(i);else n=!0;return{args:o,unknown:r}},optionMissingArgument:function(t,n){err(),n?err(`  ?y${text.optionError}:?w ${text.optionOption} "?c${t.flags}?w" ${text.optionArgMissing}, ${text.optionGot} "${n}"?R`):err(`  ?y${text.optionError}:?w ${text.optionOption} "?c${t.flags}?w" ${text.optionArgMissing}?R`),err(),process.exit(1)},unknownOption:function(t){this._allowUnknownOption||(err(),err(`  ?y${text.optionError}:?w ${text.optionUnknownOption} "?c${t}?w"?R`),err(),process.exit(1))},version:function(t,n){if(0===arguments.length)return this._version;this._version=t;let e=new Option(n=n||"-V, --version",text.optionOutputVersion);return this._versionOptionName=e.long.substr(2)||"version",this.options.push(e),this.on("option:"+this._versionOptionName,function(){process.stdout.write(t+"\n"),process.exit(0)}),this},description:function(t,n){return 0===arguments.length?this._description:(this._description=t,this._argsDescription=n,this)},usage:function(t){let n=this._args.map(function(t){return humanReadableArgName(t)}),e=`[${lang.options}]`+(this._args.length?" "+n.join(" "):"");return 0===arguments.length?this._usage||e:(this._usage=t,this)},name:function(t){return 0===arguments.length?this._name:(this._name=t,this)},prepareCommands:function(){return this.commands.filter(function(t){return!t._noHelp}).map(function(t){let n=t._args.map(function(t){return humanReadableArgName(t)}).join(" ");return[t._name+(t._alias?"|"+t._alias:"")+(t.options.length?` [${lang.options}]`:"")+(n?" "+n:""),t._description]})},largestCommandLength:function(){return this.prepareCommands().reduce(function(t,n){return Math.max(t,n[0].length)},0)},largestOptionLength:function(){let t=[].slice.call(this.options);return t.push({flags:"-h, --help"}),t.reduce(function(t,n){return Math.max(t,n.flags.length)},0)},largestArgLength:function(){return this._args.reduce(function(t,n){return Math.max(t,n.name.length)},0)},padWidth:function(){let t=this.largestOptionLength();return this._argsDescription&&this._args.length&&this.largestArgLength()>t&&(t=this.largestArgLength()),this.commands&&this.commands.length&&this.largestCommandLength()>t&&(t=this.largestCommandLength()),t},optionHelp:function(){let t=this.padWidth();return this.options.map(function(n){return"?c"+function(t){let n=t.indexOf("<");return n>=0?t.substr(0,n)+"?y"+t.substr(n):(n=t.indexOf("["))>=0?t.substr(0,n)+"?g"+t.substr(n):t}(pad(n.flags,t))+"?R  "+n.description+(n.bool&&void 0!==n.defaultValue?` (?y${text.optionDefault}: ${n.defaultValue}?R)`:"")}).concat(["?c"+pad("-h, --help",t)+"?R  "+text.optionOutputUsage]).join("\n")},helpInformation:function(){let t=[];if(this._description){t=["  ?b"+this._description,"?R"];let n=this._argsDescription;if(n&&this._args.length){let e=this.padWidth();t.push("  "+text.optionArguments+":"),t.push(""),this._args.forEach(function(i){t.push("    ?c"+pad(i.name,e)+"?R  "+n[i.name])}),t.push("")}}let n=this._name;this._alias&&(n=n+"|"+this._alias);const e=["","  ?C"+text.optionUsage+": ?w"+n+" ?g"+this.usage()+"?R","  ?C"+text.optionUsage+": ?wbcd ?g"+this.usage()+"?R",""],i=["  ?w"+text.optionOptions+":?R","",""+this.optionHelp().replace(/^/gm,"    "),""];return e.concat(t).concat(i).join(lf)},outputHelp:function(t){t||(t=function(t){return t}),log(t(this.helpInformation())),this.emit("--help")},help:function(t){this.outputHelp(t),process.exit()}},require("util").inherits(Command,EventEmitter),exports=module.exports=new Command,exports.Command=Command,exports.Option=Option;