const EventEmitter=require("events").EventEmitter,basename="mdncomp",basename2="bcd";function Option(t,n){this.flags=t,this.required=t.indexOf("<")>=0,this.optional=t.indexOf("[")>=0,this.bool=-1===t.indexOf("-no-"),(t=t.split(/[ ,|]+/)).length>1&&!/^[[<]/.test(t[1])&&(this.short=t.shift()),this.long=t.shift(),this.description=n||""}function Command(t=""){this.options=[],this._allowUnknownOption=!1,this._args=[],this._name=t}function camelcase(t){return t.split("-").reduce((t,n)=>t+n[0].toUpperCase()+n.slice(1))}function pad(t,n){return t.padEnd(n)}function outputHelpIfNecessary(t,n){n=n||[];for(let i of n)"--help"!==i&&"-h"!==i||(t.outputHelp(),process.exit())}function humanReadableArgName(t){const n=t.name;return t.required?"<"+n+">":"["+n+"]"}Option.prototype={name:function(){return this.long.replace("--","").replace("no-","")},attributeName:function(){return camelcase(this.name())},is:function(t){return this.short===t||this.long===t}},Command.prototype={option:function(t,n,i,e){const o=new Option(t,n),s=o.name(),r=o.attributeName();if("function"!=typeof i)if(i instanceof RegExp){const t=i;i=function(n,i){const e=t.exec(n);return e?e[0]:i}}else e=i,i=null;return(!o.bool||o.optional||o.required)&&(o.bool||(e=!0),void 0!==e&&(this[r]=e,o.defaultValue=e)),this.options.push(o),this.on("option:"+s,t=>{null!==t&&i&&(t=i(t,void 0===this[r]?e:this[r])),"boolean"==typeof this[r]||void 0===this[r]?this[r]=null==t?!!o.bool&&(e||!0):t:null!=t&&(this[r]=t)}),this},parse:function(t){this._name=basename;const n=this.parseOptions(this.normalize(t.slice(2)));return this.args=n.args,this.parseArgs(n.args,n.unknown)},normalize:function(t){const n=[];let i,e,o;for(let s=0;s<t.length;++s){if(i=t[s],s>0&&(e=this.optionFor(t[s-1])),"--"===i){n.push(...t.slice(s));break}e&&e.required?n.push(i):i.length>1&&"-"===i[0]&&"-"!==i[1]?i.slice(1).split("").forEach(t=>n.push("-"+t)):/^--/.test(i)&&~(o=i.indexOf("="))?n.push(i.slice(0,o)[0],i.slice(o+1)[0]):n.push(i)}return n},parseArgs:function(t,n){return t.length||(outputHelpIfNecessary(this,n),n.length&&this.unknownOption(n[0])),this},optionFor:function(t){for(let n of this.options)if(n.is(t))return n},parseOptions:function(t){const n=[],i=[];let e,o,s;for(let r=0;r<t.length;++r)if(s=t[r],e)n.push(s);else if("--"!==s)if(o=this.optionFor(s))if(o.required){if(null==(s=t[++r]))return this.optionMissingArgument(o);this.emit("option:"+o.name(),s)}else o.optional?(null==(s=t[r+1])||"-"===s[0]&&"-"!==s?s=null:++r,this.emit("option:"+o.name(),s)):this.emit("option:"+o.name());else s.length>1&&"-"===s[0]?(i.push(s),r+1<t.length&&"-"!==t[r+1][0]&&i.push(t[++r])):n.push(s);else e=!0;return{args:n,unknown:i}},optionMissingArgument:function(t,n){err(),n?err(`  ?y${text.optionError}:?w ${text.optionOption} "?c${t.flags}?w" ${text.optionArgMissing}, ${text.optionGot} "${n}"?R`):err(`  ?y${text.optionError}:?w ${text.optionOption} "?c${t.flags}?w" ${text.optionArgMissing}?R`),err(),process.exit(1)},unknownOption:function(t){this._allowUnknownOption||(err(),err(`  ?y${text.optionError}:?w ${text.optionUnknownOption} "?c${t}?w"?R`),err(),process.exit(1))},version:function(t,n){if(!arguments.length)return this._version;this._version=t;const i=new Option(n=n||"-v, --version",text.optionOutputVersion);return this._versionOptionName=i.long.substr(2)||"version",this.options.push(i),this.on("option:"+this._versionOptionName,()=>{log(t),process.exit(0)}),this},description:function(t,n){return arguments.length?(this._description=t,this._argsDescription=n,this):this._description},usage:function(t){const n=this._args.map(t=>humanReadableArgName(t)),i=`[${lang.options}]${this._args.length?" "+n.join(" "):""}`;return arguments.length?(this._usage=t,this):this._usage||i},name:function(t){return arguments.length?(this._name=t,this):this._name},largestOptionLength:function(){return[{flags:"-h, --help"}].concat(this.options).reduce((t,n)=>Math.max(t,n.flags.length),0)},largestArgLength:function(){return this._args.reduce((t,n)=>Math.max(t,n.name.length),0)},padWidth:function(){const t=this.largestArgLength(),n=this.largestOptionLength();return this._argsDescription&&this._args.length&&t>n?t:n},optionHelp:function(){const t=this.padWidth();return this.options.map(n=>{const i=n.bool&&void 0!==n.defaultValue?` (?g${text.optionDefault}: ${JSON.stringify(n.defaultValue)}?R)`:"";return`?c${function(t){let n=t.indexOf("<");return n>=0?t.substr(0,n)+"?y"+t.substr(n):(n=t.indexOf("["))>=0?t.substr(0,n)+"?g"+t.substr(n):t}(pad(n.flags,t))}?R  ${n.description}${i}`}).concat([`?c${pad("-h, --help",t)}?R  ${text.optionOutputUsage}`]).join("\n")},helpInformation:function(){const t=[];if(this._description&&!this.minihelp){t.push("  ?b"+this._description,"?R");const n=this._argsDescription;if(n&&this._args.length){const i=this.padWidth();t.push("  "+text.optionArguments+":",""),this._args.forEach(e=>{t.push(`    ?c${pad(e.name,i)}?R  ${n[e.name]}`)}),t.push("")}}const n=this.minihelp?[""]:["","  ?C"+text.optionUsage+`: ?wmdncomp ?g${this.usage()}?R`,"  ?C"+text.optionUsage+`: ?wbcd ?g${this.usage()}?R`,""],i=this.minihelp?[""+this.optionHelp().replace(/^/gm,"  ")]:["  ?w"+text.optionOptions+":?R","",""+this.optionHelp().replace(/^/gm,"    "),""];return n.concat(t).concat(i).join(lf)},outputHelp:function(t){t||(t=(t=>t)),log(t(this.helpInformation())),this.emit("--help")},help:function(t){this.outputHelp(t),process.exit()}},require("util").inherits(Command,EventEmitter),exports=module.exports=new Command,exports.Command=Command,exports.Option=Option;