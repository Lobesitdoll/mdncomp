"use strict";const utils=loadModule("core.utils"),mdn=utils.loadMDN();function format(t,e=!1,s,o){const r=utils.getPathAsObject(mdn,t);r.__compat||utils.hasChildren(r)||(err(utils.breakAnsiLine(`?y${errText.notFeatureObject}?R`,options.maxChars)),process.exit());const n=/<a\s+(?:[^>]*?\s+)?href=(["'])(.*?)\1/,i=utils.getBrowserList(),a=r.__compat||{},l=a.support||{},p=a.status||{},d=a.mdn_url&&a.mdn_url.length?("https://developer.mozilla.org/docs/"+a.mdn_url).replace(".org/docs/Mozilla/Add-ons/",".org/Add-ons/"):null,u=options.specs&&a.specs||[],c=r.SharedArrayBuffer_as_param&&options.sab&&!e?format(t+".SharedArrayBuffer_as_param",!0):null,h=r.worker_support&&options.workers&&!e?format(t+".worker_support",!0):null,m=t.startsWith("webextensions"),f=t.startsWith("javascript"),_={isCompat:"object"==typeof r.__compat,path:t,prePath:utils.prePathFromPath(mdn,t),name:utils.nameFromPath(t),description:a.description||"",short:(a.short||"").replace("â†’","-&gt;"),url:d,specs:u,experimental:p.experimental,standard:p.standard_track||e&&m,deprecated:p.deprecated,browsers:{desktop:[],mobile:[],ext:[]},notes:[],links:[],children:[],sab:c,workers:h};if(options.desktop&&i.desktop.forEach(t=>{_.browsers.desktop.push(x(t,l))}),options.mobile&&i.mobile.forEach(t=>{_.browsers.mobile.push(x(t,l))}),options.ext&&i.ext.filter(t=>!!f||"nodejs"!==t).forEach(t=>{_.browsers.ext.push(x(t,l))}),options.children&&!e){const e=options.args.length?options.args.map(t=>utils.getComparer(t,!(t.includes("*")||t.startsWith("/")),!0)):null,s=options.history;options.history=!1,Object.keys(r).forEach(s=>{const o=r[s].__compat;if(o){const r=o.status||{};if(options.obsolete||m||(r.experimental||r.standard_track||r.deprecated)&&!r.deprecated){const o=t+"."+s;e&&!function(t,e){for(let s of e)if(s.test(t))return!0}(s,e)||_.children.push(format(o,!0,_.notes,_.links))}}}),options.history=s}function x(t,e){const r=[],i=[];e=e[t]||{};let a=Array.isArray(e)?e:[e];options.history||(a=[a[0]]);const l=s||_.notes,p=o||_.links;return a.forEach(t=>{const e=[];if(options.notes&&(t.notes||t.prefix||t.alternative_name||t.partial_implementation)){const s=Array.isArray(t.notes)?t.notes:t.notes?[t.notes]:[];t.prefix&&s.push(text.vendorPrefix+t.prefix),t.alternative_name&&s.push(text.versionColumn+utils.ansiFree(utils.versionAddRem(t.version_added,t.version_removed))+text.usesAltName+t.alternative_name),t.partial_implementation&&s.push(text.partialImpl),s.forEach(t=>{let s=function(t,e){for(let s=0;s<e.length;s++)if(e[s].note===t)return e[s].index;return-1}(t,l);if(s<0){s=l.length,l.push({index:s,note:t});let e=t.match(n);e&&p.push({index:s,url:e[e.length-1]})}i.push(s),e.push(s)})}(options.history||!options.history&&!r.length)&&r.push({add:t.version_added,removed:t.version_removed||null===t.version_added&&null,prefix:t.prefix,altName:t.alternative_name,flags:t.flags||[],partial:t.partial_implementation,notes:e})}),{browser:t,history:r,noteIndex:i.sort()}}return _}module.exports=format;