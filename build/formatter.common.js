"use strict";const utils=loadModule("core.utils"),mdn=utils.loadMDN();function format(t,e=!1,s,o){const r=utils.getPathAsObject(mdn,t);if(!r.__compat&&!utils.hasChildren(r))return err(utils.breakAnsiLine(`?y${text.notFeatureObject}?R`,options.maxChars)),process.exitCode=1,null;const n=utils.getBrowserList();if(options.columns){const t=options.columns.split(/[ ,;:]/g),s=Object.keys(utils.getBrowserShortNames()),o=t.filter(t=>s.includes(t));if(o.length&&o.length===t.length)n.desktop=n.desktop.filter(t=>o.includes(t)),n.mobile=n.mobile.filter(t=>o.includes(t)),n.ext=n.ext.filter(t=>o.includes(t));else if(!e)return err(`\n?y${text.invalidColumnIds}?R`),process.exitCode=1,null}const i=/<a\s+(?:[^>]*?\s+)?href=(["'])(.*?)\1/,a=r.__compat||{},l=a.support||{},p=a.status||{},d=a.mdn_url&&a.mdn_url.length?("https://developer.mozilla.org/docs/"+a.mdn_url).replace(".org/docs/Mozilla/Add-ons/",".org/Add-ons/"):null,u=a.specs||[],c=r.SharedArrayBuffer_as_param&&options.sab&&!e?format(t+".SharedArrayBuffer_as_param",!0):null,h=r.worker_support&&options.worker&&!e?format(t+".worker_support",!0):null,m=t.startsWith("webextensions"),f=t.startsWith("javascript"),x={isCompat:"object"==typeof r.__compat,path:t,prePath:utils.prePathFromPath(mdn,t),name:utils.nameFromPath(t),description:a.description||"",short:(a.short||"").replace("â†’","-&gt;"),url:d,specs:u,experimental:p.experimental,standard:p.standard_track||e&&m,deprecated:p.deprecated,browsers:{desktop:[],mobile:[],ext:[]},notes:[],links:[],children:[],sab:c,workers:h,isFiltered:!1};if(options.desktop&&n.desktop.length&&n.desktop.forEach(t=>{x.browsers.desktop.push(_(t,l))}),options.mobile&&n.mobile.length&&n.mobile.forEach(t=>{x.browsers.mobile.push(_(t,l))}),options.ext&&n.ext.length&&n.ext.filter(t=>!!f||"nodejs"!==t).forEach(t=>{x.browsers.ext.push(_(t,l))}),options.children&&!e){const e=options.args.length?options.args.map(t=>utils.getComparer(t,!(t.includes("*")||t.startsWith("/")),!0)):null;x.isFiltered=!!e;const s=options.history;options.history=!1,Object.keys(r).forEach(s=>{const o=r[s].__compat;if(o){const r=o.status||{};if(options.obsolete||m||(r.experimental||r.standard_track||r.deprecated)&&!r.deprecated){const o=t+"."+s;e&&!function(t,e){for(let s of e)if(s.test(t))return!0}(s,e)||x.children.push(format(o,!0,x.notes,x.links))}}}),options.history=s}function _(t,e){const r=[],n=[],a=e[t]||{};let l=Array.isArray(a)?a:[a];options.history||(l=[l[0]]);const p=s||x.notes,d=o||x.links;return l.forEach(t=>{const e=[];if(options.notes&&(t.notes||t.prefix||t.alternative_name||t.partial_implementation)){const s=Array.isArray(t.notes)?t.notes:t.notes?[t.notes]:[];t.prefix&&s.push(text.vendorPrefix+t.prefix),t.alternative_name&&s.push(text.versionColumn+utils.ansiFree(utils.versionAddRem(t.version_added,t.version_removed))+text.usesAltName+t.alternative_name),t.partial_implementation&&s.push(text.partialImpl),s.forEach(t=>{let s=function(t,e){for(let s=0;s<e.length;s++)if(e[s].note===t)return e[s].index;return-1}(t,p);if(s<0){s=p.length,p.push({index:s,note:t});let e=t.match(i);e&&d.push({index:s,url:e[e.length-1]})}n.push(s),e.push(s)})}(options.history||!options.history&&!r.length)&&r.push({add:t.version_added,removed:t.version_removed||null===t.version_added&&null,prefix:t.prefix,altName:t.alternative_name,flags:t.flags||[],partial:t.partial_implementation,notes:e})}),{browser:t,history:r,noteIndex:n.sort()}}return x}module.exports=format;