const utils=loadModule("core.utils"),mdn=utils.loadMDN();let hasFeatures=!1,hasParent=!1,hasBranch=!1;function list(t,e=!1){if("string"==typeof t&&t.length&&"."!==t)if(["deprecated","experimental","standard"].includes(t)){const n=listOnStatus(t,e);n.length>1?s(n):log(n)}else{let n=listAPI(t,e);1===n.length&&utils.isCompat(mdn,n[0])?(options.list=void 0,listAPI(n[0])):n.length>1&&s(n)}else log(`?R${text.valid} ${text.pathRoots}:`),log(`?g${utils.getRootList(mdn).join(lf)}?R`),log(lf+`${text.valid} ${text.statuses}:`),log("?gstandard, experimental, deprecated?R");function s(t){if(options.index>-1){if(options.index<0||options.index>=t.length)return void err(text.indexOutOfRange);let e=t[options.index].split(" "),s=e[e.length-1].replace(/\?./g,"");options.index=-1,list(s,!0)}else if(log(t),!options.expert){const t=[];hasFeatures&&t.push(`?c${char.feature}?R = ${text.listFeature}`),hasParent&&t.push(`?g${char.parent}?R = ${text.listParent}`),hasBranch&&t.push(`?y${char.branch}?R = ${text.listBranch}`),t.length&&log(utils.breakAnsiLine(lf+t.join(", "),options.maxChars))}}}function listAPI(t,e=!1){const s=options.caseSensitive?t:t.toLowerCase(),n=utils.bcdToList(mdn),i=s.split(".").length+1;let a="";return n.filter(t=>{if((options.caseSensitive?t:t.toLowerCase()).startsWith(s)&&t.split(".").length<=i&&t!==a)return a=t}).sort().map((t,s,n)=>{const i=utils.getPathAsObject(mdn,t);let a,o;i.__compat?(hasFeatures=!0,a="?c",o=char.feature):utils.hasChildren(i)?(hasParent=!0,a="?g",o=char.parent):(hasBranch=!0,a="?y",o=char.branch);const l=e?"":"?y[?g"+(s+"").padStart(Math.log10(n.length)+1)+"?y]?R ";if(a.length){const e=t.split(".");return e[e.length-1]=a+e[e.length-1]+"?R",`${l}${a}${o}?R ${e.join(".")}`}return`${l}${o} ${t}`})}function listOnStatus(t,e=!1){const s=[];"standard"===t&&(t+="_track"),utils.getRootList(mdn).filter(t=>"webextensions"!==t).forEach(e=>(function e(n,i,a){const o=n[i];"object"==typeof o&&Object.keys(o).filter(t=>"__compat"!==t).forEach(n=>{(function(e){if(e){const s=e.status||{};return!!s[t]}})(o[n].__compat)&&s.push(a+"."+n),e(o,n,a+"."+n)})})(mdn,e,e));const n="deprecated"===t?"?r":"experimental"===t?"?y":"?g",i=Math.log10(s.length)+1;return s.sort().map((t,s)=>{const a=e?"":"?y[?g"+(s+"").padStart(i)+"?y]?R ",o=t.lastIndexOf(".")+1;return`?R${a}${t.substr(0,o)+n+t.substr(o)}`})}module.exports=list;