const utils=loadModule("core.utils"),mdn=utils.loadMDN();let hasFeatures=!1,hasParent=!1,hasBranch=!1;function list(t,e=!1){if("string"==typeof t&&t.length&&"."!==t&&"?"!==t)if(["deprecated","experimental","standard"].includes(t)){const n=listOnStatus(t,e);n.length>1?s(n):log(n)}else{let n=listAPI(t,e);1===n.length&&!options.args.length&&utils.isCompat(mdn,n[0])?(options.list=void 0,listAPI(n[0])):(n.length>0||options.args.length)&&s(n)}else log(),log(`?R${text.valid} ${text.pathRoots}:`),log(`?g${utils.getRootList(mdn).join(lf)}?R`+lf),log(`${text.valid} ${text.statuses}:`),log("?gstandard, experimental, deprecated?R"),log();function s(t){if(options.index>-1){if(options.index<0||options.index>=t.length)return void err(text.indexOutOfRange);let e=t[options.index].split(" "),s=e[e.length-1].replace(/\?./g,"");options.index=-1,list(s,!0)}else{if(log(),log(t),!options.expert){const t=[];hasFeatures&&t.push(`?c${char.feature}?R = ${text.listFeature}`),hasParent&&t.push(`?g${char.parent}?R = ${text.listParent}`),hasBranch&&t.push(`?y${char.branch}?R = ${text.listBranch}`),t.length&&log(utils.breakAnsiLine(lf+t.join(", "),options.maxChars))}log()}}}function listAPI(t,e=!1){const s=options.caseSensitive?t:t.toLowerCase(),n=utils.bcdToList(mdn),o=s.split(".").length+1,i=[];options.args.forEach(t=>{i.push(utils.getComparer(t,options.fuzzy,!options.caseSensitive))});let a="";return n.filter(t=>{if((options.caseSensitive?t:t.toLowerCase()).startsWith(s)&&t.split(".").length<=o&&t!==a)return a=t}).filter(t=>!i.length||utils.testFilters(i,t)).sort().map((t,s,n)=>{const o=utils.getPathAsObject(mdn,t);let i,a;o.__compat?(hasFeatures=!0,i="?c",a=char.feature):utils.hasChildren(o)?(hasParent=!0,i="?g",a=char.parent):(hasBranch=!0,i="?y",a=char.branch);const l=e?"":`?y[?g${(s+"").padStart(Math.log10(n.length)+1)}?y]?R `;if(i.length){const e=t.split(".");return e[e.length-1]=i+e[e.length-1]+"?R",`${l}${i}${a}?R ${e.join(".")}`}return`${l}${a} ${t}`})}function listOnStatus(t,e=!1){const s=[];"standard"===t&&(t+="_track"),utils.getRootList(mdn).filter(t=>"webextensions"!==t).forEach(e=>(function e(n,o,i){const a=n[o];"object"==typeof a&&Object.keys(a).filter(t=>"__compat"!==t).forEach(n=>{(function(e){if(e){const s=e.status||{};return!!s[t]}})(a[n].__compat)&&s.push(i+"."+n),e(a,n,i+"."+n)})})(mdn,e,e));const n="deprecated"===t?"?r":"experimental"===t?"?y":"?g",o=Math.log10(s.length)+1;return s.sort().map((t,s)=>{const i=e?"":`?y[?g${(s+"").padStart(o)}?y]?R `,a=t.lastIndexOf(".")+1;return`?R${i}${t.substr(0,a)+n+t.substr(a)}`})}module.exports=list;