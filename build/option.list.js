/*!
  List option module
  Copyright (c) 2018 Epistemex
  www.epistemex.com
 */
const utils=require("./core.utils"),mdn=utils.loadMDN(),outInfo=utils.outInfo,ANSI=global.ANSI,lf=global.lf;function listAPI(t,e){const s=e?t:t.toLowerCase(),n=utils.buildTable(mdn),l=[],o=s.split(".").length+1;let i,r="";n.forEach(t=>{(i=e?t:t.toLowerCase()).startsWith(s)&&t.split(".").length<=o&&t!==r&&l.push(r=t)});let a=t.lastIndexOf(".")+1;return l.forEach((t,e)=>{let s=t.lastIndexOf(".")+1;l[e]=ANSI.reset+(a?t.substr(0,a)+ANSI.cyan+(s>a?t.substring(a,s)+ANSI.white+t.substr(s):t.substr(a)):t)}),l}function listOnStatus(t){const e=[],s=utils.listTopLevels(mdn);function n(e){return!!(e.__compat.status||{})[t]}"standard"===t&&(t="standard_track"),s.forEach(t=>{let s=mdn[t];s.__compat&&n(s)&&e.push(t),Object.keys(mdn[t]).forEach(s=>{let l=mdn[t][s];l.__compat&&n(l)&&e.push(t+"."+s),Object.keys(mdn[t][s]).forEach(l=>{let o=mdn[t][s][l];l.__compat&&n(o)&&e.push(t+"."+s+"."+l)})})});let l="deprecated"===t?ANSI.red:"experimental"===t?ANSI.yellow:ANSI.green;return e.forEach((t,s)=>{let n=t.lastIndexOf(".")+1;e[s]=ANSI.reset+t.substr(0,n)+l+t.substr(n)}),e.sort()}function list(t){if("string"==typeof t&&t.length&&"."!==t)if(["deprecated","experimental","standard"].includes(t))outInfo(listOnStatus(t));else{let e=listAPI(t,options.caseSensitive);1===e.length&&utils.isCompat(mdn,e[0])?(options.list=void 0,listAPI(e[0],options.caseSensitive)):outInfo(e)}else outInfo(ANSI.reset+"Valid path roots:"),outInfo(ANSI.green+utils.listTopLevels(mdn).join(lf)+ANSI.reset),outInfo(lf+"Valid statuses:"),outInfo(ANSI.green+"standard, experimental, deprecated"+ANSI.reset)}module.exports=list;