const utils=loadModule("core.utils"),mdn=utils.loadMDN();let hasFeatures=!1,hasSubFeatures=!1,hasParent=!1,hasBranch=!1;function list(t,e=!1){if("string"==typeof t&&t.length&&"."!==t&&"?"!==t)if(["deprecated","experimental","standard"].includes(t)){const n=listOnStatus(t,e);n.length>1||options.args.length?s(n):log(n)}else{let n=listAPI(t,e);1===n.length&&!options.args.length&&utils.isCompat(mdn,n[0])?(options.list=void 0,listAPI(n[0])):(n.length>0||options.args.length)&&s(n)}else log(),log(`?R${text.valid} ${text.pathRoots}:`),log(`?g${utils.getRootList(mdn).join(lf)}?R`+lf),log(`${text.valid} ${text.statuses}:`),log("?gstandard, experimental, deprecated?R"),log();function s(t){if(options.index>-1){if(options.index<0||options.index>=t.length)return void err(text.indexOutOfRange);let e=t[options.index].split(" "),s=e[e.length-1].replace(/\?./g,"");options.index=-1,list(s,!0)}else{if(log(),log(t),options.expert<2){const t=[];hasFeatures&&t.push(`?c${char.feature}?R = ${text.listFeature}`),hasSubFeatures&&t.push(`?m${char.subFeature}?R = ${text.listSubFeature}`),hasParent&&t.push(`?g${char.parent}?R = ${text.listParent}`),hasBranch&&t.push(`?y${char.branch}?R = ${text.listBranch}`),t.length&&log(utils.breakAnsiLine(lf+t.join(", "),options.maxChars))}log()}}}function listAPI(t,e=!1){const s=options.caseSensitive?t:t.toLowerCase(),n=utils.bcdToList(mdn),o=s.split(".").length+1,i=[];options.args.forEach(t=>{i.push(utils.getComparer(t,options.fuzzy,!options.caseSensitive))});let a="";return n.filter(t=>{if((options.caseSensitive?t:t.toLowerCase()).startsWith(s)&&t.split(".").length<=o&&t!==a)return a=t}).filter(t=>!i.length||utils.testFilters(i,t)).sort().map((t,s,n)=>{const o=utils.getPathAsObject(mdn,t);let i,a;o.__compat?o.__compat.title?(hasSubFeatures=!0,i="?m",a=char.subFeature):(hasFeatures=!0,i="?c",a=char.feature):utils.hasChildren(o)?(hasParent=!0,i="?g",a=char.parent):(hasBranch=!0,i="?y",a=char.branch);const r=e?"":`?y[?g${(s+"").padStart(Math.log10(n.length)+1)}?y]?R `;if(i.length){const e=t.split(".");return e[e.length-1]=i+e[e.length-1]+"?R",`${r}${i}${a}?R ${e.join(".")}`}return`${r}${a} ${t}`})}function listOnStatus(t,e=!1){const s=[],n=[];"standard"===t&&(t+="_track"),options.args.forEach(t=>{n.push(utils.getComparer(t,options.fuzzy,!options.caseSensitive))}),utils.getRootList(mdn).filter(t=>"webextensions"!==t).forEach(e=>(function e(o,i,a){const r=o[i];"object"==typeof r&&Object.keys(r).filter(t=>"__compat"!==t).forEach(o=>{(function(e){if(e){const s=e.status||{};return!!s[t]}})(r[o].__compat)&&(n.length&&!utils.testFilters(n,a+"."+o)||s.push(a+"."+o)),e(r,o,a+"."+o)})})(mdn,e,e));const o="deprecated"===t?"?r":"experimental"===t?"?y":"?g",i=Math.log10(s.length)+1;return s.sort().map((t,s)=>{const n=e?"":`?y[?g${(s+"").padStart(i)}?y]?R `,a=t.lastIndexOf(".")+1;return`?R${n}${t.substr(0,a)+o+t.substr(a)}`})}module.exports=list;