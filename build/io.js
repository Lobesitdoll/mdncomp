const ANSI=require("./ansi"),https=require("https"),fs=require("fs"),path=require("path");module.exports={request:function(e,t,r,n,o){let s;function a(e,t){o?o({statusCode:e.statusCode,error:t}):log("Error",e,t)}t=t||function(){return!0},https.get(e,e=>{let i="";if(s=e,301===e.statusCode||302===e.statusCode)return this.request(e.headers.location,t,r,n,o);if(200===e.statusCode&&t({headers:e.headers})){let t=0|e.headers["content-length"];e.on("data",e=>{i+=e,r&&r(t?i.length/t:i.length%7/7)}).on("end",()=>{n(i)})}else o&&a(e,"")}).on("error",e=>a(s,e)).end()},run:function(e){return require("opn")(e)},exist:function(e){return fs.existsSync(e)},getConfigRootPath:function(){let e="win32"===process.platform?path.resolve(process.env.APPDATA,"../../"):process.env.HOME;return"darwin"===process.platform?require("path").resolve(e,"/Library/Preferences"):e},getConfigPath:function(){return path.resolve(this.getConfigRootPath(),".mdncomp")},getConfigDataPath:function(){let e=this.getConfigPath();t(e);for(let r=0;r<arguments.length;r++)t(e=path.resolve(e,arguments[r]));function t(e){if(!fs.existsSync(e))try{fs.mkdirSync(e)}catch(t){log(`${ANSI.red}Could not create config folder:\n${e}\n${t.message}${ANSI.reset}`)}}return e},getCachedFilename:function(e){return path.resolve(this.getConfigDataPath("cache"),this.calcMD5(e))},getCachedData:function(e){let t=null;try{t=fs.readFileSync(this.getCachedFilename(e)).toString()}catch(e){}return t},setCachedData:function(e,t){let r=this.getCachedFilename(e);try{fs.writeFileSync(r,t)}catch(e){log(ANSI.red+"Could not save file: "+r+ANSI.reset+lf+e)}},writeAll:function(e,t){let r=[],n=e.length,o=!1;for(let t of e)fs.writeFile(t.path,t.data,"utf8",e=>{s({path:t.path,err:e})});function s(e){r.push(e),e.err&&(o=!0),--n||t(r,o)}},calcMD5:function(e){return require("crypto").createHash("md5").update(e).digest("hex")+""}};