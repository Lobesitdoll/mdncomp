/*!
	mdncomp (version: see package.json)
	Copyright (c) 2018 Epistemex
	www.epistemex.com
*/
"use strict";module.exports=init,String.prototype.padStart||(String.prototype.padStart=function(e,t){return e>>=0,t=String(void 0!==t?t:" "),this.length>e?String(this):((e-=this.length)>t.length&&(t+=t.repeat(e/t.length)),t.slice(0,e)+String(this))}),String.prototype.padEnd||(String.prototype.padEnd=function(e,t){return e>>=0,t=String(void 0!==t?t:" "),this.length>e?String(this):((e-=this.length)>t.length&&(t+=t.repeat(e/t.length)),String(this)+t.slice(0,e))}),String.prototype.includes||(String.prototype.includes=function(e,t){return-1!==this.indexOf(e,0|t)}),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(t>>>0,e.length)===e}),String.prototype.endsWith||(String.prototype.endsWith=function(e,t){return(void 0===t||t>this.length)&&(t=this.length),this.substring(t-e.length,t)===e}),String.prototype.repeat||(String.prototype.repeat=function(e){if(e>>>=0,!this.length||!e)return"";if(this.length*e>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");let t="";for(let o=0;o<e;o++)t+=this;return t}),Array.prototype.includes||(Array.prototype.includes=function(e){return this.indexOf(e)>=0}),String.prototype.centerAnsi=function(e){let t=e-this.ansiLength()>>>1,o=" ".repeat(t)+this+" ".repeat(t);return" ".substr(0,e-o.ansiLength())+o},String.prototype.ansiLength=function(){return this.ansiFree().length},String.prototype.ansiFree=function(){return this.replace(/\x1b[^m]*m/g,"")};const ANSI=require("./ansi"),version=require("../package.json").version,args=process.argv,log=console.log.bind(console),saves=[],lf="\r\n",yes="Y",no="-";let mdn,io,cfg,util,crypto,options,isoLang="en-US",shortPad=1,sepChar="|";function buildTable(){const e=[];return listTopLevels().forEach(t=>{"browsers"!==t&&function t(o,r,n){const s=o[r];"object"==typeof s&&Object.keys(s).forEach(o=>{"__compat"!==o&&"worker_support"!==o&&"SharedArrayBuffer_as_param"!==o&&(e.push(n+"."+o),t(s,o,n+"."+o))})}(mdn,t,t)}),e}function listTopLevels(){let e=Object.keys(mdn),t=e.indexOf("browsers");return t>=0&&e.splice(t,1),e}function getComparer(e,t,o){let r,n,s="",i="";e.startsWith("/")?(e=(n=(e=e.substr(1)).split("/"))[0],s=n[1]):t?e=function(e){let t=[],o="";e.endsWith(".")&&(o="$",e=e.substr(0,e.length-1));for(let o of e)t.push("\\^$.*+?()[]{}|".includes(o)?"\\"+o:o);return t.join(".*?")+o}(e.toLowerCase()):(e.endsWith(".")&&(e=e.substr(0,e.length-1),i="$"),e.startsWith("*")||(e="*"+e),e.endsWith("*")||i.length||(e+="*"),e=e.split("*").join(".*")+i),o&&!s.includes("i")&&(s+="i");try{r=new RegExp(e,s)}catch(e){log("Invalid regular expression:",e.message),process.exit(-1)}return r}function getPathAsObject(e,t){let o=e.split("."),r=mdn;return o.forEach(e=>{r&&r[e]&&(r=r[e])}),t&&Object.keys(r).forEach(e=>{r&&r[e].__compat&&delete r[e]}),r}function nameFromPath(e){let t=getExt(e);return t.length?t:e}function getExt(e){if("string"!=typeof e)return"";let t=e.lastIndexOf(".");return t<0?"":e.substr(++t)}function prePathFromPath(e){let t=e.split("."),o=mdn,r="";return t.pop(),t.forEach(e=>{o&&(o[e].__compat&&(r+=e+"."),o=o[e])}),r.length>1?r:""}function isCompat(e){let t=getPathAsObject(e);return!!t&&"object"==typeof t.__compat}function cleanHTML(e,t,o){return e=e.replace(/<code>/gi,ANSI.cyan).replace(/<\/code>/gi,o||ANSI.reset).replace(/(<([^>]+)>)/gi,""),t&&(e=e.replace(/&lt;/gi,"<").replace(/&gt;/gi,">")),e}function breakAnsiLine(e,t){let o,r=[],n=0,s=0,i=0,a=-1,l=!1,p=Math.max(72,t>>>0);for(;o=e[n];)l?"m"===o&&(l=!1):""===o?l=!0:(" "!==o&&"\n"!==o||(a=n),++s!==p&&"\n"!==o||(a<0&&(a=n),r.push(e.substring(i,a).trim()),i=a,a=-1,s=n-i)),n++;return s&&r.push(e.substr(i)),r.forEach((e,t)=>{r[t]=e.trim()}),r.length?r.join(lf):""}function getMaxLength(e){let t=0;return e.forEach(e=>{let o=(prePathFromPath(e)+nameFromPath(e)).length;o>t&&(t=o)}),t}function entities(e){return e.replace(/&nbsp;/gim," ").replace(/&quot;/gim,'"').replace(/&amp;/gim,"&").replace(/&lt;/gim,"<").replace(/&gt;/gim,">")}function parseHelp(e){if(e.length<4)log(),log("  Examples:"),log("    mdncomp arcTo                   show information for arcTo"),log("    mdncomp html*toblob.            will find HTMLCanvasElement.toBlob"),log("    mdncomp -z hctbb.               will find HTMLCanvasElement.toBlob (fuzzy)"),log("    mdncomp --list .                list all top-level paths"),log();else{let t="-h"===e[2].toLowerCase()||"--help"===e[2].toLowerCase()?e[3]:e[2],o=require("./help").help[t];log(),log(`${ANSI.yellow}Help for option "${t}"${ANSI.reset}`),log(o||"Unknown option."),log()}}const fs=require("fs"),path=require("path");function init(){3===args.length&&"--configpath"===args[2]?log(ANSI.white+require("./io").getConfigPath()+ANSI.reset):args.length>=3&&args.length<=4&&("--update"===args[2]||"--fupdate"===args[2]||"--cupdate"===args[2])?require("./update")("--fupdate"===args[2],"--cupdate"===args[2]):((options=require("commander")).version(version,"-v, --version").usage("[options] <feature>").description("Get MDN Browser Compatibility Data, docs and specs."+lf+"  Version: "+version+lf+"  (c) 2018 epistemex.com").option("-l, --list","List paths starting with the given value or '.' for top-level").option("-o, --out <path>","Save information to file. Use extension for type (.txt or .ansi)").option("-x, --overwrite","Overwrites an existing file with --out option").option("-d, --desktop","Show desktop only").option("-m, --mobile","Show mobile devices only").option("-c, --case-sensitive","Search in case-sensitive mode").option("-a, --all","If search results in more than entry, show info for all").option("-z, --fuzzy","Use path as a fuzzy search term").option("-i, --index <index>","Show this index from a multiple result list",-1).option("-s, --shorthand","Show compatibility as shorthand with multiple results").option("-h, --split","Split a shorthand line into two lines (use with -s)").option("-b, --browser","Show information about this browser, or list if '.'").option("-W, --no-workers","Don't show worker support information.").option("-N, --no-notes","Don't show notes").option("-e, --noteend","Show notes at end instead of in sections (text)").option("-f, --markdown","Format link as markdown and turns off colors").option("--ext","Show extended table of browsers/servers").option("--desc","Show Short description of the feature").option("--specs","Show specification links").option("--sab","Show support for SharedArrayBuffer as param.").option("--doc","Show documentation. Show cached or fetch").option("--docforce","Show documentation. Force fetch from MDN server").option("--mdn","Open entry's document URL in default browser").option("--waitkey","Wait for ENTER key before continuing").option("--random","Show a random entry. (mdncomp --random . )").option("--update, --fupdate, --cupdate","Update data from remote (--f*=force, --c*=check)").option("--no-colors","Don't use colors in output").option("--max-chars <width>","Max number of chars per line before wrap",72).option("--no-config","Ignore config file (mdncomp.json) in config folder").option("--configpath","Show path to where config file and cache is stored").action(go).on("--help",()=>{parseHelp(args)}).parse(args),options.args.length||options.help())}function outInfo(e){Array.isArray(e)&&(e=e.join(lf)),log(e+ANSI.reset)}function outStore(e,t){Array.isArray(e)&&(e=e.join(lf)),t||!options.out?log(e):saves.push(e)}function go(e){io=require("./io"),"string"!=typeof e&&(e=".");try{mdn=require("../data/data.json")}catch(e){log("Critical error: data file not found. Try running with option --fupdate to download latest snapshot."),process.exit(2)}try{loadConfig()}catch(e){}if(options.desktop&&options.mobile&&(options.desktop=options.mobile=!1),options.colors&&!options.markdown&&"txt"!==getExt(options.out||".ansi")||Object.keys(ANSI).forEach(e=>{e.includes("ursor")||(ANSI[e]="")}),options.random&&(e=randomCompat(e),options.index=0),options.list)if("."===e)outInfo(ANSI.reset+"Valid path roots:"),outInfo(ANSI.green+listTopLevels().join(lf)+ANSI.reset),outInfo(lf+"Valid statuses:"),outInfo(ANSI.green+"standard, experimental, deprecated"+ANSI.reset);else if(["deprecated","experimental","standard"].includes(e))outInfo(listOnStatus(e));else{let t=list(e,options.caseSensitive);1===t.length&&isCompat(t[0])?(options.list=void 0,go(t[0])):outInfo(t)}else if(options.browser)"."===e?(outInfo(ANSI.reset+"Valid browser identifiers:"),outInfo(ANSI.green+listBrowsers().join(lf)+ANSI.reset),outInfo(lf+"Valid statuses:"),outInfo(ANSI.green+getBrowserStatusList().join(", "))):outInfo(listBrowser(e.toLowerCase()).join(lf));else{let o=search(e,options.caseSensitive);if(o.length)if(1===o.length||options.index>=0&&options.index<o.length||options.all){if(options.shorthand&&(shortPad=getMaxLength(o)),options.index>=0&&options.index<o.length&&(o=o.splice(options.index,1)),o.forEach(e=>{!function(e){let t=new MDNComp(e);outStore(options.shorthand?compatToShort(t,shortPad):compatToLong(t))}(e)}),1===o.length){let e=new MDNComp(o[0]);options.doc||options.docforce?e.url&&e.url.length?getDoc(e.url,t):(outInfo(ANSI.red+"Documentation URL is not defined for this feature."+ANSI.reset+lf),t()):t(),options.mdn&&(e.url.length?io.run(e.url):log("No URL is defined for this entry."))}}else{let e=(o.length+"").length;o.forEach((t,o)=>{outInfo(ANSI.yellow+"["+ANSI.green+(o+"").padStart(e)+ANSI.yellow+"] "+ANSI.white+t+ANSI.reset)})}else outInfo("Not found.");function t(){outStore(ANSI.magenta+"Data from MDN - `npm i -g mdncomp` by epistemex"+ANSI.white+lf+ANSI.reset),function(){if(options.out&&saves.length)if(fs.existsSync(options.out)&&!options.overwrite){const t=require("readline"),o=t.createInterface({input:process.stdin,output:process.stdout});o.question(ANSI.yellow+"A file with this name already exists. Overwrite? (y(es), default: no)? "+ANSI.white,t=>{t.startsWith("y")?e(()=>{o.close()}):(log("File not saved."),o.close(),process.exit())})}else e();function e(e){fs.writeFile(options.out,saves.join("\n"),"utf8",function(t){if(t)return log("An error occurred:"+lf+t);log(ANSI.green+`Saved output to file "${ANSI.cyan+options.out+ANSI.green}"!`+ANSI.reset),e&&e()})}}(),options.waitkey&&(console.log(ANSI.cursorUp+ANSI.cursorUp),setTimeout(()=>console.log("Waiting for ENTER key..."+ANSI.cursorUp),3e3),process.stdin.on("data",()=>process.exit()))}}}function loadConfig(){const e=path.resolve(io.getConfigDataPath(),".config.json");try{let r=require(e),n=Object.assign({},r.options),s=Object.assign({},r.formatter);o(n.fuzzy)&&(options.fuzzy=n.fuzzy),o(n.colors)&&(options.colors=n.colors),o(n.notes)&&(options.notes=n.notes),o(n.noteEnd)&&(options.noteEnd=n.noteEnd),o(n.shorthand)&&(options.shorthand=n.shorthand),o(n.split)&&(options.split=n.split),o(n.caseSensitive)&&(options.caseSensitive=n.caseSensitive),o(n.desktop)&&(options.desktop=n.desktop),o(n.mobile)&&(options.mobile=n.mobile),o(n.overwrite)&&(options.overwrite=n.overwrite),o(n.markdown)&&(options.markdown=n.markdown),"number"==typeof n.maxChars&&(options.maxChars=Math.max(0,0|n.maxChars)),o(n.doc)&&(options.doc=n.doc),o(n.docforce)&&(options.docforce=n.docforce),o(n.ext)&&(options.ext=n.ext),o(n.desc)&&(options.desc=n.desc),o(n.specs)&&(options.specs=n.specs),o(n.waitkey)&&(options.waitkey=n.waitkey),o(n.workers)&&(options.workers=n.workers),o(n.sab)&&(options.sab=n.sab),s.long&&s.long.sepChar&&"string"==typeof s.long.sepChar&&1===s.long.sepChar.length&&(t=s.long.sepChar,' abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_|+*{}[];:!"#&/()=?\\.,'.includes(t))&&(sepChar=s.long.sepChar)}catch(e){}var t;function o(e){return"boolean"==typeof e}}function search(e,t){let o,r=buildTable(),n=[];return o=getComparer(e,options.fuzzy,!t),r.forEach(e=>{o.test(e)&&isCompat(e)&&n.push(e)}),n}function list(e,t){const o=t?e:e.toLowerCase(),r=buildTable(),n=[],s=o.split(".").length+1;let i,a="";r.forEach(e=>{(i=t?e:e.toLowerCase()).startsWith(o)&&e.split(".").length<=s&&e!==a&&n.push(a=e)});let l=e.lastIndexOf(".")+1;return n.forEach((e,t)=>{let o=e.lastIndexOf(".")+1;n[t]=ANSI.reset+(l?e.substr(0,l)+ANSI.cyan+(o>l?e.substring(l,o)+ANSI.white+e.substr(o):e.substr(l)):e)}),n}function listOnStatus(e){const t=[],o=listTopLevels();function r(t){return!!(t.__compat.status||{})[e]}"standard"===e&&(e="standard_track"),o.forEach(e=>{let o=mdn[e];o.__compat&&r(o)&&t.push(e),Object.keys(mdn[e]).forEach(o=>{let n=mdn[e][o];n.__compat&&r(n)&&t.push(e+"."+o),Object.keys(mdn[e][o]).forEach(n=>{let s=mdn[e][o][n];n.__compat&&r(s)&&t.push(e+"."+o+"."+n)})})});let n="deprecated"===e?ANSI.red:"experimental"===e?ANSI.yellow:ANSI.green;return t.forEach((e,o)=>{let r=e.lastIndexOf(".")+1;t[o]=ANSI.reset+e.substr(0,r)+n+e.substr(r)}),t.sort()}function listBrowsers(){return Object.keys(mdn.browsers)}function listBrowser(e){const t=mdn.browsers[e],o=[];if(!t)return getBrowserStatusList().includes(e)?listBrowserOnStatus(e):["Unknown browser-id: '"+e+"' - Use '.' to list all valid IDs."];let r=0,n=0;Object.keys(t.releases).forEach(e=>{let t=e.split(".");t[0].length>r&&(r=t[0].length),e.length-t[0].length>n&&(n=e.length-t[0].length)});let s=0;return getBrowserStatusList().forEach(e=>{e.length>s&&(s=e.length)}),Object.keys(t.releases).sort(function(e,t){let o=e.split("."),r=t.split("."),n=(0|o[0])+.001*(0|o[1])+1e-6*(0|o[2])+1e-9*(0|o[3]),s=(0|r[0])+.001*(0|r[1])+1e-6*(0|r[2])+1e-9*(0|r[3]);return n>s?1:n<s?-1:0}).forEach(i=>{let a=ANSI.white+(t.name||e)+"  "+ANSI.green+_fBrowserVersion(i,r,n),l=t.releases[i].release_date,p=t.releases[i].release_notes,d=t.releases[i].status;a+="  "+(l?ANSI.cyan+l:ANSI.gray+"-         "),a+="  "+(d?_browserStatusColor(d)+d.padEnd(s)+(options.notes&&p?"  "+ANSI.reset+p:"")+ANSI.reset+ANSI.white:"-"),o.push(a+ANSI.white)}),o}function listBrowserOnStatus(e){let t=[],o=_browserStatusColor(e),r=_iterateBrowsers((t,o,r,n,s)=>{let i=t.release_date;return t.status&&t.status===e?{browser:s||o,version:r,notes:t.release_notes,date:i||"-"}:null}),n=0,s=0,i=0;return r.forEach(e=>{let t=e.version.split(".");e.browser.length>n&&(n=e.browser.length),t[0].length>s&&(s=t[0].length),e.version.length-t[0].length>i&&(i=e.version.length-t[0].length)}),t.push(ANSI.reset+"STATUS: "+ANSI.reset+ANSI.white+o+e.toUpperCase()+ANSI.reset),r.forEach(e=>{t.push(ANSI.white+e.browser.padEnd(n)+ANSI.white+"  "+o+_fBrowserVersion(e.version,s,i)+ANSI.white+ANSI.dim+"  "+("-"===e.date?ANSI.gray:ANSI.reset+ANSI.bright+ANSI.cyan)+e.date+(options.notes&&e.notes&&e.notes.length?"  "+ANSI.reset+e.notes:"")+ANSI.reset)}),t}function getBrowserStatusList(){return _iterateBrowsers((e,t,o,r)=>r.includes(e.status)?null:e.status).sort()}function _browserStatusColor(e){switch(e){case"retired":return ANSI.red;case"beta":case"alpha":return ANSI.yellow;case"nightly":return ANSI.blue;case"current":case"esr":return ANSI.green;case"planned":return ANSI.magenta;default:return ANSI.white}}function _iterateBrowsers(e){const t=mdn.browsers,o=[];return Object.keys(t).forEach(r=>{let n=t[r].name;Object.keys(t[r].releases).forEach(s=>{let i=e(t[r].releases[s],r,s,o,n);i&&o.push(i)})}),o}function _fBrowserVersion(e,t,o){let r=e.split(".");return r[0].padStart(t)+r.join(".").substr(r[0].length).padEnd(o)}const tagParser=require("./tagparser");function getDoc(e,t){let o=ANSI.clrToCursor+ANSI.cursorUp,r=io.getCachedData(e);if(r&&!options.docforce)log(),a(r);else{log(ANSI.green+"Fetching documentation...");let r=e.replace("mozilla.org/","mozilla.org/"+isoLang+"/")+"?raw&macros";io.request(r,()=>!s(),e=>{let t=Math.round(50*e),r=50-t;log(o+ANSI.white+"Downloading doc "+ANSI.white+"["+ANSI.green+"#".repeat(t)+" ".repeat(r)+ANSI.white+"]"+ANSI.reset+ANSI.black)},e=>{let t,o,r=['id="wikiArticle"',"</section>"],n=['id="Example','id="Specification','id="Browser_compatibility'];for(let o of r)if((t=e.indexOf(o))>=0)break;if(t<0)log("Cannot parse this documentation source.");else{for(let r of n)if((o=e.indexOf(r,t))>=0)break;o<0&&(o=e.length),i(e=e.substring(e.lastIndexOf("<",t),e.lastIndexOf("<",o)))}},e=>{n=lf+"An error occurred -"+lf+"Status code: "+e.statusCode+(e.error?lf+"Message: "+e.error:"")+ANSI.reset,log(o+ANSI.red+n+ANSI.white),t()})}var n;function s(){log(o+"".padStart(options.maxChars," "))}function i(t){s(),log(ANSI.cursorUp+ANSI.cursorUp);let o=ANSI.reset+t,r="#LF#",n=!1,i=0;o=o.replace(/\t/gm," ");let l=!1;const p=/=.*brush:\s?(html)/i,d=/.*class=.*optionalInline/i,c=/.*class=.*(experimental|deprecated)/i;function h(e,t,o){return t.test(e.substring(o.tagStart,o.tagEnd))}o="#"+(o=(o=(o=(o=entities(o=tagParser(o,e=>{switch(e.name){case"div":return h(o,c,e)&&(tagParser.skip=!0),"";case"/div":return n||(tagParser.skip=!1),"";case"span":return h(o,d,e)&&(l=!0),l?ANSI.white+" ("+ANSI.green:"";case"/span":let t="";return!n&&l&&(l=!1,t=ANSI.white+") "+ANSI.reset),t;case"table":return tagParser.skipLF=!0,ANSI.gray+"--LINE--"+ANSI.reset+r;case"/table":return tagParser.skipLF=!1,ANSI.gray+"--LINE--"+ANSI.reset+r;case"math":return tagParser.skip=!0,ANSI.blue+" --math formula not shown--"+ANSI.reset;case"section":return tagParser.skip=!0,"";case"/math":case"/section":return tagParser.skip=!1,"";case"/th":case"/td":return"\t";case"/tr":return r;case"dl":case"ul":return tagParser.skipLF=!0,r;case"/dl":case"/ul":return tagParser.skipLF=!1,"";case"br":case"/p":return r;case"h2":case"h3":case"h4":return r+ANSI.yellow;case"/h2":case"/h3":case"/h4":case"/dt":return ANSI.reset+r;case"/dd":case"/li":return i--,ANSI.reset+r;case"pre":return n=!0,h(o,p,e)&&(tagParser.skip=!0),tagParser.skip?"":ANSI.blue+"--LINE--"+ANSI.cyan+r;case"/pre":let s=tagParser.skip?"":r+ANSI.blue+"--LINE--"+ANSI.reset+r;return n=tagParser.skip=!1,s;case"code":return ANSI.cyan;case"/code":return ANSI.reset;case"dt":return ANSI.white+"*".repeat(Math.max(0,i+1))+ANSI.reset+" ";case"dd":case"li":return i++,ANSI.white+"-".repeat(Math.max(0,i))+ANSI.reset+" ";default:return""}},e=>n&&"\n"===e?r:e))).replace(/\n\s*\n/gim,"")).replace(new RegExp(r,"gm"),lf)).replace(lf+lf+ANSI.blue+"--LINE--",lf+ANSI.blue+"--LINE--")),io.setCachedData(e,o),a(o)}function a(e){if(!e.startsWith("#"))return void i(e);e=e.substr(1);let o="-".repeat(options.maxChars-1),r=(e=e.replace(/--LINE--/gm,o)).split(lf),n=-1;function s(t,o){let r="",n=e.indexOf(t),s=t.length;n>=0&&n<10&&(n=options.maxChars-s-2>>1,r=ANSI.red+"/".repeat(n-1)+o+" "+t.toUpperCase()+" "+ANSI.red+"/".repeat(n)+ANSI.reset+lf,e=r+e.substr(n+s+1))}e="",r.forEach((t,o)=>{let s=/\s\s+/g;if(n<0&&t.includes("\t")){let e,t;for(e=o;e<r.length&&(t=r[e]).includes("\t");e++)(t=t.split("\t")[0].trim()).length>n&&(n=t.length);n++}if(t.includes("\t")){let e=t.split("\t");t=ANSI.white+(e[0].trim().padEnd(n)+ANSI.reset+(e[1].trim()||"")),s="x79y"}else n>0&&(n=-1);e+=breakAnsiLine(t.replace(s," ").trim(),options.maxChars).trim()+lf}),s("Draft",ANSI.yellow),s("Obsolete",ANSI.red),e=ANSI.reset+e.trim()+lf,options.colors||(e=e.replace(/\x1b[^m]*m/gm,"")),outStore(e),t()}}function randomCompat(e,t){let o,r,n,s=buildTable(),i=[];for("."!==e&&(n=getComparer(e,options.fuzzy,!t),s.forEach(e=>{n.test(e)&&i.push(e)}),s=i);!o;)if((o=isCompat(s[r=Math.random()*s.length|0]))&&(options.doc||options.docforce||options.desc)){let e=getPathAsObject(s[r]).__compat;e.mdn_url&&e.mdn_url.length||(o=!1)}return s[r]}function compatToLong(e,t){let o=new Output(0),r=["chrome","edge","firefox","ie","opera","safari"],n=["chrome_android","edge_mobile","firefox_android","opera_android","safari_ios","webview_android"],s=["nodejs","qq_android","samsunginternet_android","uc_android","uc_chinese_android"],i=["°","¹","²","³","ª","^","`","'",'"',"'\"",'""','""\'',"º"],a=" %0----------+-----------+-----------+-----------+-----------+-----------".replace(/\+/g,sepChar),l=0,p=[];if(o.addLine(ANSI.reset),t){let t=e.getStatus();t.length&&o.addLine(t.substring(1,t.length-1)+lf)}else{if(options.markdown&&e.url?o.addLine(" [`%0%1`](%2) %3",e.prePath,e.name,e.url,e.getStatus()):(o.addLine(" %0%1%2%3%4 %5",ANSI.cyan,e.prePath,ANSI.white,e.name,ANSI.white,e.getStatus()),o.addLine(" ",e.url?ANSI.gray+e.url:"-")),e.short&&e.short.length){let t=entities(ANSI.reset+" "+breakAnsiLine(cleanHTML(e.short),options.maxWidth));o.addLine(t,lf)}else o.addLine();if(options.desc&&e.description&&e.description.length){let t=entities(ANSI.reset+breakAnsiLine(cleanHTML(e.description),options.maxWidth));o.addLine(t,lf)}}function d(t){t.forEach(t=>{let r,n=e.getBrowser(t);n?(r=n.info[0].getVersion(),n.hasNotes()&&(r+=ANSI.yellow+(options.notes?i[l]:"*"),p.push(n.getNotes(i[l])),l=++l%i.length),"?"===r&&(r=ANSI.yellow+"?")):r=ANSI.red+no,o.add("%0"+r.centerAnsi(11)+ANSI.gray+"|",r.indexOf(no)>=0?ANSI.red:ANSI.green)}),o.trimEnd(1)}return options.mobile||(o.addLine(" %0Chrome    %1|%0 Edge      %1|%0 Firefox   %1|%0 IE        %1|%0 Opera     %1|%0 Safari%1",ANSI.white,ANSI.gray),o.addLine(a,ANSI.gray),d(r),o.addLine(lf),!options.noteend&&options.notes&&p.length&&o.addLine(ANSI.yellow+p.join("")),options.noteend||(p=[],l=0)),options.desktop||(o.addLine(" %0Chrome/A  %1|%0 Edge/mob  %1|%0 Firefox/A %1|%0 Opera/A   %1|%0Safari/iOS %1|%0 %0Webview/A%1",ANSI.white,ANSI.gray),o.addLine(a,ANSI.gray),d(n),o.addLine(lf),!options.noteend&&options.notes&&p.length&&o.addLine(ANSI.yellow+p.join(""))),options.ext&&(o.addLine(" %0Node JS   %1|%0 QQ/A      %1|%0 Samsung/A %1|%0 UC/A      %1|%0 UC-Ch/A%1",ANSI.white,ANSI.gray),o.addLine(a.substr(0,a.length-12),ANSI.gray),d(s),o.addLine(lf),options.notes&&p.length&&o.addLine(ANSI.yellow+p.join(""))),options.workers&&e.workers&&(o.addLine(ANSI.cyan+"WEB WORKER SUPPORT:"),o.add(compatToLong(e.workers,!0)+lf)),options.sab&&e.sharedAB&&(o.addLine(ANSI.cyan+"SHAREDARRAYBUFFER AS PARAM SUPPORT:"),o.add(compatToLong(e.sharedAB,!0)+lf)),options.specs&&e.specs&&e.specs.length&&(o.addLine(ANSI.cyan+"SPECIFICATIONS:"+lf),e.specs.forEach(e=>{o.addLine(ANSI.white+`${entities(e.name)}${lf}  ${function(e){switch(e.toUpperCase()){case"REC":return ANSI.green+"Recommendation"+ANSI.reset+lf;case"PR":return ANSI.yellow+"Proposed Recommendation"+ANSI.reset+lf;case"CR":return ANSI.cyan+"Candidate Recommendation"+ANSI.reset+lf;case"RC":return ANSI.cyan+"Release Candidate"+ANSI.reset+lf;case"WD":return ANSI.blue+"Working Draft"+ANSI.reset+lf;case"ED":return ANSI.green+"Editor's Draft"+ANSI.reset+lf;case"OLD-TRANSFORMS":return ANSI.orange+"This has been merged in another draft."+ANSI.reset+lf;case"LIVING":return ANSI.cyan+"Living Standard"+ANSI.reset+lf;case"RFC":return ANSI.yellow+"IETF RFC"+ANSI.reset+lf;case"STANDARD":return ANSI.green+"Standard"+ANSI.reset+lf;case"DRAFT":return ANSI.yellow+"Draft"+ANSI.reset+lf;case"OBSOLETE":return ANSI.red+"Obsolete"+ANSI.reset+lf;case"LC":return ANSI.yellow+"Last Call Working Draft"+ANSI.reset+lf;default:return ANSI.yellow+e+ANSI.reset+lf}}(e.status)}  ${e.url}`)}),o.addLine()),o.trimEnd(lf.length),o.toString()}function compatToShort(e,t){let o=e.prePath+e.name,r=new Output(0),n=["chrome","edge","firefox","ie","opera","safari"],s=["chrome_android","firefox_android","edge_mobile","opera_android","safari_ios","android"],i=["nodejs","qq_android","samsunginternet_android","uc_android","uc_chinese_android"],a=["C:","E:","F:","IE:","O:","S:"],l=["CA:","FA:","EM:","OA:","Si:","WA:"],p=["ND:","QQ:","SM:","UC:","UCC:"];function d(t,o){t.forEach((t,n)=>{let s,i=e.getBrowser(t);i?(s=i.info[0].getVersion(),i.hasNotes()&&(s+=ANSI.white+"*")):s=ANSI.red+no,r.add(ANSI.green,o[n],ANSI.white,s," ")})}return r.add(ANSI.white),options.split?r.add(o,":",lf):r.add(o.padEnd(t),":"),options.mobile||(r.add(ANSI.cyan+"  D: "),d(n,a)),options.desktop||(r.add(ANSI.cyan+"  M: "),d(s,l)),options.ext&&(r.add(ANSI.cyan+"  X: "),d(i,p)),r.trimEnd(1),r.toString()}function MDNComp(e){let t=getPathAsObject(e),o=t.__compat,r=["webview_android","chrome","chrome_android","edge","edge_mobile","firefox","firefox_android","ie","opera","opera_android","safari","safari_ios"],n=[!1,!0,!1,!0,!1,!0,!1,!0,!0,!1,!0,!1],s=o.status||{},i=Object.keys(o.support);this.path=e,this.prePath=prePathFromPath(e),this.name=nameFromPath(e),this.url=o.mdn_url&&o.mdn_url.length?("https://developer.mozilla.org/docs/"+o.mdn_url).replace(".org/docs/Mozilla/Add-ons/",".org/Add-ons/"):null,this.specs=o.specs||[],this.experimental=s.experimental,this.standard=s.standard_track,this.deprecated=s.deprecated,this.browsers=[],this.description=o.description||"",this.short=(o.short||"").replace("→","-&gt;"),this.sharedAB=t.SharedArrayBuffer_as_param?new MDNComp(e+".SharedArrayBuffer_as_param"):null,this.workers=t.worker_support?new MDNComp(e+".worker_support"):null,i.forEach(e=>{let t=r.indexOf(e);if(t>=0){let r=new Browser(o,e);r.isDesktop=n[t],this.browsers.push(r)}})}function Info(e){this.added=this.toStatus(e.version_added),this.removed=this.toStatus(e.version_removed),this.notes=e.notes?Array.isArray(e.notes)?e.notes:[e.notes]:[],this.flags=e.flags||[],e.prefix&&this.notes.unshift("Prefix: "+e.prefix),e.partial_implementation&&this.notes.unshift("Is partial implementation."),e.alternative_name&&this.notes.unshift("Uses a non-standard name: "+e.alternative_name),this.flags.forEach(e=>{this.notes.push(this.flagToString(e,ANSI.yellow))})}function Browser(e,t){this.name=t,this.info=[];let o=e.support[t];Array.isArray(o)||(o=[o]),this.prefix=(o[o.length-1]||{}).prefix||"",o.forEach(e=>{this.info.push(new Info(e))})}function Output(e){this.string="",this.indent="    ".substr(0,0|e),this.linefeed=lf}MDNComp.prototype={getBrowser:function(e){for(let t of this.browsers)if(t.name===e)return t;return null},getStatus:function(){let e="(";return this.deprecated?e+=ANSI.red+"Deprecated"+ANSI.reset+", ":(this.experimental&&(e+=ANSI.yellow+"Experimental"+ANSI.reset+", "),this.standard&&(e+=ANSI.green+"On Standard Track"+ANSI.reset+", ")),"()"===(e=e.substr(0,Math.max(1,e.length-2))+")")?"":e},hasFlags:function(){for(let e of this.browsers)if(e.hasFlags())return!0;return!1}},Info.prototype={getVersion:function(){return this.removed?this.added+"-"+this.removed.replace("Y","?"):this.added},flagToString:function(e,t){switch(e.type){case"preference":return o("Behind flag "+ANSI.cyan);case"compile_flag":return o("Compile with "+ANSI.cyan);case"runtime_flag":return o("Run with "+ANSI.cyan)}function o(o){return o+e.name+(t||ANSI.reset)+(e.value_to_set?" set to "+e.value_to_set:"")+"."}return""},toString:function(e){let t=(e?e+") ":"")+(isNaN(this.added)?"":this.getVersion()+": "),o="",r=new Output(0);return this.notes.length?(this.notes.length>1&&(t+=lf,o="- "),this.notes.forEach(e=>{r.addLine(cleanHTML(o+e,!0,ANSI.yellow))}),t+r.toString()):""},toStatus:function(e){return"boolean"==typeof e?e?"Y":no:null===e?"?":e||null}},Browser.prototype={hasNotes:function(){for(let e of this.info)if(e.notes.length)return!0;return!1},hasFlags:function(){for(let e of this.info)if(e.flags.length)return!0;return!1},hasPrefix:function(){return this.prefix.length},getNotes:function(e){let t=new Output(0);return this.info.forEach(o=>{let r=breakAnsiLine(o.toString(e),options.maxChars);r.length&&t.addLine(r)}),t.toString()}},Output.prototype={add:function(e){if(e=e||"",arguments.length>1){let t=e.indexOf("%0")>=0;for(let o=1;o<arguments.length;o++){let r=new RegExp("%"+(o-1),"g");e=t?e.replace(r,arguments[o]):e+arguments[o]}}this.string+=this.indent+(e||"")},addLine:function(e){this.add.apply(this,arguments),this.string+=this.linefeed},trimEnd:function(e){this.string=this.string.substr(0,Math.max(0,this.string.length-e))},replace:function(e,t){let o=new RegExp(e,"g");this.string=this.string.replace(o,t)},toString:function(){return this.string}};