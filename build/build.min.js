/*!
	mdncomp (version: see package.json)
	Copyright (c) 2018 Epistemex
	www.epistemex.com
*/
"use strict";module.exports=init,String.prototype.padStart||(String.prototype.padStart=function(e,t){return e>>=0,t=String(void 0!==t?t:" "),this.length>e?String(this):((e-=this.length)>t.length&&(t+=t.repeat(e/t.length)),t.slice(0,e)+String(this))}),String.prototype.padEnd||(String.prototype.padEnd=function(e,t){return e>>=0,t=String(void 0!==t?t:" "),this.length>e?String(this):((e-=this.length)>t.length&&(t+=t.repeat(e/t.length)),String(this)+t.slice(0,e))}),String.prototype.includes||(String.prototype.includes=function(e,t){return-1!==this.indexOf(e,0|t)}),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(t>>>0,e.length)===e}),String.prototype.endsWith||(String.prototype.endsWith=function(e,t){return(void 0===t||t>this.length)&&(t=this.length),this.substring(t-e.length,t)===e}),String.prototype.repeat||(String.prototype.repeat=function(e){if(e>>>=0,!this.length||!e)return"";if(this.length*e>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");let t="";for(let o=0;o<e;o++)t+=this;return t}),Array.prototype.includes||(Array.prototype.includes=function(e){return this.indexOf(e)>=0}),String.prototype.centerAnsi=function(e){let t=e-this.ansiLength()>>>1,o=" ".repeat(t)+this+" ".repeat(t);return" ".substr(0,e-o.ansiLength())+o},String.prototype.ansiLength=function(){return this.ansiFree().length},String.prototype.ansiFree=function(){return this.replace(/\x1b[^m]*m/g,"")};const ANSI=require("./ansi"),version=require("../package.json").version,args=process.argv,log=console.log.bind(console),saves=[],lf="\r\n",yes="Y",no="-";let mdn,io,cfg,util,crypto,options,isoLang="en-US",shortPad=1;function buildTable(){const e=[];return listTopLevels().forEach(t=>{"browsers"!==t&&function t(o,n,r){const s=o[n];"object"==typeof s&&Object.keys(s).forEach(o=>{"__compat"!==o&&(e.push(r+"."+o),t(s,o,r+"."+o))})}(mdn,t,t)}),e}function listTopLevels(){let e=Object.keys(mdn),t=e.indexOf("browsers");return t>=0&&e.splice(t,1),e}function getComparer(e,t,o){let n,r,s="",i="";e.startsWith("/")?(e=(r=(e=e.substr(1)).split("/"))[0],s=r[1]):t?e=function(e){let t=[],o="";e.endsWith(".")&&(o="$",e=e.substr(0,e.length-1));for(let o of e)t.push("\\^$.*+?()[]{}|".includes(o)?"\\"+o:o);return t.join(".*?")+o}(e.toLowerCase()):(e.endsWith(".")&&(e=e.substr(0,e.length-1),i="$"),e.startsWith("*")||(e="*"+e),e.endsWith("*")||i.length||(e+="*"),e=e.split("*").join(".*")+i),o&&!s.includes("i")&&(s+="i");try{n=new RegExp(e,s)}catch(e){log("Invalid regular expression:",e.message),process.exit(-1)}return n}function getPathAsObject(e,t){let o=e.split("."),n=mdn;return o.forEach(e=>{n&&n[e]&&(n=n[e])}),t&&Object.keys(n).forEach(e=>{n&&n[e].__compat&&delete n[e]}),n}function nameFromPath(e){let t=getExt(e);return t.length?t:e}function getExt(e){if("string"!=typeof e)return"";let t=e.lastIndexOf(".");return t<0?"":e.substr(++t)}function prePathFromPath(e){let t=e.split("."),o=mdn,n="";return t.pop(),t.forEach(e=>{o&&(o[e].__compat&&(n+=e+"."),o=o[e])}),n.length>1?n:""}function isCompat(e){let t=getPathAsObject(e);return!!t&&"object"==typeof t.__compat}function cleanHTML(e,t,o){return e=e.replace(/<code>/gi,ANSI.cyan).replace(/<\/code>/gi,o||ANSI.reset).replace(/(<([^>]+)>)/gi,""),t&&(e=e.replace(/&lt;/gi,"<").replace(/&gt;/gi,">")),e}function breakAnsiLine(e,t){let o,n=[],r=0,s=0,i=0,a=-1,l=!1,p=Math.max(72,t>>>0);for(;o=e[r];)l?"m"===o&&(l=!1):""===o?l=!0:(" "!==o&&"\n"!==o||(a=r),++s!==p&&"\n"!==o||(a<0&&(a=r),n.push(e.substring(i,a).trim()),i=a,a=-1,s=r-i)),r++;return s&&n.push(e.substr(i)),n.forEach((e,t)=>{n[t]=e.trim()}),n.length?n.join(lf):""}function getMaxLength(e){let t=0;return e.forEach(e=>{let o=(prePathFromPath(e)+nameFromPath(e)).length;o>t&&(t=o)}),t}function entities(e){return e.replace(/&nbsp;/gim," ").replace(/&quot;/gim,'"').replace(/&amp;/gim,"&").replace(/&lt;/gim,"<").replace(/&gt;/gim,">")}function parseHelp(e){if(e.length<4)log(),log("  Examples:"),log("    mdncomp arcTo                   show information for arcTo"),log("    mdncomp html*toblob.            will find HTMLCanvasElement.toBlob"),log("    mdncomp -z hctbb.               will find HTMLCanvasElement.toBlob (fuzzy)"),log("    mdncomp --list .                list all top-level paths"),log();else{let t="-h"===e[2].toLowerCase()||"--help"===e[2].toLowerCase()?e[3]:e[2],o=require("./help").help[t];log(),log(`${ANSI.yellow}Help for option "${t}"${ANSI.reset}`),log(o||"Unknown option."),log()}}const fs=require("fs"),path=require("path");function init(){3===args.length&&"--configpath"===args[2]?log(ANSI.white+require("./io").getConfigPath()+ANSI.reset):args.length>=3&&args.length<=4&&("--update"===args[2]||"--fupdate"===args[2]||"--cupdate"===args[2])?(4===args.length&&"--diff"!==args[3]&&(log(ANSI.white+"Invalid option. Needs to be: --[*]update [--diff]"+ANSI.reset),process.exit(1)),require("./update")("--fupdate"===args[2],"--cupdate"===args[2],"--diff"===args[3])):((options=require("commander")).version(version,"-v, --version").usage("[options] <feature>").description("Get MDN Browser Compatibility Data, docs and specs."+lf+"  Version: "+version+lf+"  (c) 2018 epistemex.com").option("-l, --list","List paths starting with the given value or '.' for top-level").option("-o, --out <path>","Save information to file. Use extension for type (.txt or .ansi)").option("-x, --overwrite","Overwrites an existing file with --out option").option("-d, --desktop","Show desktop only").option("-m, --mobile","Show mobile devices only").option("-c, --case-sensitive","Search in case-sensitive mode").option("-a, --all","If search results in more than entry, show info for all").option("-z, --fuzzy","Use path as a fuzzy search term").option("-i, --index <index>","Show this index from a multiple result list",-1).option("-s, --shorthand","Show compatibility as shorthand with multiple results").option("-h, --split","Split a shorthand line into two lines (use with -s)").option("-b, --browser","Show information about this browser, or list if '.'").option("-N, --no-notes","Don't show notes").option("-e, --noteend","Show notes at end instead of in sections (text)").option("-f, --markdown","Format link as markdown and turns off colors").option("--ext","Show extended table of browsers/servers").option("--desc","Show Short description of the feature").option("--specs","Show specification links").option("--doc","Show documentation. Show cached or fetch").option("--docforce","Show documentation. Force fetch from MDN server").option("--mdn","Open entry's document URL in default browser").option("--waitkey","Wait for ENTER key before continuing").option("--random","Show a random entry. (mdncomp --random . )").option("--update, --fupdate, --cupdate","Update data from remote (--fupdate=force, --cupdate=check)").option("--diff","Only valid appended to --[*]update. Shows list of new features").option("--no-colors","Don't use colors in output").option("--max-chars <width>","Max number of chars per line before wrap",72).option("--no-config","Ignore config file (mdncomp.json) in config folder").option("--configpath","Show path to where config file and cache is stored").action(go).on("--help",()=>{parseHelp(args)}).parse(args),options.args.length||options.help())}function outInfo(e){Array.isArray(e)&&(e=e.join(lf)),log(e+ANSI.reset)}function outStore(e,t){Array.isArray(e)&&(e=e.join(lf)),t||!options.out?log(e):saves.push(e)}function go(e){io=require("./io"),"string"!=typeof e&&(e=".");try{mdn=require("../data/data.json")}catch(e){log("Critical error: data file not found. Try running with option --fupdate to download latest snapshot."),process.exit(1)}try{loadConfig()}catch(e){}if(options.desktop&&options.mobile&&(options.desktop=options.mobile=!1),options.colors&&!options.markdown&&"txt"!==getExt(options.out||".ansi")||Object.keys(ANSI).forEach(e=>{e.includes("ursor")||(ANSI[e]="")}),options.random&&(e=randomCompat(e),options.index=0),options.list)if("."===e)outInfo(ANSI.reset+"Valid path roots:"),outInfo(ANSI.green+listTopLevels().join(lf)+ANSI.reset),outInfo(lf+"Valid statuses:"),outInfo(ANSI.green+"standard, experimental, deprecated"+ANSI.reset);else if(["deprecated","experimental","standard"].includes(e))outInfo(listOnStatus(e));else{let t=list(e,options.caseSensitive);1===t.length&&isCompat(t[0])?(options.list=void 0,go(t[0])):outInfo(t)}else if(options.browser)"."===e?(outInfo(ANSI.reset+"Valid browser identifiers:"),outInfo(ANSI.green+listBrowsers().join(lf)+ANSI.reset),outInfo(lf+"Valid statuses:"),outInfo(ANSI.green+getBrowserStatusList().join(", "))):outInfo(listBrowser(e.toLowerCase()).join(lf));else{let o=search(e,options.caseSensitive);if(o.length)if(1===o.length||options.index>=0&&options.index<o.length||options.all){if(options.shorthand&&(shortPad=getMaxLength(o)),options.index>=0&&options.index<o.length&&(o=o.splice(options.index,1)),o.forEach(e=>{!function(e){let t=new MDNComp(e);outStore(options.shorthand?compatToShort(t,shortPad):compatToLong(t))}(e)}),1===o.length){let e=new MDNComp(o[0]);options.doc||options.docforce?e.url.length?getDoc(e.url,t):(outInfo(ANSI.red+"Documentation URL is not defined for this feature."+ANSI.reset+lf),t()):t(),options.mdn&&(e.url.length?io.run(e.url):log("No URL is defined for this entry."))}}else{let e=(o.length+"").length;o.forEach((t,o)=>{outInfo(ANSI.yellow+"["+ANSI.green+(o+"").padStart(e)+ANSI.yellow+"] "+ANSI.white+t+ANSI.reset)})}else outInfo("Not found.");function t(){outStore(ANSI.magenta+"Data from MDN - `npm i -g mdncomp` by epistemex"+ANSI.white+lf+ANSI.reset),function(){if(options.out&&saves.length)if(fs.existsSync(options.out)&&!options.overwrite){const t=require("readline"),o=t.createInterface({input:process.stdin,output:process.stdout});o.question(ANSI.yellow+"A file with this name already exists. Overwrite? (y(es), default: no)? "+ANSI.white,t=>{t.startsWith("y")?e(()=>{o.close()}):(log("File not saved."),o.close(),process.exit())})}else e();function e(e){fs.writeFile(options.out,saves.join("\n"),"utf8",function(t){if(t)return log("An error occurred:"+lf+t);log(ANSI.green+`Saved output to file "${ANSI.cyan+options.out+ANSI.green}"!`+ANSI.reset),e&&e()})}}(),options.waitkey&&(console.log(ANSI.cursorUp+ANSI.cursorUp),setTimeout(()=>console.log("Waiting for ENTER key..."+ANSI.cursorUp),3e3),process.stdin.on("data",()=>process.exit()))}}}function loadConfig(){const e=path.resolve(io.getConfigDataPath(),".config.json");if(fs.existsSync(e)){let o=require(e);function t(e){return"boolean"==typeof e}t((o=o.options||o||{}).fuzzy)&&(options.fuzzy=o.fuzzy),t(o.colors)&&(options.colors=o.colors),t(o.notes)&&(options.notes=o.notes),t(o.noteEnd)&&(options.noteEnd=o.noteEnd),t(o.shorthand)&&(options.shorthand=o.shorthand),t(o.split)&&(options.split=o.split),t(o.caseSensitive)&&(options.caseSensitive=o.caseSensitive),t(o.desktop)&&(options.desktop=o.desktop),t(o.mobile)&&(options.mobile=o.mobile),t(o.overwrite)&&(options.overwrite=o.overwrite),t(o.markdown)&&(options.markdown=o.markdown),"number"==typeof o.maxChars&&(options.maxChars=0|o.maxChars),t(o.doc)&&(options.doc=o.doc),t(o.docforce)&&(options.docforce=o.docforce),t(o.ext)&&(options.ext=o.ext),t(o.desc)&&(options.desc=o.desc),t(o.specs)&&(options.specs=o.specs),t(o.waitkey)&&(options.waitkey=o.waitkey)}}function search(e,t){let o,n=buildTable(),r=[];return o=getComparer(e,options.fuzzy,!t),n.forEach(e=>{o.test(e)&&isCompat(e)&&r.push(e)}),r}function list(e,t){const o=t?e:e.toLowerCase(),n=buildTable(),r=[],s=o.split(".").length+1;let i,a="";n.forEach(e=>{(i=t?e:e.toLowerCase()).startsWith(o)&&e.split(".").length<=s&&e!==a&&r.push(a=e)});let l=e.lastIndexOf(".")+1;return r.forEach((e,t)=>{let o=e.lastIndexOf(".")+1;r[t]=ANSI.reset+(l?e.substr(0,l)+ANSI.cyan+(o>l?e.substring(l,o)+ANSI.white+e.substr(o):e.substr(l)):e)}),r}function listOnStatus(e){const t=[],o=listTopLevels();function n(t){return!!(t.__compat.status||{})[e]}"standard"===e&&(e="standard_track"),o.forEach(e=>{let o=mdn[e];o.__compat&&n(o)&&t.push(e),Object.keys(mdn[e]).forEach(o=>{let r=mdn[e][o];r.__compat&&n(r)&&t.push(e+"."+o),Object.keys(mdn[e][o]).forEach(r=>{let s=mdn[e][o][r];r.__compat&&n(s)&&t.push(e+"."+o+"."+r)})})});let r="deprecated"===e?ANSI.red:"experimental"===e?ANSI.yellow:ANSI.green;return t.forEach((e,o)=>{let n=e.lastIndexOf(".")+1;t[o]=ANSI.reset+e.substr(0,n)+r+e.substr(n)}),t.sort()}function listBrowsers(){return Object.keys(mdn.browsers)}function listBrowser(e){const t=mdn.browsers[e],o=[];if(!t)return getBrowserStatusList().includes(e)?listBrowserOnStatus(e):["Unknown browser-id: '"+e+"' - Use '.' to list all valid IDs."];let n=0,r=0;Object.keys(t.releases).forEach(e=>{let t=e.split(".");t[0].length>n&&(n=t[0].length),e.length-t[0].length>r&&(r=e.length-t[0].length)});let s=0;return getBrowserStatusList().forEach(e=>{e.length>s&&(s=e.length)}),Object.keys(t.releases).sort(function(e,t){let o=e.split("."),n=t.split("."),r=(0|o[0])+.001*(0|o[1])+1e-6*(0|o[2])+1e-9*(0|o[3]),s=(0|n[0])+.001*(0|n[1])+1e-6*(0|n[2])+1e-9*(0|n[3]);return r>s?1:r<s?-1:0}).forEach(i=>{let a=ANSI.white+(t.name||e)+"  "+ANSI.green+_fBrowserVersion(i,n,r),l=t.releases[i].release_date,p=t.releases[i].release_notes,d=t.releases[i].status;a+="  "+(l?ANSI.cyan+l:ANSI.gray+"-         "),a+="  "+(d?_browserStatusColor(d)+d.padEnd(s)+(options.notes&&p?"  "+ANSI.reset+p:"")+ANSI.reset+ANSI.white:"-"),o.push(a+ANSI.white)}),o}function listBrowserOnStatus(e){let t=[],o=_browserStatusColor(e),n=_iterateBrowsers((t,o,n,r,s)=>{let i=t.release_date;return t.status&&t.status===e?{browser:s||o,version:n,notes:t.release_notes,date:i||"-"}:null}),r=0,s=0,i=0;return n.forEach(e=>{let t=e.version.split(".");e.browser.length>r&&(r=e.browser.length),t[0].length>s&&(s=t[0].length),e.version.length-t[0].length>i&&(i=e.version.length-t[0].length)}),t.push(ANSI.reset+"STATUS: "+ANSI.reset+ANSI.white+o+e.toUpperCase()+ANSI.reset),n.forEach(e=>{t.push(ANSI.white+e.browser.padEnd(r)+ANSI.white+"  "+o+_fBrowserVersion(e.version,s,i)+ANSI.white+ANSI.dim+"  "+("-"===e.date?ANSI.gray:ANSI.reset+ANSI.bright+ANSI.cyan)+e.date+(options.notes&&e.notes&&e.notes.length?"  "+ANSI.reset+e.notes:"")+ANSI.reset)}),t}function getBrowserStatusList(){return _iterateBrowsers((e,t,o,n)=>n.includes(e.status)?null:e.status).sort()}function _browserStatusColor(e){switch(e){case"retired":return ANSI.red;case"beta":case"alpha":return ANSI.yellow;case"nightly":return ANSI.blue;case"current":case"esr":return ANSI.green;case"planned":return ANSI.magenta;default:return ANSI.white}}function _iterateBrowsers(e){const t=mdn.browsers,o=[];return Object.keys(t).forEach(n=>{let r=t[n].name;Object.keys(t[n].releases).forEach(s=>{let i=e(t[n].releases[s],n,s,o,r);i&&o.push(i)})}),o}function _fBrowserVersion(e,t,o){let n=e.split(".");return n[0].padStart(t)+n.join(".").substr(n[0].length).padEnd(o)}const tagParser=require("./tagparser");function getDoc(e,t){let o=ANSI.clrToCursor+ANSI.cursorUp,n=io.getCachedData(e);if(n&&!options.docforce)log(),a(n);else{log(ANSI.green+"Fetching documentation...");let n=e.replace("mozilla.org/","mozilla.org/"+isoLang+"/")+"?raw&macros";io.request(n,()=>!s(),e=>{let t=Math.round(50*e),n=50-t;log(o+ANSI.white+"Downloading doc "+ANSI.white+"["+ANSI.green+"#".repeat(t)+" ".repeat(n)+ANSI.white+"]"+ANSI.reset+ANSI.black)},e=>{let t,o,n=['id="wikiArticle"',"</section>"],r=['id="Example','id="Specification','id="Browser_compatibility'];for(let o of n)if((t=e.indexOf(o))>=0)break;if(t<0)log("Cannot parse this documentation source.");else{for(let n of r)if((o=e.indexOf(n,t))>=0)break;o<0&&(o=e.length),i(e=e.substring(e.lastIndexOf("<",t),e.lastIndexOf("<",o)))}},e=>{r=lf+"An error occurred -"+lf+"Status code: "+e.statusCode+(e.error?lf+"Message: "+e.error:"")+ANSI.reset,log(o+ANSI.red+r+ANSI.white),t()})}var r;function s(){log(o+"".padStart(options.maxChars," "))}function i(t){s(),log(ANSI.cursorUp+ANSI.cursorUp);let o=ANSI.reset+t,n="#LF#",r=!1,i=0;o=o.replace(/\t/gm," ");let l=!1;const p=/=.*brush:\s?(html)/i,d=/.*class=.*optionalInline/i,c=/.*class=.*(experimental|deprecated)/i;function u(e,t,o){return t.test(e.substring(o.tagStart,o.tagEnd))}o="#"+(o=(o=(o=(o=entities(o=tagParser(o,e=>{switch(e.name){case"div":return u(o,c,e)&&(tagParser.skip=!0),"";case"/div":return r||(tagParser.skip=!1),"";case"span":return u(o,d,e)&&(l=!0),l?ANSI.white+" ("+ANSI.green:"";case"/span":let t="";return!r&&l&&(l=!1,t=ANSI.white+") "+ANSI.reset),t;case"table":return tagParser.skipLF=!0,ANSI.gray+"--LINE--"+ANSI.reset+n;case"/table":return tagParser.skipLF=!1,ANSI.gray+"--LINE--"+ANSI.reset+n;case"math":return tagParser.skip=!0,ANSI.blue+" --math formula not shown--"+ANSI.reset;case"section":return tagParser.skip=!0,"";case"/math":case"/section":return tagParser.skip=!1,"";case"/th":case"/td":return"\t";case"/tr":return n;case"dl":case"ul":return tagParser.skipLF=!0,n;case"/dl":case"/ul":return tagParser.skipLF=!1,"";case"br":case"/p":return n;case"h2":case"h3":case"h4":return n+ANSI.yellow;case"/h2":case"/h3":case"/h4":case"/dt":return ANSI.reset+n;case"/dd":case"/li":return i--,ANSI.reset+n;case"pre":return r=!0,u(o,p,e)&&(tagParser.skip=!0),tagParser.skip?"":ANSI.blue+"--LINE--"+ANSI.cyan+n;case"/pre":let s=tagParser.skip?"":n+ANSI.blue+"--LINE--"+ANSI.reset+n;return r=tagParser.skip=!1,s;case"code":return ANSI.cyan;case"/code":return ANSI.reset;case"dt":return ANSI.white+"*".repeat(Math.max(0,i+1))+ANSI.reset+" ";case"dd":case"li":return i++,ANSI.white+"-".repeat(Math.max(0,i))+ANSI.reset+" ";default:return""}},e=>r&&"\n"===e?n:e))).replace(/\n\s*\n/gim,"")).replace(new RegExp(n,"gm"),lf)).replace(lf+lf+ANSI.blue+"--LINE--",lf+ANSI.blue+"--LINE--")),io.setCachedData(e,o),a(o)}function a(e){if(!e.startsWith("#"))return void i(e);e=e.substr(1);let o="-".repeat(options.maxChars-1),n=(e=e.replace(/--LINE--/gm,o)).split(lf),r=-1;function s(t,o){let n="",r=e.indexOf(t),s=t.length;r>=0&&r<10&&(r=options.maxChars-s-2>>1,n=ANSI.red+"/".repeat(r-1)+o+" "+t.toUpperCase()+" "+ANSI.red+"/".repeat(r)+ANSI.reset+lf,e=n+e.substr(r+s+1))}e="",n.forEach((t,o)=>{let s=/\s\s+/g;if(r<0&&t.includes("\t")){let e,t;for(e=o;e<n.length&&(t=n[e]).includes("\t");e++)(t=t.split("\t")[0].trim()).length>r&&(r=t.length);r++}if(t.includes("\t")){let e=t.split("\t");t=ANSI.white+(e[0].trim().padEnd(r)+ANSI.reset+(e[1].trim()||"")),s="x79y"}else r>0&&(r=-1);e+=breakAnsiLine(t.replace(s," ").trim(),options.maxChars).trim()+lf}),s("Draft",ANSI.yellow),s("Obsolete",ANSI.red),e=ANSI.reset+e.trim()+lf,options.colors||(e=e.replace(/\x1b[^m]*m/gm,"")),outStore(e),t()}}function randomCompat(e,t){let o,n,r,s=buildTable(),i=[];for("."!==e&&(r=getComparer(e,options.fuzzy,!t),s.forEach(e=>{r.test(e)&&i.push(e)}),s=i);!o;)if((o=isCompat(s[n=Math.random()*s.length|0]))&&(options.doc||options.docforce||options.desc)){let e=getPathAsObject(s[n]).__compat;e.mdn_url&&e.mdn_url.length||(o=!1)}return s[n]}function compatToLong(e){let t=new Output(0),o=["chrome","edge","firefox","ie","opera","safari"],n=["chrome_android","edge_mobile","firefox_android","opera_android","safari_ios","webview_android"],r=["nodejs","qq_android","samsunginternet_android","uc_android","uc_chinese_android"],s=["°","¹","²","³","ª","^","`","'",'"',"'\"",'""','""\'',"º"],i=" %0----------+-----------+-----------+-----------+-----------+-----------",a=0,l=[];if(t.addLine(ANSI.reset),options.markdown&&e.url?t.addLine(" [`%0%1`](%2) %3"+lf,e.prePath,e.name,e.url,e.getStatus()):(t.addLine(" %0%1%2%3%4 %5",ANSI.cyan,e.prePath,ANSI.white,e.name,ANSI.white,e.getStatus()),t.addLine(" ",e.url?ANSI.gray+e.url:"-",lf)),options.desc&&e.description&&e.description.length){let o=entities(ANSI.reset+breakAnsiLine(cleanHTML(e.description),options.maxWidth));t.addLine(o,lf)}function p(o){o.forEach(o=>{let n,r=e.getBrowser(o);r?(n=r.info[0].getVersion(),r.hasNotes()&&(n+=ANSI.yellow+(options.notes?s[a]:"*"),l.push(r.getNotes(s[a])),a=++a%s.length),"?"===n&&(n=ANSI.yellow+"?")):n=ANSI.red+no,t.add("%0"+n.centerAnsi(11)+ANSI.gray+"|",n.indexOf(no)>=0?ANSI.red:ANSI.green)}),t.trimEnd(1)}return options.mobile||(t.addLine(" %0Chrome    %1|%0 Edge      %1|%0 Firefox   %1|%0 IE        %1|%0 Opera     %1|%0 Safari%1",ANSI.white,ANSI.gray),t.addLine(i,ANSI.gray),p(o),t.addLine(lf),!options.noteend&&options.notes&&l.length&&t.addLine(ANSI.yellow+l.join("")),options.noteend||(l=[],a=0)),options.desktop||(t.addLine(" %0Chrome/A  %1|%0 Edge/mob  %1|%0 Firefox/A %1|%0 Opera/A   %1|%0Safari/iOS %1|%0 %0Webview/A%1",ANSI.white,ANSI.gray),t.addLine(i,ANSI.gray),p(n),t.addLine(lf),!options.noteend&&options.notes&&l.length&&t.addLine(ANSI.yellow+l.join(""))),options.ext&&(t.addLine(" %0Node JS   %1|%0 QQ/A      %1|%0 Samsung/A %1|%0 UC/A      %1|%0 UC-Ch/A%1",ANSI.white,ANSI.gray),t.addLine(i.substr(0,i.length-12),ANSI.gray),p(r),t.addLine(lf),options.notes&&l.length&&t.addLine(ANSI.yellow+l.join(""))),options.specs&&e.specs&&e.specs.length&&(t.addLine(ANSI.cyan+"Specifications:"+lf),e.specs.forEach(e=>{t.addLine(ANSI.white+`${entities(e.name)}${lf}  ${function(e){switch(e.toUpperCase()){case"REC":return ANSI.green+"Recommendation"+ANSI.reset+lf;case"PR":return ANSI.yellow+"Proposed Recommendation"+ANSI.reset+lf;case"CR":return ANSI.cyan+"Candidate Recommendation"+ANSI.reset+lf;case"RC":return ANSI.cyan+"Release Candidate"+ANSI.reset+lf;case"WD":return ANSI.blue+"Working Draft"+ANSI.reset+lf;case"ED":return ANSI.green+"Editor's Draft"+ANSI.reset+lf;case"OLD-TRANSFORMS":return ANSI.orange+"This has been merged in another draft."+ANSI.reset+lf;case"LIVING":return ANSI.cyan+"Living Standard"+ANSI.reset+lf;case"RFC":return ANSI.yellow+"IETF RFC"+ANSI.reset+lf;case"STANDARD":return ANSI.green+"Standard"+ANSI.reset+lf;case"DRAFT":return ANSI.yellow+"Draft"+ANSI.reset+lf;case"OBSOLETE":return ANSI.red+"Obsolete"+ANSI.reset+lf;case"LC":return ANSI.yellow+"Last Call Working Draft"+ANSI.reset+lf;default:return ANSI.yellow+e+ANSI.reset+lf}}(e.status)}  ${e.url}`)}),t.addLine()),t.trimEnd(lf.length),t.toString()}function compatToShort(e,t){let o=e.prePath+e.name,n=new Output(0),r=["chrome","edge","firefox","ie","opera","safari"],s=["chrome_android","firefox_android","edge_mobile","opera_android","safari_ios","android"],i=["nodejs","qq_android","samsunginternet_android","uc_android","uc_chinese_android"],a=["C:","E:","F:","IE:","O:","S:"],l=["CA:","FA:","EM:","OA:","Si:","WA:"],p=["ND:","QQ:","SM:","UC:","UCC:"];function d(t,o){t.forEach((t,r)=>{let s,i=e.getBrowser(t);i?(s=i.info[0].getVersion(),i.hasNotes()&&(s+=ANSI.white+"*")):s=ANSI.red+no,n.add(ANSI.green,o[r],ANSI.white,s," ")})}return n.add(ANSI.white),options.split?n.add(o,":",lf):n.add(o.padEnd(t),":"),options.mobile||(n.add(ANSI.cyan+"  D: "),d(r,a)),options.desktop||(n.add(ANSI.cyan+"  M: "),d(s,l)),options.ext&&(n.add(ANSI.cyan+"  X: "),d(i,p)),n.trimEnd(1),n.toString()}function MDNComp(e){let t=getPathAsObject(e).__compat,o=["webview_android","chrome","chrome_android","edge","edge_mobile","firefox","firefox_android","ie","opera","opera_android","safari","safari_ios"],n=[!1,!0,!1,!0,!1,!0,!1,!0,!0,!1,!0,!1],r=t.status||{},s=Object.keys(t.support);this.path=e,this.prePath=prePathFromPath(e),this.name=nameFromPath(e),this.url=t.mdn_url&&t.mdn_url.length?("https://developer.mozilla.org/docs/"+t.mdn_url).replace(".org/docs/Mozilla/Add-ons/",".org/Add-ons/"):null,this.specs=t.specs||[],this.experimental=r.experimental,this.standard=r.standard_track,this.deprecated=r.deprecated,this.browsers=[],this.description=t.description||"",s.forEach(e=>{let r=o.indexOf(e);if(r>=0){let o=new Browser(t,e);o.isDesktop=n[r],this.browsers.push(o)}})}function Info(e){this.added=this.toStatus(e.version_added),this.removed=this.toStatus(e.version_removed),this.notes=e.notes?Array.isArray(e.notes)?e.notes:[e.notes]:[],this.flags=e.flags||[],e.prefix&&this.notes.unshift("Prefix: "+e.prefix),e.partial_implementation&&this.notes.unshift("Is partial implementation."),e.alternative_name&&this.notes.unshift("Uses a non-standard name: "+e.alternative_name),this.flags.forEach(e=>{this.notes.push(this.flagToString(e,ANSI.yellow))})}function Browser(e,t){this.name=t,this.info=[];let o=e.support[t];Array.isArray(o)||(o=[o]),this.prefix=(o[o.length-1]||{}).prefix||"",o.forEach(e=>{this.info.push(new Info(e))})}function Output(e){this.string="",this.indent="    ".substr(0,0|e),this.linefeed=lf}MDNComp.prototype={getBrowser:function(e){for(let t of this.browsers)if(t.name===e)return t;return null},getStatus:function(){let e="(";return this.deprecated?e+=ANSI.red+"DEPRECATED"+ANSI.reset+", ":(this.experimental&&(e+=ANSI.yellow+"EXPERIMENTAL"+ANSI.reset+", "),this.standard&&(e+=ANSI.green+"On Standard Track"+ANSI.reset+", ")),"()"===(e=e.substr(0,Math.max(1,e.length-2))+")")?"":e},hasFlags:function(){for(let e of this.browsers)if(e.hasFlags())return!0;return!1}},Info.prototype={getVersion:function(){return this.removed?this.added+"-"+this.removed.replace("Y","?"):this.added},flagToString:function(e,t){switch(e.type){case"preference":return o("Behind flag "+ANSI.cyan);case"compile_flag":return o("Compile with "+ANSI.cyan);case"runtime_flag":return o("Run with "+ANSI.cyan)}function o(o){return o+e.name+(t||ANSI.reset)+(e.value_to_set?" set to "+e.value_to_set:"")+"."}return""},toString:function(e){let t=(e?e+") ":"")+(isNaN(this.added)?"":this.getVersion()+": "),o="",n=new Output(0);return this.notes.length?(this.notes.length>1&&(t+=lf,o="- "),this.notes.forEach(e=>{n.addLine(cleanHTML(o+e,!0,ANSI.yellow))}),t+n.toString()):""},toStatus:function(e){return"boolean"==typeof e?e?"Y":no:null===e?"?":e||null}},Browser.prototype={hasNotes:function(){for(let e of this.info)if(e.notes.length)return!0;return!1},hasFlags:function(){for(let e of this.info)if(e.flags.length)return!0;return!1},hasPrefix:function(){return this.prefix.length},getNotes:function(e){let t=new Output(0);return this.info.forEach(o=>{let n=breakAnsiLine(o.toString(e),options.maxChars);n.length&&t.addLine(n)}),t.toString()}},Output.prototype={add:function(e){if(e=e||"",arguments.length>1){let t=e.indexOf("%0")>=0;for(let o=1;o<arguments.length;o++){let n=new RegExp("%"+(o-1),"g");e=t?e.replace(n,arguments[o]):e+arguments[o]}}this.string+=this.indent+(e||"")},addLine:function(e){this.add.apply(this,arguments),this.string+=this.linefeed},trimEnd:function(e){this.string=this.string.substr(0,Math.max(0,this.string.length-e))},replace:function(e,t){let o=new RegExp(e,"g");this.string=this.string.replace(o,t)},toString:function(){return this.string}};