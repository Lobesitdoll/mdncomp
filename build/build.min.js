/*!
	mdncomp (version: see package.json)
	Copyright (c) 2018 Epistemex
	www.epistemex.com
*/
"use strict";module.exports=init,String.prototype.padStart||(String.prototype.padStart=function(e,t){return e>>=0,t=String(void 0!==t?t:" "),this.length>e?String(this):((e-=this.length)>t.length&&(t+=t.repeat(e/t.length)),t.slice(0,e)+String(this))}),String.prototype.padEnd||(String.prototype.padEnd=function(e,t){return e>>=0,t=String(void 0!==t?t:" "),this.length>e?String(this):((e-=this.length)>t.length&&(t+=t.repeat(e/t.length)),String(this)+t.slice(0,e))}),String.prototype.includes||(String.prototype.includes=function(e,t){return-1!==this.indexOf(e,0|t)}),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(t>>>0,e.length)===e}),String.prototype.endsWith||(String.prototype.endsWith=function(e,t){return(void 0===t||t>this.length)&&(t=this.length),this.substring(t-e.length,t)===e}),String.prototype.repeat||(String.prototype.repeat=function(e){if(e>>>=0,!this.length||!e)return"";if(this.length*e>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");let t="";for(let r=0;r<e;r++)t+=this;return t});const ANSI={bright:"[1m",dim:"[2m",clrToCursor:"[1K",cursorUp:"[1A",black:"[30m",red:"[31;1m",green:"[32;1m",yellow:"[33;1m",orange:"[33;2m",blue:"[34;1m",magenta:"[35;2m",cyan:"[36;1m",white:"[37;1m",gray:"[30;1m",reset:"[0m"},lf="\r\n",yes="Y",no="-",yes16="âœ”",no16="âœ˜",saves=[],version=require("../package.json").version,args=process.argv,log=console.log.bind(console),urlPrefix="https://raw.githubusercontent.com/epistemex/data-for-mdncomp/master/";let mdn,cfg,util,crypto,options,https,fs,path,isoLang="en-US",shortPad=1;function buildTable(){const e=[];return listTopLevels().forEach(t=>{"browsers"!==t&&function t(r,o,n){const s=r[o];"object"==typeof s&&Object.keys(s).forEach(r=>{"__compat"!==r&&(e.push(n+"."+r),t(s,r,n+"."+r))})}(mdn,t,t)}),e}function listTopLevels(){let e=Object.keys(mdn),t=e.indexOf("browsers");return t>=0&&e.splice(t,1),e}function getComparer(e,t,r){let o,n,s="",i="";e.startsWith("/")?(e=(n=(e=e.substr(1)).split("/"))[0],s=n[1]):t?e=function(e){let t=[],r="";e.endsWith(".")&&(r="$",e=e.substr(0,e.length-1));for(let r of e)t.push("\\^$.*+?()[]{}|".includes(r)?"\\"+r:r);return t.join(".*?")+r}(e.toLowerCase()):(e.endsWith(".")&&(e=e.substr(0,e.length-1),i="$"),e.startsWith("*")||(e="*"+e),e.endsWith("*")||i.length||(e+="*"),e=e.split("*").join(".*")+i),r&&!s.includes("i")&&(s+="i");try{o=new RegExp(e,s)}catch(e){log("Invalid regular expression:",e.message),process.exit(-1)}return o}function getPathAsObject(e,t){let r=e.split("."),o=mdn;return r.forEach(e=>{o&&o[e]&&(o=o[e])}),t&&Object.keys(o).forEach(e=>{o&&o[e].__compat&&delete o[e]}),o}function nameFromPath(e){let t=getExt(e);return t.length?t:e}function getExt(e){let t=e.lastIndexOf(".");return t<0?"":e.substr(++t)}function prePathFromPath(e){let t=e.split("."),r=mdn,o="";return t.pop(),t.forEach(e=>{r&&(r[e].__compat&&(o+=e+"."),r=r[e])}),o.length>1?o:""}function isCompat(e){let t=getPathAsObject(e);return!!t&&"object"==typeof t.__compat}function cleanHTML(e,t){return e=(e=e.replace(/<code>/gi,ANSI.cyan).replace(/<\/code>/gi,ANSI.reset)).replace(/(<([^>]+)>)/gi,""),t&&(e=e.replace(/&lt;/gi,"<").replace(/&gt;/gi,">")),e}function breakAnsiLine(e,t){let r,o=[],n=0,s=0,i=0,a=-1,l=!1,d=Math.max(72,t>>>0);for(;r=e[n];)l?"m"===r&&(l=!1):""===r?l=!0:(" "!==r&&"\n"!==r||(a=n),++s!==d&&"\n"!==r||(a<0&&(a=n),o.push(e.substring(i,a).trim()),i=a,a=-1,s=n-i)),n++;return s&&o.push(e.substr(i)),o.forEach((e,t)=>{o[t]=e.trim()}),o.length?o.join(lf):""}function indent(e){let t="",r=0;for(let n of e)","===n||"{"===n?("{"===n&&r++,t+=n+o()):"}"===n?(r--,t+=o()+n):t+=":"===n?n+" ":n;function o(){return lf+"  ".repeat(r)}return t}function getMaxLength(e){let t=0;return e.forEach(e=>{let r=(prePathFromPath(e)+nameFromPath(e)).length;r>t&&(t=r)}),t}function entities(e){return e=(e=(e=(e=(e=e.replace(/&nbsp;/gim," ")).replace(/&quot;/gim,'"')).replace(/&amp;/gim,"&")).replace(/&lt;/gim,"<")).replace(/&gt;/gim,">")}function parseHelp(e){if(e.length<4)log(),log("  Examples:"),log("    mdncomp arcTo                   show information for arcTo"),log("    mdncomp html*toblob.            will find HTMLCanvasElement.toBlob"),log("    mdncomp --list .                list all top-levels"),log("    mdncomp blob*der -o info.svg    export as svg"),log();else{let t="-h"===e[2].toLowerCase()||"--help"===e[2].toLowerCase()?e[3]:e[2],r=require("./help").help[t];log(),log(`${ANSI.yellow}Help for option "${t}"${ANSI.reset}`),log(r||"Unknown option."),log()}}function init(){3===args.length&&"--configpath"===args[2]?log(ANSI.white+io.getConfigPath()+ANSI.reset):3!==args.length||"--update"!==args[2]&&"--fupdate"!==args[2]&&"--cupdate"!==args[2]?((options=require("commander")).version(version,"-v, --version").usage("[options] <feature>").description("Get MDN Browser Compatibility Data."+lf+"  Version: "+version+lf+"  (c) 2018 epistemex.com").option("-l, --list","List paths starting with the given value or '.' for top-level").option("-o, --out <path>","Save information to file. Extension for type, or --type").option("-t, --type <type>","Output format (ansi, txt, svg)","ansi").option("-x, --overwrite","Overwrites an existing file with --out option").option("-d, --desktop","Show desktop only").option("-m, --mobile","Show mobile devices only").option("-c, --case-sensitive","Search in case-sensitive mode").option("-a, --all","If search results in more than entry, show info for all").option("-z, --fuzzy","Use path as a fuzzy search term").option("-i, --index <index>","Show this index from a multiple result list",-1).option("-s, --shorthand","Show compatibility as shorthand with multiple results").option("-h, --shorthand-split","Split a shorthand line into two lines (use with -s)").option("-b, --browser","Show information about this browser, or if '.' list").option("-N, --no-notes","Don't show notes").option("-e, --noteend","Show notes at end instead of in sections (text)").option("-f, --markdown","Format link as markdown and turns off colors").option("-w, --width <width>","Used with -o, Set width of svg",800).option("--ext","Show extended table of browsers").option("--desc","Show Short description of the feature").option("--specs","Show specification links").option("--doc","Show documentation. Show cached or fetch").option("--docforce","Show documentation. Force fetch from server").option("--mdn","Open entry's document URL in default browser").option("--random","Show a random entry. (mdncomp --random . )").option("--update, --fupdate, --cupdate","Update BCD from remote (--fupdate=force, --cupdate=check)").option("--no-colors","Don't use colors in output").option("--max-chars <width>","Max number of chars per line before wrap",72).option("--no-config","Ignore config file (mdncomp.json) in config folder").option("--configpath","Show path to where config file and cache is stored").action(go).on("--help",()=>{parseHelp(args)}).parse(args),options.args.length||options.help()):update("--fupdate"===args[2],"--cupdate"===args[2])}function outInfo(e){Array.isArray(e)&&(e=e.join(lf)),log(e+ANSI.reset)}function outStore(e,t){Array.isArray(e)&&(e=e.join(lf)),t||!options.out?log(e):saves.push(e)}function go(e){"string"!=typeof e&&(e=".");try{mdn=require("../data/data.json")}catch(e){return void log("Critical error: data file not found. Try running with option --fupdate to download latest snapshot.")}try{loadConfig()}catch(e){}if(options.out&&"ansi"===options.type&&(options.type=getExt(options.out||".txt")),options.desktop&&options.mobile&&(options.desktop=options.mobile=!1),options.colors&&!options.markdown&&"txt"!==options.type||Object.keys(ANSI).forEach(e=>{e.toLowerCase().includes("cursor")||(ANSI[e]="")}),options.random&&(e=randomCompat(e),options.index=0),options.list)if("."===e)outInfo(listTopLevels());else if(["deprecated","experimental","standard"].indexOf(e)>=0)outInfo(listOnStatus(e));else if(["missinglink"].indexOf(e)>=0)outInfo(listOnProp(e));else{let t=list(e,options.caseSensitive);1===t.length&&isCompat(t[0])?(options.list=void 0,go(t[0])):outInfo(t)}else if(options.browser)"."===e?(outInfo(ANSI.white+listBrowsers().join(lf)+ANSI.reset),outInfo(lf+"Valid statuses:"),outInfo(ANSI.green+getBrowserStatusList().join(", "))):outInfo(listBrowser(e.toLowerCase()).join(lf));else{let r=search(e,options.caseSensitive);if(r.length)if(1===r.length||options.index>=0&&options.index<r.length||options.all&&"svg"!==options.type){if(options.shorthand&&(shortPad=getMaxLength(r)),options.index>=0&&options.index<r.length&&(r=r.splice(options.index,1)),r.forEach(e=>{!function(e){let t=new MDNComp(e);"svg"===options.type?outStore(compatToSVG(t)):outStore(options.shorthand?compatToShort(t,shortPad):compatToLong(t))}(e)}),1===r.length){let e=new MDNComp(r[0]);options.doc||options.docforce?e.url.length?getDoc(e.url,t):(outInfo(ANSI.red+"Documentation URL is not defined for this feature."+ANSI.reset+lf),t()):t(),options.mdn&&(e.url.length?io.run(e.url):log("No URL is defined for this entry."))}}else{let e=(r.length+"").length;r.forEach((t,r)=>{outInfo(ANSI.yellow+"["+ANSI.green+(r+"").padStart(e)+ANSI.yellow+"] "+ANSI.white+t+ANSI.reset)})}else outInfo("Not found.");function t(){"svg"!==options.type&&outStore(ANSI.magenta+"Data from MDN - `npm i -g mdncomp` by epistemex"+ANSI.white+lf+ANSI.reset),function(){let e;if(options.out&&saves.length)if((e=require("fs")).existsSync(options.out)&&!options.overwrite){const e=require("readline"),r=e.createInterface({input:process.stdin,output:process.stdout});r.question(ANSI.yellow+"A file with this name already exists. Overwrite? (y(es), default: no)? "+ANSI.white,e=>{e.toLowerCase().startsWith("y")?t(()=>{r.close()}):(log("File not saved."),r.close(),process.exit())})}else t();function t(t){e.writeFile(options.out,saves.join("\n"),"utf8",function(e){if(e)return log("An error occurred:"+lf+e);log(ANSI.green+`Saved output to file "${ANSI.cyan+options.out+ANSI.green}"!`+ANSI.reset),t&&t()})}}()}}}function loadConfig(){fs||(fs=require("fs")),path||(path=require("path"));const e=path.resolve(io.getConfigDataPath(),".config.json");if(fs.existsSync(e)){let t=(cfg=require(e)).options||cfg||{};delete t.browser,delete t.list,delete t.out,delete t.all,delete t.index,delete t.random,Object.assign(options,t)}}String.prototype.centerAnsi=function(e){let t=e-this.ansiLength()>>>1,r=" ".repeat(t)+this+" ".repeat(t);return" ".substr(0,e-r.ansiLength())+r},String.prototype.ansiLength=function(){return this.ansiFree().length},String.prototype.ansiFree=function(){return this.replace(/\x1b[^m]*m/g,"")};const io={request:function(e,t,r,o,n){let s;function i(e,t){n?n({statusCode:e.statusCode,error:t}):log("Error",e,t)}https||(https=require("https")),t=t||function(){return!0},https.get(e,e=>{let a="";if(s=e,301===e.statusCode||302===e.statusCode)return io.request(e.headers.location,t,r,o,n);if(200===e.statusCode&&t({headers:e.headers})){let t=0|e.headers["content-length"];e.on("data",e=>{a+=e,r&&r(t?a.length/t:a.length%7/7)}).on("end",()=>{o(a)})}else n&&i(e,"")}).on("error",e=>i(s,e)).end()},run:function(e){return require("opn")(e)},exist:function(e){return fs||(fs=require("fs")),fs.existsSync(e)},getConfigRootPath:function(){let e="win32"===process.platform?path.resolve(process.env.APPDATA,"../../"):process.env.HOME;return"darwin"===process.platform?require("path").resolve(e,"/Library/Preferences"):e},getConfigPath:function(){return path||(path=require("path")),path.resolve(io.getConfigRootPath(),".mdncomp")},getConfigDataPath:function(){path||(path=require("path")),fs||(fs=require("fs"));let e=io.getConfigPath();t(e);for(let r=0;r<arguments.length;r++)t(e=path.resolve(e,arguments[r]));function t(e){if(!fs.existsSync(e))try{fs.mkdirSync(e)}catch(t){log(`${ANSI.red}Could not create config folder:\n${e}\n${t.message}${ANSI.reset}`)}}return e},getCachedFilename:function(e){return path.resolve(io.getConfigDataPath("cache"),calcMD5(e))},getCachedData:function(e){fs||(fs=require("fs"));let t=null;try{t=fs.readFileSync(io.getCachedFilename(e)).toString()}catch(e){}return t},setCachedData:function(e,t){fs||(fs=require("fs"));let r=io.getCachedFilename(e);try{fs.writeFileSync(r,t)}catch(e){log(ANSI.red+"Could not save file: "+r+ANSI.reset+lf+e)}},writeAll:function(e,t){fs||(fs=require("fs"));let r=[],o=e.length,n=!1;for(let t of e)fs.writeFile(t.path,t.data,"utf8",e=>{s({path:t.path,err:e})});function s(e){r.push(e),e.err&&(n=!0),--o||t(r,n)}}};function update(e,t){const r=require("path"),o=ANSI.clrToCursor+ANSI.cursorUp,n=r.normalize(r.dirname(process.mainModule.filename)+"/../data/data."),s=n+"json",i=n+"md5";function a(){io.request(urlPrefix+"data2.json",()=>!l(),e=>{let t=Math.round(50*e),r=50-t;log(o+ANSI.white+"Downloading data "+ANSI.white+"["+ANSI.green+"#".repeat(t)+" ".repeat(r)+ANSI.white+"]"+ANSI.reset+ANSI.black)},e=>{io.writeAll([{path:s,data:e},{path:i,data:calcMD5(e)}],(t,r)=>{r?t.forEach(e=>{e.err&&d("An error occurred writing data to file. Please retry: "+lf+e.path+": "+e.err+ANSI.reset)}):log(o+ANSI.white+("Updated with "+e.length+" bytes. All systems are GO!").padEnd(72," ")+ANSI.reset)})},e=>d(lf+"An error occurred -"+lf+"Status code: "+e.statusCode+(e.error?lf+"Message: "+e.error:"")+ANSI.reset))}function l(){log(o+"".padStart(72," "))}function d(e){log(o+ANSI.red+e+ANSI.white)}log("Connecting..."),e?a():serverMD5(e=>{let r=getCachedMD5(i,s);l(),log(o+ANSI.white+(e===r?"No change in data - cancelling (or use the --fupdate option).":"Update is available ("+e+").")),t||e===r||a()})}function serverMD5(e){io.request(urlPrefix+"data2.md5",null,null,e,e=>{log("An error occurred:",e.statusCode,e.error)})}function getCachedMD5(e,t){fs||(fs=require("fs"));try{return fs.readFileSync(e)+""}catch(e){return calcFileMD5(t)}}function calcFileMD5(e){fs||(fs=require("fs"));try{return calcMD5(fs.readFileSync(e))+""}catch(e){return""}}function calcMD5(e){return crypto||(crypto=require("crypto")),crypto.createHash("md5").update(e).digest("hex")+""}function search(e,t){let r,o=buildTable(),n=[];return r=getComparer(e,options.fuzzy,!t),o.forEach(e=>{r.test(e)&&isCompat(e)&&n.push(e)}),n}function list(e,t){const r=t?e:e.toLowerCase(),o=buildTable(),n=[],s=r.split(".").length+1;let i,a="";o.forEach(e=>{(i=t?e:e.toLowerCase()).startsWith(r)&&e.split(".").length<=s&&e!==a&&n.push(a=e)});let l=e.lastIndexOf(".")+1;return n.forEach((e,t)=>{let r=e.lastIndexOf(".")+1;n[t]=ANSI.reset+(l?e.substr(0,l)+ANSI.cyan+(r>l?e.substring(l,r)+ANSI.white+e.substr(r):e.substr(l)):e)}),n}function listOnStatus(e){const t=[],r=listTopLevels();function o(t){return!!(t.__compat.status||{})[e]}"standard"===e&&(e="standard_track"),r.forEach(e=>{let r=mdn[e];r.__compat&&o(r)&&t.push(e),Object.keys(mdn[e]).forEach(r=>{let n=mdn[e][r];n.__compat&&o(n)&&t.push(e+"."+r),Object.keys(mdn[e][r]).forEach(n=>{let s=mdn[e][r][n];n.__compat&&o(s)&&t.push(e+"."+r+"."+n)})})});let n="deprecated"===e?ANSI.red:"experimental"===e?ANSI.yellow:ANSI.green;return t.forEach((e,r)=>{let o=e.lastIndexOf(".")+1;t[r]=ANSI.reset+e.substr(0,o)+n+e.substr(o)}),t.sort()}function listOnProp(){const e=[];return buildTable().forEach(t=>{let r=getPathAsObject(t);r&&(!(r=r.__compat)||r.mdn_url&&r.mdn_url.length||e.push(t))}),e.forEach((t,r)=>{let o=t.lastIndexOf(".")+1;e[r]=(ANSI.reset+t.substr(0,o)+ANSI.white+t.substr(o)).replace(/\./g,ANSI.blue+"."+ANSI.reset)}),e.sort()}function listBrowsers(){return Object.keys(mdn.browsers)}function listBrowser(e){const t=mdn.browsers[e],r=[];if(!t)return getBrowserStatusList().includes(e)?listBrowserOnStatus(e):["Unknown browser-id: '"+e+"' - Use '.' to list all valid IDs."];let o=0,n=0;return Object.keys(t.releases).forEach(e=>{let t=e.split(".");t[0].length>o&&(o=t[0].length),e.length-t[0].length>n&&(n=e.length-t[0].length)}),Object.keys(t.releases).sort(function(e,t){let r=e.split("."),o=t.split("."),n=(0|r[0])+.001*(0|r[1])+1e-6*(0|r[2])+1e-9*(0|r[3]),s=(0|o[0])+.001*(0|o[1])+1e-6*(0|o[2])+1e-9*(0|o[3]);return n>s?1:n<s?-1:0}).forEach(s=>{let i=ANSI.white+e+"  "+ANSI.green+_fBrowserVersion(s,o,n),a=t.releases[s].release_date,l=t.releases[s].status;i+=ANSI.white+"  Rel: "+(a?ANSI.cyan+a:ANSI.gray+"-         "),i+="  "+(l?_browserStatusColor(l)+l+ANSI.reset+ANSI.white:"-"),r.push(i+ANSI.white)}),r}function listBrowserOnStatus(e){let t=[],r=_browserStatusColor(e),o=_iterateBrowsers((t,r,o)=>{let n=t.release_date;return t.status&&t.status===e?{browser:r,version:o,date:n||"-"}:null}),n=0,s=0,i=0;return o.forEach(e=>{let t=e.version.split(".");e.browser.length>n&&(n=e.browser.length),t[0].length>s&&(s=t[0].length),e.version.length-t[0].length>i&&(i=e.version.length-t[0].length)}),t.push(ANSI.reset+"STATUS: "+ANSI.reset+ANSI.white+r+e.toUpperCase()+ANSI.reset),o.forEach(e=>{t.push(ANSI.white+e.browser.padEnd(n)+ANSI.white+"  "+r+_fBrowserVersion(e.version,s,i)+ANSI.white+ANSI.dim+"  Rel: "+("-"===e.date?ANSI.gray:ANSI.reset+ANSI.bright+ANSI.cyan)+e.date+ANSI.reset)}),t}function getBrowserStatusList(){return _iterateBrowsers((e,t,r,o)=>o.includes(e.status)?null:e.status).sort()}function _browserStatusColor(e){switch(e){case"retired":return ANSI.red;case"beta":case"alpha":return ANSI.yellow;case"nightly":return ANSI.blue;case"current":case"esr":return ANSI.green;case"planned":return ANSI.magenta;default:return ANSI.white}}function _iterateBrowsers(e){const t=mdn.browsers,r=[];return Object.keys(t).forEach(o=>{Object.keys(t[o].releases).forEach(n=>{let s=e(t[o].releases[n],o,n,r);s&&r.push(s)})}),r}function _fBrowserVersion(e,t,r){let o=e.split(".");return o[0].padStart(t)+o.join(".").substr(o[0].length).padEnd(r)}function getDoc(e,t){let r=ANSI.clrToCursor+ANSI.cursorUp,o=io.getCachedData(e);if(o&&!options.docforce)log(),a(o);else{log(ANSI.green+"Fetching documentation...");let o=e.replace("mozilla.org/","mozilla.org/"+isoLang+"/")+"?raw&macros";io.request(o,()=>!s(),e=>{let t=Math.round(50*e),o=50-t;log(r+ANSI.white+"Downloading doc "+ANSI.white+"["+ANSI.green+"#".repeat(t)+" ".repeat(o)+ANSI.white+"]"+ANSI.reset+ANSI.black)},e=>{let t,r,o=['id="wikiArticle"',"</section>"],n=['id="Example','id="Specification','id="Browser_compatibility'];for(let r of o)if((t=e.indexOf(r))>=0)break;if(t<0)log("Cannot parse this documentation source.");else{for(let o of n)if((r=e.indexOf(o,t))>=0)break;r<0&&(r=e.length),i(e=e.substring(e.lastIndexOf("<",t),e.lastIndexOf("<",r)))}},e=>{n=lf+"An error occurred -"+lf+"Status code: "+e.statusCode+(e.error?lf+"Message: "+e.error:"")+ANSI.reset,log(r+ANSI.red+n+ANSI.white),t()})}var n;function s(){log(r+"".padStart(options.maxChars," "))}function i(t){s(),log(ANSI.cursorUp+ANSI.cursorUp);let r=ANSI.reset+t,o="#LF#",n=!1,i=0,l=!1;const d=/=.*brush:\s?(html)/i,c=/.*class=.*optionalInline/i,p=/.*class=.*(experimental|deprecated)/i;function u(e,t,r){return t.test(e.substring(r.tagStart,r.tagEnd))}r="#"+(r=(r=(r=(r=entities(r=tagParser(r=r.replace(/\t/gm," "),e=>{switch(e.name){case"div":return u(r,p,e)&&(tagParser.skip=!0),"";case"/div":return n||(tagParser.skip=!1),"";case"span":return u(r,c,e)&&(l=!0),l?ANSI.white+" ("+ANSI.green:"";case"/span":let t="";return!n&&l&&(l=!1,t=ANSI.white+") "+ANSI.reset),t;case"table":return tagParser.skipLF=!0,ANSI.gray+"--LINE--"+ANSI.reset+o;case"/table":return tagParser.skipLF=!1,ANSI.gray+"--LINE--"+ANSI.reset+o;case"math":return tagParser.skip=!0,ANSI.blue+" --math formula not shown--"+ANSI.reset;case"section":return tagParser.skip=!0,"";case"/math":case"/section":return tagParser.skip=!1,"";case"/th":case"/td":return"\t";case"/tr":return o;case"dl":case"ul":return tagParser.skipLF=!0,o;case"/dl":case"/ul":return tagParser.skipLF=!1,"";case"br":case"/p":return o;case"h2":case"h3":case"h4":return o+ANSI.yellow;case"/h2":case"/h3":case"/h4":case"/dt":return ANSI.reset+o;case"/dd":case"/li":return i--,ANSI.reset+o;case"pre":return n=!0,u(r,d,e)&&(tagParser.skip=!0),tagParser.skip?"":ANSI.blue+"--LINE--"+ANSI.cyan+o;case"/pre":let s=tagParser.skip?"":o+ANSI.blue+"--LINE--"+ANSI.reset+o;return n=tagParser.skip=!1,s;case"code":return ANSI.cyan;case"/code":return ANSI.reset;case"dt":return ANSI.white+"*".repeat(Math.max(0,i+1))+ANSI.reset+" ";case"dd":case"li":return i++,ANSI.white+"-".repeat(Math.max(0,i))+ANSI.reset+" ";default:return""}},e=>n&&"\n"===e?o:e))).replace(/\n\s*\n/gim,"")).replace(new RegExp(o,"gm"),lf)).replace(lf+lf+ANSI.blue+"--LINE--",lf+ANSI.blue+"--LINE--")),io.setCachedData(e,r),a(r)}function a(e){if(!e.startsWith("#"))return void i(e);e=e.substr(1);let r="-".repeat(options.maxChars-1),o=(e=e.replace(/--LINE--/gm,r)).split(lf),n=-1;function s(t,r){let o="",n=e.indexOf(t),s=t.length;n>=0&&n<10&&(n=options.maxChars-s-2>>1,o=ANSI.red+"/".repeat(n-1)+r+" "+t.toUpperCase()+" "+ANSI.red+"/".repeat(n)+ANSI.reset+lf,e=o+e.substr(n+s+1))}e="",o.forEach((t,r)=>{let s=/\s\s+/g;if(n<0&&t.includes("\t")){let e,t;for(e=r;e<o.length&&(t=o[e]).includes("\t");e++)(t=t.split("\t")[0].trim()).length>n&&(n=t.length);n++}if(t.includes("\t")){let e=t.split("\t");t=ANSI.white+(e[0].trim().padEnd(n)+ANSI.reset+(e[1].trim()||"")),s="x79y"}else n>0&&(n=-1);e+=breakAnsiLine(t.replace(s," ").trim(),options.maxChars).trim()+lf}),s("Draft",ANSI.yellow),s("Obsolete",ANSI.red),e=ANSI.reset+e.trim()+lf,options.colors||(e=e.replace(/\x1b[^m]*m/gm,"")),outStore(e),t()}}function tagParser(e,t,r){const o=0,n=1,s=2;let i,a=0,l=-1,d=o,c=!1,p="",u="";for(;a<e.length;)i=e[a],c?(d?(d===n&&'"'===i||d===s&&"'"===i)&&(d=o):'"'===i?d=n:"'"===i&&(d=s),d||((" "===i&&!p.length||">"===i&&!p.length)&&(p=e.substring(l+1,a)),">"===i&&(c=!1,u+=t({tagStart:l,tagEnd:a+1,name:p.toLowerCase()})))):"<"===i?(c=!0,l=a,p=""):(!tagParser.skipLF||"\n"!==i&&"\r"!==i||(i=""),tagParser.skip||(u+=r(i))),a++;return u}function randomCompat(e,t){let r,o,n,s=buildTable(),i=[];for("."!==e&&(n=getComparer(e,options.fuzzy,!t),s.forEach(e=>{n.test(e)&&i.push(e)}),s=i);!r;)if((r=isCompat(s[o=Math.random()*s.length|0]))&&(options.doc||options.docforce||options.desc)){let e=getPathAsObject(s[o]).__compat;e.mdn_url&&e.mdn_url.length||(r=!1)}return s[o]}function compatToLong(e){let t=new Output(0),r=["chrome","edge","firefox","ie","opera","safari"],o=["chrome_android","edge_mobile","firefox_android","opera_android","safari_ios","webview_android"],n=["nodejs","qq_android","samsunginternet_android","uc_android","uc_chinese_android"],s=["Â°","Â¹","Â²","Â³","Âª","^","`","'",'"',"'\"",'""','""\'',"Âº"],i=" %0----------+-----------+-----------+-----------+-----------+-----------",a=0,l=[];if(t.addLine(ANSI.reset),options.markdown&&e.url?t.addLine(" [`%0%1`](%2) %3"+lf,e.prePath,e.name,e.url,e.getStatus()):(t.addLine(" %0%1%2%3%4 %5",ANSI.cyan,e.prePath,ANSI.white,e.name,ANSI.white,e.getStatus()),t.addLine(" ",e.url?ANSI.gray+e.url:"-",lf)),options.desc&&e.description&&e.description.length){let r=entities(ANSI.reset+breakAnsiLine(cleanHTML(e.description),options.maxWidth));t.addLine(r,lf)}function d(r){r.forEach(r=>{let o,n=e.getBrowser(r);n?(o=n.info[0].getVersion(),n.hasNotes()&&(o+=ANSI.white+(options.notes?s[a]:"*"),l.push(n.getNotes(s[a])),a=++a%s.length),"?"===o&&(o=ANSI.yellow+"?")):o=ANSI.red+no,t.add("%0"+o.centerAnsi(11)+ANSI.gray+"|",o.indexOf(no)>=0?ANSI.red:ANSI.cyan)}),t.trimEnd(1)}return options.mobile||(t.addLine(" %0Chrome    %1|%0 Edge      %1|%0 Firefox   %1|%0 IE        %1|%0 Opera     %1|%0 Safari%1",ANSI.green,ANSI.gray),t.addLine(i,ANSI.gray),d(r),t.addLine(lf),!options.noteend&&options.notes&&l.length&&t.addLine(ANSI.reset+l.join("")),options.noteend||(l=[],a=0)),options.desktop||(t.addLine(" %0Chrome/A  %1|%0 Edge/mob  %1|%0 Firefox/A %1|%0 Opera/A   %1|%0Safari/iOS %1|%0 %0Webview/A%1",ANSI.green,ANSI.gray),t.addLine(i,ANSI.gray),d(o),t.addLine(lf),!options.noteend&&options.notes&&l.length&&t.addLine(ANSI.reset+l.join(""))),options.ext&&(t.addLine(" %0Node JS   %1|%0 QQ/A      %1|%0 Samsung/A %1|%0 UC/A      %1|%0 UC-Ch/A%1",ANSI.green,ANSI.gray),t.addLine(i.substr(0,i.length-12),ANSI.gray),d(n),t.addLine(lf),options.notes&&l.length&&t.addLine(ANSI.reset+l.join(""))),options.specs&&e.specs&&e.specs.length&&(t.addLine(ANSI.cyan+"Specifications:"+lf),e.specs.forEach(e=>{t.addLine(ANSI.white+`${entities(e.name)}${lf}  ${function(e){switch(e.toUpperCase()){case"REC":return ANSI.green+"Recommendation"+ANSI.reset+lf;case"PR":return ANSI.yellow+"Proposed Recommendation"+ANSI.reset+lf;case"CR":return ANSI.cyan+"Candidate Recommendation"+ANSI.reset+lf;case"RC":return ANSI.cyan+"Release Candidate"+ANSI.reset+lf;case"WD":return ANSI.blue+"Working Draft"+ANSI.reset+lf;case"ED":return ANSI.green+"Editor's Draft"+ANSI.reset+lf;case"OLD-TRANSFORMS":return ANSI.orange+"This has been merged in another draft."+ANSI.reset+lf;case"LIVING":return ANSI.cyan+"Living Standard"+ANSI.reset+lf;case"RFC":return ANSI.yellow+"IETF RFC"+ANSI.reset+lf;case"STANDARD":return ANSI.green+"Standard"+ANSI.reset+lf;case"DRAFT":return ANSI.yellow+"Draft"+ANSI.reset+lf;case"OBSOLETE":return ANSI.red+"Obsolete"+ANSI.reset+lf;case"LC":return ANSI.yellow+"Last Call Working Draft"+ANSI.reset+lf;default:return ANSI.yellow+e+ANSI.reset+lf}}(e.status)}  ${e.url}`)}),t.addLine()),t.trimEnd(lf.length),t.toString()}function compatToShort(e,t){let r=e.prePath+e.name,o=new Output(0),n=["chrome","edge","firefox","ie","opera","safari"],s=["chrome_android","firefox_android","edge_mobile","opera_android","safari_ios","android"],i=["nodejs","qq_android","samsunginternet_android","uc_android","uc_chinese_android"],a=["C:","E:","F:","IE:","O:","S:"],l=["CA:","FA:","EM:","OA:","Si:","WA:"],d=["ND:","QQ:","SM:","UC:","UCC:"];function c(t,r){t.forEach((t,n)=>{let s,i=e.getBrowser(t);i?(s=i.info[0].getVersion(),i.hasNotes()&&(s+=ANSI.white+"*")):s=ANSI.red+no,o.add(ANSI.green,r[n],ANSI.white,s," ")})}return o.add(ANSI.white),options.shorthandSplit?o.add(r,":",lf):o.add(r.padEnd(t),":"),options.mobile||(o.add(ANSI.cyan+"  D: "),c(n,a)),options.desktop||(o.add(ANSI.cyan+"  M: "),c(s,l)),options.ext&&(o.add(ANSI.cyan+"  X: "),c(i,d)),o.trimEnd(1),o.toString()}function compatToSVG(e){const t=require("./svgdefs"),r=new Output,o=["chrome","edge","firefox","ie","opera","safari"],n=["android","chrome,android","edge","firefox,android","opera,android","safari"],s=["Chrome","Edge","Firefox","IE","Opera","Safari"],i=["Webview for Android","Chrome for Android","Edge for mobile","Firefox for Android","Opera for Android","Safari for iOS"],a=["webview_android","chrome_android","edge_mobile","firefox_android","opera_android","safari_ios"],l={desktop:!options.mobile,mobile:!options.desktop,showNotes:!options.noNotes},d=options.width,c=l.mobile,p=l.desktop,u=d-0,h=c&&p?u/2+0:0,f=u/(c&&p?12:6),g=20,S="#E4F7E1",m="#FBE3E3",A=45;let I,N,w=[],b=0,y=1,x=50+2*A;for(r.add('<svg xmlns="http://www.w3.org/2000/svg" %1width="%0">',options.width,e.url.length?'xmlns:xlink="http://www.w3.org/1999/xlink" ':""),r.add("\x3c!-- Made by mdncomp v. "+version+" --\x3e"),(l.desktop||l.mobile)&&(P("chrome",t.chrome),P("firefox",t.firefox),P("edge",t.edge),P("opera",t.opera1,t.opera2),P("ie",t.ie),P("safari",t.safari)),l.desktop&&P("desktop",t.desktop),l.mobile&&(P("mobile",t.mobile),P("android",t.android1,t.android2)),e.hasFlags()&&P("flag",t.flag1,t.flag2,t.flag3),e.standard&&P("html5",t.html5),e.deprecated&&P("thumb",t.thumb),e.experimental&&P("lab",t.lab),e.url.length&&P("link",t.link1,t.link2),e.url?(r.add('<a xlink:href="%0" style="cursor:pointer" target="_blank">',e.url),L(e.prePath,e.name,1,46,26),O("link",d-28,26,24,24,"#777"),r.add("</a>")):L(e.prePath,e.name,g,50,32),e.deprecated&&C("thumb","Deprecated",24,"#a00"),e.experimental&&C("lab","Experimental",0,"#c70"),e.standard&&C("html5","On standard track",0,"#070"),r.add('<g transform="translate(0, 104)">'),_(0,0,d,x,"#eaedf2"),l.desktop&&E(o,s,0,50+A),l.mobile&&E(a,i,h,50+A),N=0;N<d;N+=f)v(0|N,50,0|N,x,1,"#999");if(c&&v(h,0,h,x,2),v(0,50,d,50,2),v(0,50+A,d,50+A,1),v(0,x,d,x,2),p)for(O("desktop",((c?u/2:u)-20)/2+0,15,20,20),I=0,N=0;I<o.length;I++)O(o[I],N+f*I+(f-20)/2,50+(A-20)/2,20,20,"#676769",s[I]);if(c)for(O("mobile",((p?u/2:u)-20)/2+h,15,20,20),I=0,N=h;I<n.length;I++){let e=n[I].split(",");e.forEach((t,r)=>{O(t,(2===e.length?r?1.5:-1.5:0)+N+20*r+f*I+(f-20*e.length)/2,50+(A-20)/2,20,20,"#676769",i[I])})}function E(t,r,o,n){options.maxWidth=(d-60)/8,t.forEach((t,r)=>{let s,i,a,l,c=e.getBrowser(t),p=o+f*r,u=p+.5*f;if(c){if(a=c.hasFlags(),l=c.hasPrefix(),s=c.info[0].getVersion().replace("Y",yes16),c.hasNotes()){i=options.notes?++b:"*";let e=c.getNotes(b);e=(e+"").ansiFree().replace(/</g,"&lt;").replace(/>/g,"&gt;"),w.push(e)}}else s=no;_(p,n,f,A,s.indexOf("-")>=0?m:"?"===s?"#eaedf2":S),"-"===s?k(no16,u,n+28,0,0,"#c55","middle"):k(s,u,n+28,d<800?12:0,0,s.indexOf("-")<0&&s.indexOf("?")<0?"#070":"#000","middle"),i&&k(i,p+f-12,n+13,10,"#000","end"),a&&O("flag",p+5,n+5,10,10,"#555"),l&&k(c.prefix,p+5,n+41,12,!1,"#334")})}function C(e,t,r,o){r=r||14;e&&(O(e,y,69+(14===r?2:1),r,r,o),y+=20),k(t,y,84,16,!0,o),y+=110}function v(e,t,o,n,s,i){s/2!=s>>>1&&(e+=.5,t+=.5,o+=.5,n+=.5),r.add('<line x1="%0" y1="%1" x2="%2" y2="%3"  stroke="%5" stroke-width="%4" />',e,t,o,n,s||1,i||"#000")}function _(e,t,o,n,s,i){r.add('<rect x="%0" y="%1" width="%2" height="%3" fill="%4"%5 />',e,t,o,n,s,i?' title="'+i+'"':"")}function k(e,t,o,n,s,i,a){a=a?' text-anchor="'+a+'" ':"",r.add('<text x="%1" y="%2" fill="%5" %6font-family="%4" font-size="%3">%0</text>',e,t,o,n||16,s?"sans-serif":"Consolas, monospace",i||"#000",a)}function L(e,t,o,n,s){r.add('<text x="%2" y="%3" font-family="Consolas, monospace" font-size="%4"><tspan fill="#777">%0</tspan><tspan fill="#000">%1</tspan>',e,t,o,n,s||16),r.add("</text>")}function O(e,t,o,n,s,i,a){i=i?' fill="'+i+'"':"",a&&r.add("<g><title>%0</title>",a),arguments.length>3?r.add('<use href="#icon-%0" x="%1" y="%2" width="%3" height="%4"%5></use>',e,t,o,n,s,i):r.add('<use href="#icon-%0" width="%1" height="%2"%3></use>',e,t,o,i),a&&r.add("</g>")}function P(e,t){r.add('<symbol id="icon-%0" viewBox="-1 -1 34 34">',e);for(let e=1;e<arguments.length;e++)r.add('<path d="%0"></path>',arguments[e]);r.add("</symbol>")}return options.notes&&w.length&&(x+=16,w.forEach(e=>{!function(e){let t=e.split(lf),r=new Output;t.forEach(e=>{r.add('<tspan x="%0" dy="1.3em">',g),r.add(e),r.add("</tspan>")}),k(r.toString(),10,x,14),x+=15*t.length}(e)})),k('Data from MDN - "npm i -g mdncomp" by epistemex Â© 2018.',1,x+=45,14,!0,"#777"),r.add("</g></svg>"),r.toString()}function MDNComp(e){let t=getPathAsObject(e).__compat,r=["webview_android","chrome","chrome_android","edge","edge_mobile","firefox","firefox_android","ie","opera","opera_android","safari","safari_ios"],o=[!1,!0,!1,!0,!1,!0,!1,!0,!0,!1,!0,!1],n=t.status||{},s=Object.keys(t.support);this.path=e,this.prePath=prePathFromPath(e),this.name=nameFromPath(e),this.url=t.mdn_url&&t.mdn_url.length?"https://developer.mozilla.org/docs/"+t.mdn_url:null,this.specs=t.specs||[],this.experimental=n.experimental,this.standard=n.standard_track,this.deprecated=n.deprecated,this.browsers=[],this.description=t.description||"",s.forEach(e=>{let n=r.indexOf(e);if(n>=0){let r=new Browser(t,e);r.isDesktop=o[n],this.browsers.push(r)}})}function Info(e){this.added=this.toStatus(e.version_added),this.removed=this.toStatus(e.version_removed),this.notes=e.notes?Array.isArray(e.notes)?e.notes:[e.notes]:[],this.flags=e.flags||[],e.prefix&&this.notes.unshift("Prefix: "+e.prefix),e.partial_implementation&&this.notes.unshift("Is partial implementation."),e.alternative_name&&this.notes.unshift("Uses a non-standard name: "+e.alternative_name),this.flags.forEach(e=>{this.notes.push(this.flagToString(e))})}function Browser(e,t){this.name=t,this.info=[];let r=e.support[t];Array.isArray(r)||(r=[r]),this.prefix=(r[r.length-1]||{}).prefix||"",r.forEach(e=>{this.info.push(new Info(e))})}function Output(e){this.string="",this.indent="    ".substr(0,0|e),this.linefeed=lf}tagParser.skip=!1,tagParser.skipLF=!1,MDNComp.prototype={getBrowser:function(e){for(let t of this.browsers)if(t.name===e)return t;return null},getStatus:function(){let e="(";return this.deprecated?e+=ANSI.red+"DEPRECATED"+ANSI.reset+", ":(this.experimental&&(e+=ANSI.yellow+"EXPERIMENTAL"+ANSI.reset+", "),this.standard&&(e+=ANSI.green+"On Standard Track"+ANSI.reset+", ")),"()"===(e=e.substr(0,Math.max(1,e.length-2))+")")?"":e},hasFlags:function(){for(let e of this.browsers)if(e.hasFlags())return!0;return!1}},Info.prototype={getVersion:function(){return this.removed?this.added+"-"+this.removed.replace("Y","?"):this.added},flagToString:function(e){switch(e.type){case"preference":return t("Behind flag "+ANSI.cyan);case"compile_flag":return t("Compile with "+ANSI.cyan);case"runtime_flag":return t("Run with "+ANSI.cyan)}function t(t){return t+e.name+ANSI.reset+(e.value_to_set?" set to "+e.value_to_set:"")+"."}return""},toString:function(e){let t=(e?e+") ":"")+(isNaN(this.added)?"":this.getVersion()+": "),r="",o=new Output(0);return this.notes.length?(this.notes.length>1&&(t+=lf,r="- "),this.notes.forEach(e=>{o.addLine(cleanHTML(r+e,!0))}),t+o.toString()):""},toStatus:function(e){return"boolean"==typeof e?e?"Y":no:null===e?"?":e||null}},Browser.prototype={hasNotes:function(){for(let e of this.info)if(e.notes.length)return!0;return!1},hasFlags:function(){for(let e of this.info)if(e.flags.length)return!0;return!1},hasPrefix:function(){return this.prefix.length},getNotes:function(e){let t=new Output(0);return this.info.forEach(r=>{let o=breakAnsiLine(r.toString(e),options.maxChars);o.length&&t.addLine(o)}),t.toString()}},Output.prototype={add:function(e){if(e=e||"",arguments.length>1){let t=e.indexOf("%0")>=0;for(let r=1;r<arguments.length;r++){let o=new RegExp("%"+(r-1),"g");e=t?e.replace(o,arguments[r]):e+arguments[r]}}this.string+=this.indent+(e||"")},addLine:function(e){this.add.apply(this,arguments),this.string+=this.linefeed},trimEnd:function(e){this.string=this.string.substr(0,Math.max(0,this.string.length-e))},replace:function(e,t){let r=new RegExp(e,"g");this.string=this.string.replace(r,t)},toString:function(){return this.string}};