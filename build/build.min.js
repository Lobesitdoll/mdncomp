/*!
	mdncomp (version: see package.json)
	Copyright (c) 2018 Epistemex
	www.epistemex.com
*/
"use strict";module.exports=init,String.prototype.padStart||(String.prototype.padStart=function(e,t){return e>>=0,t=String(void 0!==t?t:" "),this.length>e?String(this):((e-=this.length)>t.length&&(t+=t.repeat(e/t.length)),t.slice(0,e)+String(this))}),String.prototype.padEnd||(String.prototype.padEnd=function(e,t){return e>>=0,t=String(void 0!==t?t:" "),this.length>e?String(this):((e-=this.length)>t.length&&(t+=t.repeat(e/t.length)),String(this)+t.slice(0,e))}),String.prototype.includes||(String.prototype.includes=function(e,t){return-1!==this.indexOf(e,0|t)}),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(t>>>0,e.length)===e}),String.prototype.endsWith||(String.prototype.endsWith=function(e,t){return(void 0===t||t>this.length)&&(t=this.length),this.substring(t-e.length,t)===e}),String.prototype.repeat||(String.prototype.repeat=function(e){if(e>>>=0,!this.length||!e)return"";if(this.length*e>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");let t="";for(let r=0;r<e;r++)t+=this;return t}),Array.prototype.includes||(Array.prototype.includes=function(e){return this.indexOf(e)>=0}),String.prototype.centerAnsi=function(e){let t=e-this.ansiLength()>>>1,r=" ".repeat(t)+this+" ".repeat(t);return" ".substr(0,e-r.ansiLength())+r},String.prototype.ansiLength=function(){return this.ansiFree().length},String.prototype.ansiFree=function(){return this.replace(/\x1b[^m]*m/g,"")};const ANSI=require("./ansi"),version=require("../package.json").version,args=process.argv,log=console.log.bind(console),saves=[],lf="\r\n",yes="Y",no="-";let mdn,io,cfg,util,crypto,options,isoLang="en-US",shortPad=1;function buildTable(){const e=[];return listTopLevels().forEach(t=>{"browsers"!==t&&function t(r,n,o){const s=r[n];"object"==typeof s&&Object.keys(s).forEach(r=>{"__compat"!==r&&(e.push(o+"."+r),t(s,r,o+"."+r))})}(mdn,t,t)}),e}function listTopLevels(){let e=Object.keys(mdn),t=e.indexOf("browsers");return t>=0&&e.splice(t,1),e}function getComparer(e,t,r){let n,o,s="",i="";e.startsWith("/")?(e=(o=(e=e.substr(1)).split("/"))[0],s=o[1]):t?e=function(e){let t=[],r="";e.endsWith(".")&&(r="$",e=e.substr(0,e.length-1));for(let r of e)t.push("\\^$.*+?()[]{}|".includes(r)?"\\"+r:r);return t.join(".*?")+r}(e.toLowerCase()):(e.endsWith(".")&&(e=e.substr(0,e.length-1),i="$"),e.startsWith("*")||(e="*"+e),e.endsWith("*")||i.length||(e+="*"),e=e.split("*").join(".*")+i),r&&!s.includes("i")&&(s+="i");try{n=new RegExp(e,s)}catch(e){log("Invalid regular expression:",e.message),process.exit(-1)}return n}function getPathAsObject(e,t){let r=e.split("."),n=mdn;return r.forEach(e=>{n&&n[e]&&(n=n[e])}),t&&Object.keys(n).forEach(e=>{n&&n[e].__compat&&delete n[e]}),n}function nameFromPath(e){let t=getExt(e);return t.length?t:e}function getExt(e){if("string"!=typeof e)return"";let t=e.lastIndexOf(".");return t<0?"":e.substr(++t)}function prePathFromPath(e){let t=e.split("."),r=mdn,n="";return t.pop(),t.forEach(e=>{r&&(r[e].__compat&&(n+=e+"."),r=r[e])}),n.length>1?n:""}function isCompat(e){let t=getPathAsObject(e);return!!t&&"object"==typeof t.__compat}function cleanHTML(e,t,r){return e=e.replace(/<code>/gi,ANSI.cyan).replace(/<\/code>/gi,r||ANSI.reset).replace(/(<([^>]+)>)/gi,""),t&&(e=e.replace(/&lt;/gi,"<").replace(/&gt;/gi,">")),e}function breakAnsiLine(e,t){let r,n=[],o=0,s=0,i=0,a=-1,l=!1,d=Math.max(72,t>>>0);for(;r=e[o];)l?"m"===r&&(l=!1):""===r?l=!0:(" "!==r&&"\n"!==r||(a=o),++s!==d&&"\n"!==r||(a<0&&(a=o),n.push(e.substring(i,a).trim()),i=a,a=-1,s=o-i)),o++;return s&&n.push(e.substr(i)),n.forEach((e,t)=>{n[t]=e.trim()}),n.length?n.join(lf):""}function getMaxLength(e){let t=0;return e.forEach(e=>{let r=(prePathFromPath(e)+nameFromPath(e)).length;r>t&&(t=r)}),t}function entities(e){return e.replace(/&nbsp;/gim," ").replace(/&quot;/gim,'"').replace(/&amp;/gim,"&").replace(/&lt;/gim,"<").replace(/&gt;/gim,">")}function parseHelp(e){if(e.length<4)log(),log("  Examples:"),log("    mdncomp arcTo                   show information for arcTo"),log("    mdncomp html*toblob.            will find HTMLCanvasElement.toBlob"),log("    mdncomp -z hctbb.               will find HTMLCanvasElement.toBlob (fuzzy)"),log("    mdncomp --list .                list all top-level paths"),log();else{let t="-h"===e[2].toLowerCase()||"--help"===e[2].toLowerCase()?e[3]:e[2],r=require("./help").help[t];log(),log(`${ANSI.yellow}Help for option "${t}"${ANSI.reset}`),log(r||"Unknown option."),log()}}function init(){3===args.length&&"--configpath"===args[2]?log(ANSI.white+require("./io").getConfigPath()+ANSI.reset):args.length>=3&&args.length<=4&&("--update"===args[2]||"--fupdate"===args[2]||"--cupdate"===args[2])?(4===args.length&&"--diff"!==args[3]&&(log(ANSI.white+"Invalid option. Needs to be: --[*]update [--diff]"+ANSI.reset),process.exit(1)),require("./update")("--fupdate"===args[2],"--cupdate"===args[2],"--diff"===args[3])):((options=require("commander")).version(version,"-v, --version").usage("[options] <feature>").description("Get MDN Browser Compatibility Data, docs and specs."+lf+"  Version: "+version+lf+"  (c) 2018 epistemex.com").option("-l, --list","List paths starting with the given value or '.' for top-level").option("-o, --out <path>","Save information to file. Use extension for type (.txt or .ansi)").option("-x, --overwrite","Overwrites an existing file with --out option").option("-d, --desktop","Show desktop only").option("-m, --mobile","Show mobile devices only").option("-c, --case-sensitive","Search in case-sensitive mode").option("-a, --all","If search results in more than entry, show info for all").option("-z, --fuzzy","Use path as a fuzzy search term").option("-i, --index <index>","Show this index from a multiple result list",-1).option("-s, --shorthand","Show compatibility as shorthand with multiple results").option("-h, --split","Split a shorthand line into two lines (use with -s)").option("-b, --browser","Show information about this browser, or list if '.'").option("-N, --no-notes","Don't show notes").option("-e, --noteend","Show notes at end instead of in sections (text)").option("-f, --markdown","Format link as markdown and turns off colors").option("--ext","Show extended table of browsers/servers").option("--desc","Show Short description of the feature").option("--specs","Show specification links").option("--doc","Show documentation. Show cached or fetch").option("--docforce","Show documentation. Force fetch from MDN server").option("--mdn","Open entry's document URL in default browser").option("--waitkey","Wait for ENTER key before continuing").option("--random","Show a random entry. (mdncomp --random . )").option("--update, --fupdate, --cupdate","Update data from remote (--fupdate=force, --cupdate=check)").option("--diff","Only valid appended to --[*]update. Shows list of new features").option("--no-colors","Don't use colors in output").option("--max-chars <width>","Max number of chars per line before wrap",72).option("--no-config","Ignore config file (mdncomp.json) in config folder").option("--configpath","Show path to where config file and cache is stored").action(go).on("--help",()=>{parseHelp(args)}).parse(args),options.args.length||options.help())}function outInfo(e){Array.isArray(e)&&(e=e.join(lf)),log(e+ANSI.reset)}function outStore(e,t){Array.isArray(e)&&(e=e.join(lf)),t||!options.out?log(e):saves.push(e)}function go(e){io=require("./io"),"string"!=typeof e&&(e=".");try{mdn=require("../data/data.json")}catch(e){log("Critical error: data file not found. Try running with option --fupdate to download latest snapshot."),process.exit(1)}try{loadConfig()}catch(e){}if(options.desktop&&options.mobile&&(options.desktop=options.mobile=!1),options.colors&&!options.markdown&&"txt"!==getExt(options.out||".ansi")||Object.keys(ANSI).forEach(e=>{e.includes("ursor")||(ANSI[e]="")}),options.random&&(e=randomCompat(e),options.index=0),options.list)if("."===e)outInfo(ANSI.reset+"Valid path roots:"),outInfo(ANSI.green+listTopLevels().join(lf)+ANSI.reset),outInfo(lf+"Valid statuses:"),outInfo(ANSI.green+"standard, experimental, deprecated"+ANSI.reset);else if(["deprecated","experimental","standard"].includes(e))outInfo(listOnStatus(e));else{let t=list(e,options.caseSensitive);1===t.length&&isCompat(t[0])?(options.list=void 0,go(t[0])):outInfo(t)}else if(options.browser)"."===e?(outInfo(ANSI.reset+"Valid browser identifiers:"),outInfo(ANSI.green+listBrowsers().join(lf)+ANSI.reset),outInfo(lf+"Valid statuses:"),outInfo(ANSI.green+getBrowserStatusList().join(", "))):outInfo(listBrowser(e.toLowerCase()).join(lf));else{let r=search(e,options.caseSensitive);if(r.length)if(1===r.length||options.index>=0&&options.index<r.length||options.all){if(options.shorthand&&(shortPad=getMaxLength(r)),options.index>=0&&options.index<r.length&&(r=r.splice(options.index,1)),r.forEach(e=>{!function(e){let t=new MDNComp(e);outStore(options.shorthand?compatToShort(t,shortPad):compatToLong(t))}(e)}),1===r.length){let e=new MDNComp(r[0]);options.doc||options.docforce?e.url.length?getDoc(e.url,t):(outInfo(ANSI.red+"Documentation URL is not defined for this feature."+ANSI.reset+lf),t()):t(),options.mdn&&(e.url.length?io.run(e.url):log("No URL is defined for this entry."))}}else{let e=(r.length+"").length;r.forEach((t,r)=>{outInfo(ANSI.yellow+"["+ANSI.green+(r+"").padStart(e)+ANSI.yellow+"] "+ANSI.white+t+ANSI.reset)})}else outInfo("Not found.");function t(){outStore(ANSI.magenta+"Data from MDN - `npm i -g mdncomp` by epistemex"+ANSI.white+lf+ANSI.reset),function(){let e;if(options.out&&saves.length)if((e=require("fs")).existsSync(options.out)&&!options.overwrite){const e=require("readline"),r=e.createInterface({input:process.stdin,output:process.stdout});r.question(ANSI.yellow+"A file with this name already exists. Overwrite? (y(es), default: no)? "+ANSI.white,e=>{e.startsWith("y")?t(()=>{r.close()}):(log("File not saved."),r.close(),process.exit())})}else t();function t(t){e.writeFile(options.out,saves.join("\n"),"utf8",function(e){if(e)return log("An error occurred:"+lf+e);log(ANSI.green+`Saved output to file "${ANSI.cyan+options.out+ANSI.green}"!`+ANSI.reset),t&&t()})}}(),options.waitkey&&(console.log(ANSI.cursorUp+ANSI.cursorUp),setTimeout(()=>console.log("Waiting for ENTER key..."+ANSI.cursorUp),3e3),process.stdin.on("data",()=>process.exit()))}}}function loadConfig(){fs||(fs=require("fs")),path||(path=require("path"));const e=path.resolve(io.getConfigDataPath(),".config.json");if(fs.existsSync(e)){let t=(cfg=require(e)).options||cfg||{};delete t.browser,delete t.list,delete t.out,delete t.all,delete t.index,delete t.random,Object.assign(options,t)}}function search(e,t){let r,n=buildTable(),o=[];return r=getComparer(e,options.fuzzy,!t),n.forEach(e=>{r.test(e)&&isCompat(e)&&o.push(e)}),o}function list(e,t){const r=t?e:e.toLowerCase(),n=buildTable(),o=[],s=r.split(".").length+1;let i,a="";n.forEach(e=>{(i=t?e:e.toLowerCase()).startsWith(r)&&e.split(".").length<=s&&e!==a&&o.push(a=e)});let l=e.lastIndexOf(".")+1;return o.forEach((e,t)=>{let r=e.lastIndexOf(".")+1;o[t]=ANSI.reset+(l?e.substr(0,l)+ANSI.cyan+(r>l?e.substring(l,r)+ANSI.white+e.substr(r):e.substr(l)):e)}),o}function listOnStatus(e){const t=[],r=listTopLevels();function n(t){return!!(t.__compat.status||{})[e]}"standard"===e&&(e="standard_track"),r.forEach(e=>{let r=mdn[e];r.__compat&&n(r)&&t.push(e),Object.keys(mdn[e]).forEach(r=>{let o=mdn[e][r];o.__compat&&n(o)&&t.push(e+"."+r),Object.keys(mdn[e][r]).forEach(o=>{let s=mdn[e][r][o];o.__compat&&n(s)&&t.push(e+"."+r+"."+o)})})});let o="deprecated"===e?ANSI.red:"experimental"===e?ANSI.yellow:ANSI.green;return t.forEach((e,r)=>{let n=e.lastIndexOf(".")+1;t[r]=ANSI.reset+e.substr(0,n)+o+e.substr(n)}),t.sort()}function listBrowsers(){return Object.keys(mdn.browsers)}function listBrowser(e){const t=mdn.browsers[e],r=[];if(!t)return getBrowserStatusList().includes(e)?listBrowserOnStatus(e):["Unknown browser-id: '"+e+"' - Use '.' to list all valid IDs."];let n=0,o=0;Object.keys(t.releases).forEach(e=>{let t=e.split(".");t[0].length>n&&(n=t[0].length),e.length-t[0].length>o&&(o=e.length-t[0].length)});let s=0;return getBrowserStatusList().forEach(e=>{e.length>s&&(s=e.length)}),Object.keys(t.releases).sort(function(e,t){let r=e.split("."),n=t.split("."),o=(0|r[0])+.001*(0|r[1])+1e-6*(0|r[2])+1e-9*(0|r[3]),s=(0|n[0])+.001*(0|n[1])+1e-6*(0|n[2])+1e-9*(0|n[3]);return o>s?1:o<s?-1:0}).forEach(i=>{let a=ANSI.white+(t.name||e)+"  "+ANSI.green+_fBrowserVersion(i,n,o),l=t.releases[i].release_date,d=t.releases[i].release_notes,p=t.releases[i].status;a+="  "+(l?ANSI.cyan+l:ANSI.gray+"-         "),a+="  "+(p?_browserStatusColor(p)+p.padEnd(s)+(options.notes&&d?"  "+ANSI.reset+d:"")+ANSI.reset+ANSI.white:"-"),r.push(a+ANSI.white)}),r}function listBrowserOnStatus(e){let t=[],r=_browserStatusColor(e),n=_iterateBrowsers((t,r,n,o,s)=>{let i=t.release_date;return t.status&&t.status===e?{browser:s||r,version:n,notes:t.release_notes,date:i||"-"}:null}),o=0,s=0,i=0;return n.forEach(e=>{let t=e.version.split(".");e.browser.length>o&&(o=e.browser.length),t[0].length>s&&(s=t[0].length),e.version.length-t[0].length>i&&(i=e.version.length-t[0].length)}),t.push(ANSI.reset+"STATUS: "+ANSI.reset+ANSI.white+r+e.toUpperCase()+ANSI.reset),n.forEach(e=>{t.push(ANSI.white+e.browser.padEnd(o)+ANSI.white+"  "+r+_fBrowserVersion(e.version,s,i)+ANSI.white+ANSI.dim+"  "+("-"===e.date?ANSI.gray:ANSI.reset+ANSI.bright+ANSI.cyan)+e.date+(options.notes&&e.notes&&e.notes.length?"  "+ANSI.reset+e.notes:"")+ANSI.reset)}),t}function getBrowserStatusList(){return _iterateBrowsers((e,t,r,n)=>n.includes(e.status)?null:e.status).sort()}function _browserStatusColor(e){switch(e){case"retired":return ANSI.red;case"beta":case"alpha":return ANSI.yellow;case"nightly":return ANSI.blue;case"current":case"esr":return ANSI.green;case"planned":return ANSI.magenta;default:return ANSI.white}}function _iterateBrowsers(e){const t=mdn.browsers,r=[];return Object.keys(t).forEach(n=>{let o=t[n].name;Object.keys(t[n].releases).forEach(s=>{let i=e(t[n].releases[s],n,s,r,o);i&&r.push(i)})}),r}function _fBrowserVersion(e,t,r){let n=e.split(".");return n[0].padStart(t)+n.join(".").substr(n[0].length).padEnd(r)}const tagParser=require("./tagparser");function getDoc(e,t){let r=ANSI.clrToCursor+ANSI.cursorUp,n=io.getCachedData(e);if(n&&!options.docforce)log(),a(n);else{log(ANSI.green+"Fetching documentation...");let n=e.replace("mozilla.org/","mozilla.org/"+isoLang+"/")+"?raw&macros";io.request(n,()=>!s(),e=>{let t=Math.round(50*e),n=50-t;log(r+ANSI.white+"Downloading doc "+ANSI.white+"["+ANSI.green+"#".repeat(t)+" ".repeat(n)+ANSI.white+"]"+ANSI.reset+ANSI.black)},e=>{let t,r,n=['id="wikiArticle"',"</section>"],o=['id="Example','id="Specification','id="Browser_compatibility'];for(let r of n)if((t=e.indexOf(r))>=0)break;if(t<0)log("Cannot parse this documentation source.");else{for(let n of o)if((r=e.indexOf(n,t))>=0)break;r<0&&(r=e.length),i(e=e.substring(e.lastIndexOf("<",t),e.lastIndexOf("<",r)))}},e=>{o=lf+"An error occurred -"+lf+"Status code: "+e.statusCode+(e.error?lf+"Message: "+e.error:"")+ANSI.reset,log(r+ANSI.red+o+ANSI.white),t()})}var o;function s(){log(r+"".padStart(options.maxChars," "))}function i(t){s(),log(ANSI.cursorUp+ANSI.cursorUp);let r=ANSI.reset+t,n="#LF#",o=!1,i=0;r=r.replace(/\t/gm," ");let l=!1;const d=/=.*brush:\s?(html)/i,p=/.*class=.*optionalInline/i,c=/.*class=.*(experimental|deprecated)/i;function u(e,t,r){return t.test(e.substring(r.tagStart,r.tagEnd))}r="#"+(r=(r=(r=(r=entities(r=tagParser(r,e=>{switch(e.name){case"div":return u(r,c,e)&&(tagParser.skip=!0),"";case"/div":return o||(tagParser.skip=!1),"";case"span":return u(r,p,e)&&(l=!0),l?ANSI.white+" ("+ANSI.green:"";case"/span":let t="";return!o&&l&&(l=!1,t=ANSI.white+") "+ANSI.reset),t;case"table":return tagParser.skipLF=!0,ANSI.gray+"--LINE--"+ANSI.reset+n;case"/table":return tagParser.skipLF=!1,ANSI.gray+"--LINE--"+ANSI.reset+n;case"math":return tagParser.skip=!0,ANSI.blue+" --math formula not shown--"+ANSI.reset;case"section":return tagParser.skip=!0,"";case"/math":case"/section":return tagParser.skip=!1,"";case"/th":case"/td":return"\t";case"/tr":return n;case"dl":case"ul":return tagParser.skipLF=!0,n;case"/dl":case"/ul":return tagParser.skipLF=!1,"";case"br":case"/p":return n;case"h2":case"h3":case"h4":return n+ANSI.yellow;case"/h2":case"/h3":case"/h4":case"/dt":return ANSI.reset+n;case"/dd":case"/li":return i--,ANSI.reset+n;case"pre":return o=!0,u(r,d,e)&&(tagParser.skip=!0),tagParser.skip?"":ANSI.blue+"--LINE--"+ANSI.cyan+n;case"/pre":let s=tagParser.skip?"":n+ANSI.blue+"--LINE--"+ANSI.reset+n;return o=tagParser.skip=!1,s;case"code":return ANSI.cyan;case"/code":return ANSI.reset;case"dt":return ANSI.white+"*".repeat(Math.max(0,i+1))+ANSI.reset+" ";case"dd":case"li":return i++,ANSI.white+"-".repeat(Math.max(0,i))+ANSI.reset+" ";default:return""}},e=>o&&"\n"===e?n:e))).replace(/\n\s*\n/gim,"")).replace(new RegExp(n,"gm"),lf)).replace(lf+lf+ANSI.blue+"--LINE--",lf+ANSI.blue+"--LINE--")),io.setCachedData(e,r),a(r)}function a(e){if(!e.startsWith("#"))return void i(e);e=e.substr(1);let r="-".repeat(options.maxChars-1),n=(e=e.replace(/--LINE--/gm,r)).split(lf),o=-1;function s(t,r){let n="",o=e.indexOf(t),s=t.length;o>=0&&o<10&&(o=options.maxChars-s-2>>1,n=ANSI.red+"/".repeat(o-1)+r+" "+t.toUpperCase()+" "+ANSI.red+"/".repeat(o)+ANSI.reset+lf,e=n+e.substr(o+s+1))}e="",n.forEach((t,r)=>{let s=/\s\s+/g;if(o<0&&t.includes("\t")){let e,t;for(e=r;e<n.length&&(t=n[e]).includes("\t");e++)(t=t.split("\t")[0].trim()).length>o&&(o=t.length);o++}if(t.includes("\t")){let e=t.split("\t");t=ANSI.white+(e[0].trim().padEnd(o)+ANSI.reset+(e[1].trim()||"")),s="x79y"}else o>0&&(o=-1);e+=breakAnsiLine(t.replace(s," ").trim(),options.maxChars).trim()+lf}),s("Draft",ANSI.yellow),s("Obsolete",ANSI.red),e=ANSI.reset+e.trim()+lf,options.colors||(e=e.replace(/\x1b[^m]*m/gm,"")),outStore(e),t()}}function randomCompat(e,t){let r,n,o,s=buildTable(),i=[];for("."!==e&&(o=getComparer(e,options.fuzzy,!t),s.forEach(e=>{o.test(e)&&i.push(e)}),s=i);!r;)if((r=isCompat(s[n=Math.random()*s.length|0]))&&(options.doc||options.docforce||options.desc)){let e=getPathAsObject(s[n]).__compat;e.mdn_url&&e.mdn_url.length||(r=!1)}return s[n]}function compatToLong(e){let t=new Output(0),r=["chrome","edge","firefox","ie","opera","safari"],n=["chrome_android","edge_mobile","firefox_android","opera_android","safari_ios","webview_android"],o=["nodejs","qq_android","samsunginternet_android","uc_android","uc_chinese_android"],s=["°","¹","²","³","ª","^","`","'",'"',"'\"",'""','""\'',"º"],i=" %0----------+-----------+-----------+-----------+-----------+-----------",a=0,l=[];if(t.addLine(ANSI.reset),options.markdown&&e.url?t.addLine(" [`%0%1`](%2) %3"+lf,e.prePath,e.name,e.url,e.getStatus()):(t.addLine(" %0%1%2%3%4 %5",ANSI.cyan,e.prePath,ANSI.white,e.name,ANSI.white,e.getStatus()),t.addLine(" ",e.url?ANSI.gray+e.url:"-",lf)),options.desc&&e.description&&e.description.length){let r=entities(ANSI.reset+breakAnsiLine(cleanHTML(e.description),options.maxWidth));t.addLine(r,lf)}function d(r){r.forEach(r=>{let n,o=e.getBrowser(r);o?(n=o.info[0].getVersion(),o.hasNotes()&&(n+=ANSI.yellow+(options.notes?s[a]:"*"),l.push(o.getNotes(s[a])),a=++a%s.length),"?"===n&&(n=ANSI.yellow+"?")):n=ANSI.red+no,t.add("%0"+n.centerAnsi(11)+ANSI.gray+"|",n.indexOf(no)>=0?ANSI.red:ANSI.green)}),t.trimEnd(1)}return options.mobile||(t.addLine(" %0Chrome    %1|%0 Edge      %1|%0 Firefox   %1|%0 IE        %1|%0 Opera     %1|%0 Safari%1",ANSI.white,ANSI.gray),t.addLine(i,ANSI.gray),d(r),t.addLine(lf),!options.noteend&&options.notes&&l.length&&t.addLine(ANSI.yellow+l.join("")),options.noteend||(l=[],a=0)),options.desktop||(t.addLine(" %0Chrome/A  %1|%0 Edge/mob  %1|%0 Firefox/A %1|%0 Opera/A   %1|%0Safari/iOS %1|%0 %0Webview/A%1",ANSI.white,ANSI.gray),t.addLine(i,ANSI.gray),d(n),t.addLine(lf),!options.noteend&&options.notes&&l.length&&t.addLine(ANSI.yellow+l.join(""))),options.ext&&(t.addLine(" %0Node JS   %1|%0 QQ/A      %1|%0 Samsung/A %1|%0 UC/A      %1|%0 UC-Ch/A%1",ANSI.white,ANSI.gray),t.addLine(i.substr(0,i.length-12),ANSI.gray),d(o),t.addLine(lf),options.notes&&l.length&&t.addLine(ANSI.yellow+l.join(""))),options.specs&&e.specs&&e.specs.length&&(t.addLine(ANSI.cyan+"Specifications:"+lf),e.specs.forEach(e=>{t.addLine(ANSI.white+`${entities(e.name)}${lf}  ${function(e){switch(e.toUpperCase()){case"REC":return ANSI.green+"Recommendation"+ANSI.reset+lf;case"PR":return ANSI.yellow+"Proposed Recommendation"+ANSI.reset+lf;case"CR":return ANSI.cyan+"Candidate Recommendation"+ANSI.reset+lf;case"RC":return ANSI.cyan+"Release Candidate"+ANSI.reset+lf;case"WD":return ANSI.blue+"Working Draft"+ANSI.reset+lf;case"ED":return ANSI.green+"Editor's Draft"+ANSI.reset+lf;case"OLD-TRANSFORMS":return ANSI.orange+"This has been merged in another draft."+ANSI.reset+lf;case"LIVING":return ANSI.cyan+"Living Standard"+ANSI.reset+lf;case"RFC":return ANSI.yellow+"IETF RFC"+ANSI.reset+lf;case"STANDARD":return ANSI.green+"Standard"+ANSI.reset+lf;case"DRAFT":return ANSI.yellow+"Draft"+ANSI.reset+lf;case"OBSOLETE":return ANSI.red+"Obsolete"+ANSI.reset+lf;case"LC":return ANSI.yellow+"Last Call Working Draft"+ANSI.reset+lf;default:return ANSI.yellow+e+ANSI.reset+lf}}(e.status)}  ${e.url}`)}),t.addLine()),t.trimEnd(lf.length),t.toString()}function compatToShort(e,t){let r=e.prePath+e.name,n=new Output(0),o=["chrome","edge","firefox","ie","opera","safari"],s=["chrome_android","firefox_android","edge_mobile","opera_android","safari_ios","android"],i=["nodejs","qq_android","samsunginternet_android","uc_android","uc_chinese_android"],a=["C:","E:","F:","IE:","O:","S:"],l=["CA:","FA:","EM:","OA:","Si:","WA:"],d=["ND:","QQ:","SM:","UC:","UCC:"];function p(t,r){t.forEach((t,o)=>{let s,i=e.getBrowser(t);i?(s=i.info[0].getVersion(),i.hasNotes()&&(s+=ANSI.white+"*")):s=ANSI.red+no,n.add(ANSI.green,r[o],ANSI.white,s," ")})}return n.add(ANSI.white),options.split?n.add(r,":",lf):n.add(r.padEnd(t),":"),options.mobile||(n.add(ANSI.cyan+"  D: "),p(o,a)),options.desktop||(n.add(ANSI.cyan+"  M: "),p(s,l)),options.ext&&(n.add(ANSI.cyan+"  X: "),p(i,d)),n.trimEnd(1),n.toString()}function MDNComp(e){let t=getPathAsObject(e).__compat,r=["webview_android","chrome","chrome_android","edge","edge_mobile","firefox","firefox_android","ie","opera","opera_android","safari","safari_ios"],n=[!1,!0,!1,!0,!1,!0,!1,!0,!0,!1,!0,!1],o=t.status||{},s=Object.keys(t.support);this.path=e,this.prePath=prePathFromPath(e),this.name=nameFromPath(e),this.url=t.mdn_url&&t.mdn_url.length?"https://developer.mozilla.org/docs/"+t.mdn_url:null,this.specs=t.specs||[],this.experimental=o.experimental,this.standard=o.standard_track,this.deprecated=o.deprecated,this.browsers=[],this.description=t.description||"",s.forEach(e=>{let o=r.indexOf(e);if(o>=0){let r=new Browser(t,e);r.isDesktop=n[o],this.browsers.push(r)}})}function Info(e){this.added=this.toStatus(e.version_added),this.removed=this.toStatus(e.version_removed),this.notes=e.notes?Array.isArray(e.notes)?e.notes:[e.notes]:[],this.flags=e.flags||[],e.prefix&&this.notes.unshift("Prefix: "+e.prefix),e.partial_implementation&&this.notes.unshift("Is partial implementation."),e.alternative_name&&this.notes.unshift("Uses a non-standard name: "+e.alternative_name),this.flags.forEach(e=>{this.notes.push(this.flagToString(e,ANSI.yellow))})}function Browser(e,t){this.name=t,this.info=[];let r=e.support[t];Array.isArray(r)||(r=[r]),this.prefix=(r[r.length-1]||{}).prefix||"",r.forEach(e=>{this.info.push(new Info(e))})}function Output(e){this.string="",this.indent="    ".substr(0,0|e),this.linefeed=lf}MDNComp.prototype={getBrowser:function(e){for(let t of this.browsers)if(t.name===e)return t;return null},getStatus:function(){let e="(";return this.deprecated?e+=ANSI.red+"DEPRECATED"+ANSI.reset+", ":(this.experimental&&(e+=ANSI.yellow+"EXPERIMENTAL"+ANSI.reset+", "),this.standard&&(e+=ANSI.green+"On Standard Track"+ANSI.reset+", ")),"()"===(e=e.substr(0,Math.max(1,e.length-2))+")")?"":e},hasFlags:function(){for(let e of this.browsers)if(e.hasFlags())return!0;return!1}},Info.prototype={getVersion:function(){return this.removed?this.added+"-"+this.removed.replace("Y","?"):this.added},flagToString:function(e,t){switch(e.type){case"preference":return r("Behind flag "+ANSI.cyan);case"compile_flag":return r("Compile with "+ANSI.cyan);case"runtime_flag":return r("Run with "+ANSI.cyan)}function r(r){return r+e.name+(t||ANSI.reset)+(e.value_to_set?" set to "+e.value_to_set:"")+"."}return""},toString:function(e){let t=(e?e+") ":"")+(isNaN(this.added)?"":this.getVersion()+": "),r="",n=new Output(0);return this.notes.length?(this.notes.length>1&&(t+=lf,r="- "),this.notes.forEach(e=>{n.addLine(cleanHTML(r+e,!0,ANSI.yellow))}),t+n.toString()):""},toStatus:function(e){return"boolean"==typeof e?e?"Y":no:null===e?"?":e||null}},Browser.prototype={hasNotes:function(){for(let e of this.info)if(e.notes.length)return!0;return!1},hasFlags:function(){for(let e of this.info)if(e.flags.length)return!0;return!1},hasPrefix:function(){return this.prefix.length},getNotes:function(e){let t=new Output(0);return this.info.forEach(r=>{let n=breakAnsiLine(r.toString(e),options.maxChars);n.length&&t.addLine(n)}),t.toString()}},Output.prototype={add:function(e){if(e=e||"",arguments.length>1){let t=e.indexOf("%0")>=0;for(let r=1;r<arguments.length;r++){let n=new RegExp("%"+(r-1),"g");e=t?e.replace(n,arguments[r]):e+arguments[r]}}this.string+=this.indent+(e||"")},addLine:function(e){this.add.apply(this,arguments),this.string+=this.linefeed},trimEnd:function(e){this.string=this.string.substr(0,Math.max(0,this.string.length-e))},replace:function(e,t){let r=new RegExp(e,"g");this.string=this.string.replace(r,t)},toString:function(){return this.string}};