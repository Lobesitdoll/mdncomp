const utils=loadModule("core.utils");function doSearch(t){const e=utils.loadMDN(),o=utils.getComparer(t,options.fuzzy,!options.caseSensitive),s=[];return utils.getRootList(e).forEach(t=>(function t(n,r,i){const l=n[r];if("object"==typeof l){let n=Object.keys(l);options.deep||(n=n.filter(t=>"__compat"!==t)),n.filter(t=>{const o=utils.getPathAsObject(e,i+"."+t);return!(!options.deep&&o&&o.__compat&&o.__compat.title)||i.startsWith("css.")}).forEach(e=>{if("__compat"!==e||s.includes(i)){const n=i+"."+e;o.test(n)&&(e!==r&&s.length||!s.length)?s.push(n):t(l,e,n)}else{const t=l.__compat;("string"==typeof t.description&&o.test(t.description)||"string"==typeof t.title&&o.test(t.title)||"string"==typeof t.mdn_url&&o.test(utils.uncompactURL(t.mdn_url))||function(t){for(let e of Object.keys(t)){const s=t[e],n=Array.isArray(s)?s:[s];for(let t of n){const e=t.notes;if("string"==typeof e&&o.test(e))return!0;if(Array.isArray(e))for(let t of e)if(o.test(t))return!0;if("string"==typeof t.alternative_name&&o.test(t.alternative_name))return!0;if("string"==typeof t.prefix&&o.test(t.prefix))return!0;if(Array.isArray(t.flags))for(let e of t.flags)if("string"==typeof e.type&&o.test(e.type)||"string"==typeof e.name&&o.test(e.name))return!0}}return!1}(t.support)||function(t,e){const o=t.specs||t.spec_urls;if(o)for(let t of o)if(e.test(t.url)||e.test(t.name)||e.test(t.spec))return!0;return!1}(t,o))&&s.push(i)}})}})(e,t,t)),s}function doSearchByLink(t){const e=utils.loadMDN(),o=utils.getComparer(t,options.fuzzy,!options.caseSensitive),s=[];return utils.getRootList(e).forEach(t=>(function t(e,n,r){const i=e[n];"object"==typeof i&&Object.keys(i).filter(t=>"__compat"!==t).forEach(e=>{if(!s.includes(r)){const n=r+"."+e,l=(i[e]||{}).__compat,a=l?l.spec_urls||l.specs:null;if(l&&l.mdn_url)if(o.test(utils.uncompactURL(l.mdn_url)))s.push(n);else if(a)for(let t of a)if(o.test(t.url)){s.push(n);break}t(i,e,n)}})})(e,t,t)),s}function search(t=!1){const e=options.args.shift(),o=!options.deep&&e.toLowerCase().startsWith("https://")&&e.length>8,s=o?doSearchByLink(function(t){const e="https://developer.mozilla.org/",o=t.toLowerCase();o.startsWith(e)&&!o.startsWith(e+"docs/")&&(t=t.substr(0,e.length-1)+t.substr(t.indexOf("/",e.length)));return t}(e)):doSearch(e);if(s.length)if(s.length>1&&options.index<0){let t=Math.log10(s.length)+1,e="";s.forEach((o,s)=>{e+=`?y[?g${(""+s).padStart(t)}?y] ?w${o}\n`}),e+="?R\n"+utils.breakAnsiLine(text.addOptionIndex,options.maxLength),log(e)}else s.length>1&&options.index>=s.length?err(`?y${text.indexOutOfRange}.?R`):results(1===s.length?s[0]:s[options.index]);else t||o||options.fuzzy||options.deep||e.includes("*")||e.startsWith("/")?log(`?R${text.noResult}.`):(options.fuzzy=!0,options.args.unshift(e),search(!0))}function results(t){if(options.json){const e=utils.getPathAsObject(utils.loadMDN(),t);return void("object"==typeof e.__compat?log(JSON.stringify(e.__compat)):err(text.notFeatureObject))}const e=loadModule("formatter.common")(t);e&&(loadModule(options.shorthand?"formatter.short":"formatter.long")(e),options.nofooter||log(`?p${text.dataFromMDN} - "npm i -g mdncomp" (c) epistemex?w?R${lf}`))}module.exports={search:search,results:results};